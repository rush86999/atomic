"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SmartMeetingPrepSkill = void 0;
const calendarSkills_1 = require("./calendarSkills");
const gmailSkills_1 = require("../../atomic-docker/project/functions/atom-agent/skills/gmailSkills");
const notionAndResearchSkills_1 = require("../../atomic-docker/project/functions/atom-agent/skills/notionAndResearchSkills");
const logger_1 = require("../../../atomic-docker/project/functions/_utils/logger");
const constants_1 = require("../../../atomic-docker/project/functions/atom-agent/_libs/constants");
const lanceDbStorageSkills_1 = require("./lanceDbStorageSkills");
const authService_1 = require("../services/authService");
// Changed: listGoogleDriveFiles removed, getGoogleDriveFileMetadata imported
const gdriveSkills_1 = require("./gdriveSkills");
const COMMON_STOP_WORDS = new Set([
    'a', 'an', 'and', 'are', 'as', 'at', 'be', 'but', 'by', 'for', 'if', 'in', 'into', 'is', 'it', 'its',
    'of', 'on', 'or', 'our', 'so', 'such', 'that', 'the', 'their', 'theirs', 'them', 'then', 'there', 'these',
    'they', 'this', 'to', 'was', 'will', 'with', 'about', 'above', 'after', 'again', 'all', 'am', 'any',
    'because', 'been', 'before', 'being', 'below', 'between', 'both', 'can', 'did', 'do', 'does', 'doing',
    'down', 'during', 'each', 'few', 'from', 'further', 'had', 'has', 'have', 'having', 'he', 'her', 'here',
    'hers', 'herself', 'him', 'himself', 'his', 'how', 'i', 'just', 'me', 'my', 'myself', 'no', 'nor', 'not',
    'now', 'only', 'other', 'ought', 'out', 'over', 'own', 'same', 'she', 'should', 'some', 'still', 'than',
    'too', 'under', 'until', 'up', 'very', 'was', 'we', 'were', 'what', 'when', 'where', 'which', 'while',
    'who', 'whom', 'why', 'would', 'you', 'your', 'yours', 'yourself', 'yourselves',
    'meeting', 'call', 'sync', 'update', 'discuss', 'review', 'agenda', 'minutes', 'notes', 'event', 'schedule',
    'mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun', 'jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec',
    'am', 'pm', 'morning', 'afternoon', 'evening', 'daily', 'weekly', 'monthly', 'quarterly', 'annual'
]);
class SmartMeetingPrepSkill {
    constructor() { }
    _extractKeywords(text, minLength = 3, maxKeywords = 10) {
        if (!text)
            return [];
        const words = text.toLowerCase().split(/[^a-z0-9'-]+/);
        const keywords = words.filter(word => {
            if (word.length < minLength)
                return false;
            if (COMMON_STOP_WORDS.has(word))
                return false;
            if (/^\d+$/.test(word))
                return false;
            return true;
        });
        if (keywords.length > maxKeywords * 2) {
            const freqMap = new Map();
            keywords.forEach(kw => freqMap.set(kw, (freqMap.get(kw) || 0) + 1));
            return Array.from(freqMap.entries()).sort((a, b) => b[1] - a[1]).slice(0, maxKeywords).map(entry => entry[0]);
        }
        return Array.from(new Set(keywords)).slice(0, maxKeywords);
    }
    _getAttendeeEmails(attendees) {
        if (!attendees || attendees.length === 0)
            return [];
        const emailRegex = /<([^>]+)>/;
        const emails = [];
        attendees.forEach(attendeeString => {
            const match = attendeeString.match(emailRegex);
            if (match && match[1])
                emails.push(match[1].toLowerCase().trim());
            else if (attendeeString.includes('@') && !attendeeString.includes('<') && !attendeeString.includes('>')) {
                const potentialEmail = attendeeString.split(/\s+/).find(part => part.includes('@'));
                if (potentialEmail)
                    emails.push(potentialEmail.toLowerCase().trim());
            }
        });
        return [...new Set(emails)];
    }
    _scoreEmailRelevance(email, titleKeywords, descriptionKeywords, attendeeEmails, meetingStartDate) {
        let score = 0;
        const eSub = (email.subject || '').toLowerCase();
        const eSnip = (email.snippet || '').toLowerCase();
        const eFrom = (email.from || '').toLowerCase();
        titleKeywords.forEach(kw => { if (eSub.includes(kw))
            score += 3; if (eSnip.includes(kw))
            score += 2; });
        descriptionKeywords.forEach(kw => { if (eSub.includes(kw))
            score += 2; if (eSnip.includes(kw))
            score += 1; });
        if (attendeeEmails.some(attE => eFrom.includes(attE)))
            score += 4;
        if (email.date) {
            try {
                const eDate = new Date(email.date);
                const dDiff = (meetingStartDate.getTime() - eDate.getTime()) / (1000 * 3600 * 24);
                if (dDiff >= 0 && dDiff <= 2)
                    score += 3;
                else if (dDiff > 2 && dDiff <= 7)
                    score += 2;
                else if (dDiff > 7 && dDiff <= 30)
                    score += 1;
            }
            catch (e) {
                logger_1.logger.warn(`Could not parse email date for scoring: ${email.date}`);
            }
        }
        return score;
    }
    _scoreNotionPageRelevance(page, titleKeywords, descriptionKeywords, meetingStartDate, isExplicitLink) {
        let score = 0;
        const pTitle = (page.title || '').toLowerCase();
        const pPrev = (page.preview_text || '').toLowerCase();
        if (isExplicitLink)
            score += 10;
        titleKeywords.forEach(kw => { if (pTitle.includes(kw))
            score += 3; if (pPrev.includes(kw))
            score += 2; });
        descriptionKeywords.forEach(kw => { if (pTitle.includes(kw))
            score += 2; if (pPrev.includes(kw))
            score += 1; });
        if (page.last_edited_time) {
            try {
                const edDate = new Date(page.last_edited_time);
                const dDiff = (meetingStartDate.getTime() - edDate.getTime()) / (1000 * 3600 * 24);
                if (dDiff >= -7 && dDiff <= 7)
                    score += 3;
                else if (dDiff > 7 && dDiff <= 30)
                    score += 2;
                else if (dDiff > 30 && dDiff <= 90)
                    score += 1;
            }
            catch (e) {
                logger_1.logger.warn(`Could not parse Notion page last_edited_time for scoring: ${page.last_edited_time}`);
            }
        }
        return score;
    }
    _getContextualSnippet(text, keywords, maxLength = 150, contextWindow = 70) {
        if (!text || text.trim() === "")
            return "";
        const lowerText = text.toLowerCase();
        let foundKI = null;
        for (const kw of keywords) {
            if (!kw || kw.trim() === "")
                continue;
            const kwL = kw.toLowerCase();
            const idx = lowerText.indexOf(kwL);
            if (idx !== -1) {
                foundKI = { idx, len: kwL.length };
                break;
            }
        }
        if (foundKI) {
            const kSIdx = foundKI.idx;
            const kEIdx = kSIdx + foundKI.len;
            let start = Math.max(0, kSIdx - contextWindow);
            let end = Math.min(text.length, kEIdx + contextWindow);
            let prefix = start > 0 ? "... " : "";
            let suffix = end < text.length ? " ..." : "";
            let snippet = text.substring(start, end);
            if ((prefix + snippet + suffix).length > maxLength) {
                const remLen = maxLength - prefix.length - suffix.length;
                const kwVisStart = Math.max(0, kSIdx - start);
                const idealCutStart = Math.max(0, kwVisStart - Math.floor(remLen / 2));
                snippet = snippet.substring(idealCutStart, idealCutStart + remLen);
            }
            if (snippet.length > maxLength)
                snippet = snippet.substring(0, maxLength - 3) + "...";
            return prefix + snippet + suffix;
        }
        else {
            if (text.length <= maxLength)
                return text;
            return text.substring(0, maxLength - 3) + "...";
        }
    }
    async execute(input) {
        logger_1.logger.info(`SmartMeetingPrepSkill: Received request for userId: ${input.userId}, meeting_reference: "${input.meeting_reference}"`);
        const date_hints = undefined;
        const resolvedEvent = await (0, calendarSkills_1.findCalendarEventByFuzzyReference)(input.userId, input.meeting_reference, date_hints);
        let preparationNotes = undefined;
        let relatedDocuments = [];
        let relatedEmails = [];
        let relatedNotionPages = [];
        const dataFetchingErrors = [];
        let hybridSearchResults = []; // Changed from semanticallyRelatedItems
        let uniqueHybridSearchResults = []; // Changed from uniqueSemanticallyRelatedItems
        const gdriveFilesTriggered = [];
        if (resolvedEvent) {
            logger_1.logger.info(`SmartMeetingPrepSkill: Resolved event - Title: ${resolvedEvent.title}, StartTime: ${new Date(resolvedEvent.startTime).toISOString()}`);
            relatedDocuments = await this._findRelatedDocuments(resolvedEvent);
            const gmailSearchParams = { date_query: "recent" };
            try {
                logger_1.logger.info(`SmartMeetingPrepSkill: Searching emails for event "${resolvedEvent.title}"`);
                const emailSearchResponse = await (0, gmailSkills_1.searchEmailsForPrep)(input.userId, gmailSearchParams, resolvedEvent, 5);
                if (emailSearchResponse.ok && emailSearchResponse.data?.results) {
                    relatedEmails = emailSearchResponse.data.results;
                    logger_1.logger.info(`SmartMeetingPrepSkill: Found ${relatedEmails.length} related emails.`);
                }
                else {
                    const errorMsg = `Email search failed: ${emailSearchResponse.error?.message || 'Unknown error'}`;
                    logger_1.logger.warn(`SmartMeetingPrepSkill: ${errorMsg}`);
                    dataFetchingErrors.push(errorMsg);
                }
            }
            catch (error) {
                const errorMsg = `Error calling searchEmailsForPrep: ${error.message}`;
                logger_1.logger.error(`SmartMeetingPrepSkill: ${errorMsg}`, error);
                dataFetchingErrors.push(errorMsg);
            }
            const notionPageMap = new Map();
            const explicitNotionLinkPageIds = new Set(); // For scoring
            if (resolvedEvent.description) {
                const notionUrlRegex = /https:\/\/www\.notion\.so\/([\w.-]+?\/)?([\w-]+)(?:\?pvs=[\w-]+)?(?:#[\w-]+)?/g;
                let match;
                while ((match = notionUrlRegex.exec(resolvedEvent.description)) !== null) {
                    const potentialId = match[2].split('-').pop();
                    if (potentialId && potentialId.length >= 32) {
                        explicitNotionLinkPageIds.add(potentialId.replace(/[^a-f0-9]/gi, ''));
                    }
                }
                if (explicitNotionLinkPageIds.size > 0)
                    logger_1.logger.info(`SmartMeetingPrepSkill: Found ${explicitNotionLinkPageIds.size} unique Notion page IDs from description.`);
                for (const pageId of explicitNotionLinkPageIds) {
                    try {
                        const pageSummaryResponse = await (0, notionAndResearchSkills_1.getNotionPageSummaryById)(input.userId, pageId);
                        if (pageSummaryResponse.ok && pageSummaryResponse.data) {
                            notionPageMap.set(pageSummaryResponse.data.id, pageSummaryResponse.data);
                        }
                        else {
                            dataFetchingErrors.push(`Failed to fetch Notion page ${pageId} from link: ${pageSummaryResponse.error?.message}`);
                        }
                    }
                    catch (e) {
                        dataFetchingErrors.push(`Error fetching Notion page ${pageId}: ${e.message}`);
                    }
                }
            }
            const titleKeywords = this._extractKeywords(resolvedEvent.title, 3, 5); // Used for Notion keyword search & scoring
            const descriptionKeywords = resolvedEvent.description ? this._extractKeywords(resolvedEvent.description, 3, 7) : []; // Used for Notion keyword search & scoring
            let attendeeKeywords = [];
            if (resolvedEvent.attendees) {
                const attendeeNames = resolvedEvent.attendees.map(att => att.split('<')[0].trim().split(/\s+/).slice(0, 2).join(' ')).join(' ');
                attendeeKeywords = this._extractKeywords(attendeeNames, 3, 5);
            }
            const combinedKeywordsForNotion = new Set([...titleKeywords, ...descriptionKeywords, ...attendeeKeywords]);
            const notionKeywordQueryText = Array.from(combinedKeywordsForNotion).join(' ');
            if (notionKeywordQueryText.trim().length > 0) {
                logger_1.logger.info(`SmartMeetingPrepSkill: Notion keyword query: "${notionKeywordQueryText}"`);
                try {
                    const searchLimit = Math.max(0, 5 - notionPageMap.size);
                    if (searchLimit > 0) {
                        const notionSearchResponse = await (0, notionAndResearchSkills_1.searchNotionNotes)(input.userId, notionKeywordQueryText, constants_1.NOTION_NOTES_DATABASE_ID || undefined, searchLimit);
                        logger_1.logger.info(`SmartMeetingPrepSkill: Notion keyword search using DB ID: ${constants_1.NOTION_NOTES_DATABASE_ID || 'None (backend default)'}`);
                        if (notionSearchResponse.ok && notionSearchResponse.data) {
                            notionSearchResponse.data.forEach(page => { if (!notionPageMap.has(page.id))
                                notionPageMap.set(page.id, page); });
                        }
                        else {
                            dataFetchingErrors.push(`Notion keyword search failed: ${notionSearchResponse.error?.message}`);
                        }
                    }
                }
                catch (e) {
                    dataFetchingErrors.push(`Error in Notion keyword search: ${e.message}`);
                }
            }
            relatedNotionPages = Array.from(notionPageMap.values());
            const gDriveFileIdsFromDescription = new Set();
            if (resolvedEvent.description) {
                const gDriveUrlRegex = /https:\/\/(?:drive\.google\.com\/(?:file\/d\/|open\?id=)|docs\.google\.com\/(?:document\/d\/|spreadsheets\/d\/|presentation\/d\/))([\w-]+)/g;
                let gDriveMatch;
                while ((gDriveMatch = gDriveUrlRegex.exec(resolvedEvent.description)) !== null) {
                    if (gDriveMatch[1])
                        gDriveFileIdsFromDescription.add(gDriveMatch[1]);
                }
                if (gDriveFileIdsFromDescription.size > 0)
                    logger_1.logger.info(`SmartMeetingPrepSkill: Found GDrive file IDs in description: [${Array.from(gDriveFileIdsFromDescription).join(', ')}]`);
            }
            const linkedGDriveFilesMetadata = [];
            if (gDriveFileIdsFromDescription.size > 0 && authService_1.AuthService && gdriveSkills_1.getGoogleDriveFileMetadata) {
                logger_1.logger.info(`SmartMeetingPrepSkill: Fetching metadata for ${gDriveFileIdsFromDescription.size} GDrive file IDs using getGoogleDriveFileMetadata.`);
                for (const fileId of gDriveFileIdsFromDescription) {
                    try {
                        const metadataResp = await (0, gdriveSkills_1.getGoogleDriveFileMetadata)(input.userId, fileId); // Using the new direct metadata fetch skill
                        if (metadataResp.ok && metadataResp.data) {
                            linkedGDriveFilesMetadata.push(metadataResp.data);
                            logger_1.logger.info(`SmartMeetingPrepSkill: Successfully fetched GDrive metadata for: ${metadataResp.data.name} (ID: ${fileId})`);
                        }
                        else {
                            const errorMsg = `Failed to get metadata for GDrive file ID ${fileId}: ${metadataResp.error?.message}`;
                            logger_1.logger.warn(`SmartMeetingPrepSkill: ${errorMsg}`);
                            dataFetchingErrors.push(errorMsg);
                        }
                    }
                    catch (e) {
                        const errorMsg = `Error calling getGoogleDriveFileMetadata for GDrive file ID ${fileId}: ${e.message}`;
                        logger_1.logger.error(`SmartMeetingPrepSkill: ${errorMsg}`, e);
                        dataFetchingErrors.push(errorMsg);
                    }
                }
            }
            if (linkedGDriveFilesMetadata.length > 0 && gdriveSkills_1.triggerGoogleDriveFileIngestion) {
                logger_1.logger.info(`SmartMeetingPrepSkill: Triggering ingestion for ${linkedGDriveFilesMetadata.length} GDrive files.`);
                linkedGDriveFilesMetadata.forEach(file => {
                    gdriveFilesTriggered.push(file);
                    (0, gdriveSkills_1.triggerGoogleDriveFileIngestion)(input.userId, file.id, { name: file.name, mimeType: file.mimeType, webViewLink: file.webViewLink })
                        .then(ingestionRes => {
                        if (!ingestionRes.ok) {
                            const errMsg = `GDrive ingestion trigger failed for ${file.id} (${file.name}): ${ingestionRes.error?.message}`;
                            logger_1.logger.warn(`SmartMeetingPrepSkill: ${errMsg}`);
                            dataFetchingErrors.push(errMsg);
                        }
                        else {
                            logger_1.logger.info(`SmartMeetingPrepSkill: GDrive ingestion successfully triggered for ${file.id} (${file.name}). New Doc ID: ${ingestionRes.data?.doc_id}`);
                        }
                    })
                        .catch(err => {
                        const errMsg = `Error calling triggerGoogleDriveFileIngestion for ${file.id} (${file.name}): ${err.message}`;
                        logger_1.logger.error(`SmartMeetingPrepSkill: ${errMsg}`, err);
                        dataFetchingErrors.push(errMsg);
                    });
                });
            }
            const meetingStartDate = new Date(resolvedEvent.startTime);
            const eventTitleKeywords = this._extractKeywords(resolvedEvent.title, 2, 5);
            const eventDescKeywords = resolvedEvent.description ? this._extractKeywords(resolvedEvent.description, 3, 5) : [];
            const eventAttendeeEmails = this._getAttendeeEmails(resolvedEvent.attendees);
            const scoredEmails = relatedEmails.map(email => ({ item: email, score: this._scoreEmailRelevance(email, eventTitleKeywords, eventDescKeywords, eventAttendeeEmails, meetingStartDate) })).sort((a, b) => b.score - a.score);
            const scoredNotionPages = relatedNotionPages.map(page => ({ item: page, score: this._scoreNotionPageRelevance(page, eventTitleKeywords, eventDescKeywords, meetingStartDate, explicitNotionLinkPageIds.has(page.id)) })).sort((a, b) => b.score - a.score);
            const topEmails = scoredEmails.slice(0, 3);
            const topNotionPages = scoredNotionPages.slice(0, 2);
            // Logging for top items
            topEmails.forEach((se, idx) => logger_1.logger.info(`TopEmail[${idx}] (Score: ${se.score.toFixed(1)}): ${se.item.subject?.substring(0, 50)}... (From: ${se.item.from})`));
            topNotionPages.forEach((sp, idx) => logger_1.logger.info(`TopNotion[${idx}] (Score: ${sp.score.toFixed(1)}): ${sp.item.title?.substring(0, 50)}... (ExplicitLink: ${explicitNotionLinkPageIds.has(sp.item.id)})`));
            const searchQueryText = resolvedEvent.title + (eventDescKeywords.length > 0 ? " " + eventDescKeywords.join(" ") : "");
            if (searchQueryText.trim() && notionAndResearchSkills_1.performHybridSearchWithNLU) {
                try {
                    // Using the new NLU-powered hybrid search orchestrator
                    const hybridSearchResponse = await (0, notionAndResearchSkills_1.performHybridSearchWithNLU)(input.userId, searchQueryText, { semanticLimit: 5, keywordLimit: 10 });
                    if (hybridSearchResponse.ok && hybridSearchResponse.data) {
                        hybridSearchResults = hybridSearchResponse.data;
                    }
                    else {
                        dataFetchingErrors.push(`Hybrid search failed: ${hybridSearchResponse.error?.message || 'Unknown error'}`);
                    }
                }
                catch (e) {
                    dataFetchingErrors.push(`Hybrid search execution error: ${e.message}`);
                }
            }
            // De-duplication logic against items fetched via specific skills (e.g. recent emails)
            const existingItemIds = new Set();
            relatedEmails.forEach(email => existingItemIds.add(email.id));
            relatedNotionPages.forEach(page => existingItemIds.add(page.id));
            // The backend already de-duplicates between semantic/keyword, but we also de-duplicate against items fetched by other means.
            uniqueHybridSearchResults = hybridSearchResults.filter(item => {
                // doc_id for a Meili/LanceDB document might correspond to an email 'id' or notion 'id'
                // For now, we assume the backend search indexes these with consistent IDs.
                // We also want to ensure we don't show a keyword match for an email if we already have it from the direct `searchEmailsForPrep` call.
                if (item.doc_type === 'email_snippet' || item.doc_type === 'notion_summary') {
                    return !existingItemIds.has(item.doc_id);
                }
                return true; // Keep all other types like document_chunks
            });
            if (hybridSearchResults.length !== uniqueHybridSearchResults.length) {
                logger_1.logger.info(`SmartMeetingPrepSkill: De-duplicated hybrid results against other sources. Original: ${hybridSearchResults.length}, Unique: ${uniqueHybridSearchResults.length}`);
            }
            preparationNotes = await this._generatePreparationNotes(resolvedEvent, relatedDocuments, relatedEmails, relatedNotionPages, dataFetchingErrors, topEmails.map(e => e.item), topNotionPages.map(p => p.item), eventTitleKeywords, eventDescKeywords, gdriveFilesTriggered, uniqueHybridSearchResults // Pass the new hybrid results array
            );
            logger_1.logger.info(`SmartMeetingPrepSkill: Prep materials generated for "${resolvedEvent.title}".`);
            const storagePromises = [];
            if (relatedEmails.length > 0) {
                for (const email of relatedEmails) {
                    storagePromises.push((0, lanceDbStorageSkills_1.storeEmailSnippetInLanceDb)(input.userId, email).catch(err => logger_1.logger.error(`LanceDB storeEmail error for ${email.id}: ${err.message}`)));
                }
            }
            if (relatedNotionPages.length > 0) {
                for (const page of relatedNotionPages) {
                    storagePromises.push((0, lanceDbStorageSkills_1.storeNotionPageSummaryInLanceDb)(input.userId, page).catch(err => logger_1.logger.error(`LanceDB storeNotion error for ${page.id}: ${err.message}`)));
                }
            }
            if (storagePromises.length > 0) {
                Promise.allSettled(storagePromises).then(() => logger_1.logger.info("LanceDB storage attempts (emails, notion) completed."));
            }
        }
        else {
            logger_1.logger.warn(`SmartMeetingPrepSkill: Could not resolve event for "${input.meeting_reference}".`);
            preparationNotes = `Could not resolve a specific calendar event for reference: "${input.meeting_reference}". Please try a more specific query.`;
        }
        const output = {
            resolvedEvent, relatedDocuments, relatedEmails, relatedNotionPages,
            hybridSearchResults: uniqueHybridSearchResults, // Changed from semanticallyRelatedItems
            gdriveFilesTriggered: gdriveFilesTriggered,
            preparationNotes,
            dataFetchingErrors
        };
        logger_1.logger.info("[SmartMeetingPrepSkill.execute] Final output generated.");
        return output;
    }
    async _findRelatedDocuments(event) {
        logger_1.logger.info(`[SmartMeetingPrepSkill._findRelatedDocuments] Dynamically finding mock documents for event: "${event.title}" (ID: ${event.id})`);
        const mockDocs = [];
        const titleLower = event.title.toLowerCase();
        const descriptionLower = event.description?.toLowerCase() || "";
        if (titleLower.includes("budget") || descriptionLower.includes("budget"))
            mockDocs.push({ name: `Budget Overview for ${event.title}.xlsx`, url: `internal://finance/budget-${event.id}.xlsx`, type: "spreadsheet" });
        if (titleLower.includes("phoenix") || descriptionLower.includes("phoenix"))
            mockDocs.push({ name: `Project Phoenix Status - ${event.id}.pptx`, url: `internal://projects/phoenix/status-${event.id}.pptx`, type: "presentation" });
        if (titleLower.includes("marketing") || titleLower.includes("strategy") || descriptionLower.includes("marketing") || descriptionLower.includes("strategy"))
            mockDocs.push({ name: `Marketing Strategy Brief - ${event.id}.pdf`, url: `internal://marketing/strategy-${event.id}.pdf`, type: "pdf" });
        if (event.attendees) {
            for (const attendeeString of event.attendees) {
                const namePart = attendeeString.split('<')[0].trim().toLowerCase();
                const simpleName = namePart.split(' ')[0];
                if (simpleName === "alice")
                    mockDocs.push({ name: `Alice's Action Items from previous sessions.txt`, url: `internal://users/alice/actions-${event.id}.txt`, type: "text" });
                if (simpleName === "mark")
                    mockDocs.push({ name: `Mark's Proposal Draft for ${event.title}.docx`, url: `internal://users/mark/drafts/prop-${event.id}.docx`, type: "document" });
                if (simpleName === "sarah" && titleLower.includes("1:1"))
                    mockDocs.push({ name: `Performance Review Notes - Sarah Miller.pdf`, url: `internal://hr/reviews/sarahm-${event.id}.pdf`, type: "confidential" });
            }
        }
        mockDocs.push({ name: `Minutes from last general meeting on '${event.title}'.pdf`, url: `internal://meetings/minutes/prev-${event.id}.pdf`, type: "minutes" });
        if (mockDocs.length === 0)
            mockDocs.push({ name: `Standard Agenda Template.docx`, url: "internal://templates/agenda.docx", type: "template" });
        const uniqueDocs = Array.from(new Set(mockDocs.map(doc => doc.name))).map(name => mockDocs.find(doc => doc.name === name));
        logger_1.logger.info(`[SmartMeetingPrepSkill._findRelatedDocuments] Found ${uniqueDocs.length} mock documents dynamically.`);
        return uniqueDocs.slice(0, 4);
    }
    async _generatePreparationNotes(event, documents, emails, notionPages, errors, topEmails, topNotionPages, eventTitleKeywords, eventDescKeywords, gdriveFilesTriggered, hybridSearchResults // Changed from semanticallyRelatedItems
    ) {
        logger_1.logger.info(`[SmartMeetingPrepSkill._generatePreparationNotes] Generating notes for event: "${event.title}", with ${emails.length} total emails (${topEmails.length} top), ${notionPages.length} total Notion pages (${topNotionPages.length} top), ${gdriveFilesTriggered?.length || 0} GDrive files triggered, ${hybridSearchResults?.length || 0} hybrid search items, and ${errors.length} errors.`);
        const titleLower = event.title.toLowerCase();
        const descriptionLower = event.description?.toLowerCase() || "";
        let notes = `## Meeting Preparation Notes: ${event.title}\n\n`;
        if (topEmails.length > 0 || topNotionPages.length > 0) {
            notes += "âœ¨ **Key Highlights**\n\n";
            if (topEmails.length > 0) {
                notes += "**Potentially Relevant Emails:**\n";
                topEmails.forEach(email => {
                    const emailDate = email.date ? new Date(email.date).toLocaleDateString() : "N/A";
                    const combinedKeywords = [...eventTitleKeywords, ...eventDescKeywords];
                    const contextualSnippet = this._getContextualSnippet(email.snippet, combinedKeywords);
                    notes += `- **Subject:** "${email.subject || '(No Subject)'}" (From: ${email.from || 'N/A'}, Date: ${emailDate})\n`;
                    if (contextualSnippet)
                        notes += `  *Contextual Snippet:* ${contextualSnippet}\n`;
                    else if (email.snippet)
                        notes += `  *Snippet:* ${email.snippet.substring(0, 150)}...\n`;
                    if (email.link)
                        notes += `  *Link:* ${email.link}\n`;
                });
                notes += "\n";
            }
            if (topNotionPages.length > 0) {
                notes += "**Potentially Relevant Notion Pages:**\n";
                topNotionPages.forEach(page => {
                    const combinedKeywords = [...eventTitleKeywords, ...eventDescKeywords];
                    const contextualPreview = this._getContextualSnippet(page.preview_text, combinedKeywords);
                    notes += `- **Title:** "${page.title || 'Untitled Page'}"`;
                    if (page.last_edited_time)
                        notes += ` (Last edited: ${new Date(page.last_edited_time).toLocaleDateString()})`;
                    notes += "\n";
                    if (contextualPreview)
                        notes += `  *Contextual Preview:* ${contextualPreview}\n`;
                    else if (page.preview_text)
                        notes += `  *Preview:* ${page.preview_text.substring(0, 150)}...\n`;
                    if (page.url)
                        notes += `  *Link:* ${page.url}\n`;
                });
                notes += "\n";
            }
            notes += "---\n\n";
        }
        notes += `**Scheduled:** ${new Date(event.startTime).toLocaleString()} - ${new Date(event.endTime).toLocaleString()}\n`;
        notes += `**Location:** ${event.location || "Not specified"}\n`;
        notes += `**Organizer:** ${event.organizer || "N/A"}\n`;
        const attendeeList = event.attendees && event.attendees.length > 0 ? event.attendees.map(a => a.split('<')[0].trim()).join(", ") : "No attendees listed";
        notes += `**Attendees:** ${attendeeList}\n\n`;
        if (event.description)
            notes += `**Description/Agenda:**\n${event.description}\n\n`;
        notes += "**Key Discussion Points (Suggested):**\n";
        const discussionPoints = [];
        if (titleLower.includes("budget") || descriptionLower.includes("budget")) {
            discussionPoints.push("Review budget figures and allocations.");
            const budgetDoc = documents.find(doc => doc.name.toLowerCase().includes("budget"));
            if (budgetDoc)
                discussionPoints.push(`Analyze data in "${budgetDoc.name}".`);
        }
        if (titleLower.includes("strategy") || titleLower.includes("planning") || descriptionLower.includes("strategy") || descriptionLower.includes("planning"))
            discussionPoints.push("Define/Review strategic goals and next actions.");
        if (titleLower.includes("phoenix") || descriptionLower.includes("phoenix"))
            discussionPoints.push("Assess Project Phoenix progress and address blockers.");
        if (titleLower.includes("1:1")) {
            const attendeeName = event.title.replace("1:1 with", "").trim();
            discussionPoints.push(`Discuss ${attendeeName}'s progress, goals, and any challenges.`);
        }
        if (discussionPoints.length === 0) {
            discussionPoints.push("Clarify meeting objectives and desired outcomes.");
            discussionPoints.push("Identify key topics based on participant roles.");
        }
        discussionPoints.forEach(point => notes += `- ${point}\n`);
        notes += "\n";
        notes += "**Relevant Materials & Context:**\n";
        if (documents.length > 0) {
            documents.forEach(doc => { notes += `- **${doc.name}** (${doc.type}): Review this document for relevant background/data. (Mocked Link: ${doc.url})\n`; });
        }
        else {
            notes += "- No specific documents were automatically linked (mocked).\n";
        }
        notes += "\n";
        if (emails.length > 0) {
            notes += "**Recently Exchanged Emails (with attendees, around meeting date):**\n";
            emails.forEach(email => { const emailDate = email.date ? new Date(email.date).toLocaleDateString() : "N/A"; notes += `- **Subject:** "${email.subject || '(No Subject)'}" (From: ${email.from || 'N/A'}, Date: ${emailDate})\n`; if (email.snippet)
                notes += `  *Snippet:* ${email.snippet}...\n`; if (email.link)
                notes += `  *Link:* ${email.link}\n`; });
            notes += "\n";
        }
        else {
            notes += "**Recently Exchanged Emails:**\n- No specific recent emails found.\n\n";
        }
        if (notionPages.length > 0) {
            notes += "**Related Notion Pages:**\n";
            notionPages.forEach(page => { notes += `- **Title:** "${page.title || 'Untitled Page'}"`; if (page.last_edited_time)
                notes += ` (Last edited: ${new Date(page.last_edited_time).toLocaleDateString()})`; notes += "\n"; if (page.preview_text)
                notes += `  *Preview:* ${page.preview_text}...\n`; if (page.url)
                notes += `  *Link:* ${page.url}\n`; });
            notes += "\n";
        }
        else {
            notes += "**Related Notion Pages:**\n- No Notion pages found related to keywords.\n\n";
        }
        if (gdriveFilesTriggered && gdriveFilesTriggered.length > 0) {
            notes += "â„¹ï¸ **Google Drive Files Identified for Processing:**\n";
            gdriveFilesTriggered.forEach(file => { notes += `- "${file.name}" (Type: ${file.mimeType})\n`; });
            notes += "These files are being queued for processing and their content may be available for context in future preparations or searches.\n\n";
        }
        if (hybridSearchResults && hybridSearchResults.length > 0) {
            notes += "ðŸ“š **Additional Context from Knowledge Base (Hybrid Search)**\n\n";
            hybridSearchResults.forEach(item => { let itemTypeDisplay = item.doc_type ? item.doc_type.replace(/_/g, ' ').replace(/(?:^|\s)\S/g, a => a.toUpperCase()) : "Contextual Item"; const matchTypeDisplay = item.match_type.charAt(0).toUpperCase() + item.match_type.slice(1); notes += `- **Type:** ${itemTypeDisplay} (${matchTypeDisplay} Match)\n`; notes += `  - **Title/Subject:** "${item.title || 'N/A'}"\n`; notes += `  - **Relevant Snippet:** ${item.snippet || item.extracted_text_preview || 'N/A'}...\n`; const linkToDisplay = item.source_uri; if (linkToDisplay) {
                notes += `  - **Link:** ${linkToDisplay}\n`;
            } let itemDate = null; if (item.last_modified_source)
                itemDate = new Date(item.last_modified_source).toLocaleDateString();
            else if (item.created_at_source)
                itemDate = new Date(item.created_at_source).toLocaleDateString();
            else if (item.ingested_at)
                itemDate = new Date(item.ingested_at).toLocaleDateString(); if (itemDate)
                notes += `  - **Date:** ${itemDate}\n`; notes += `  - **Relevance Score:** ${item.score?.toFixed(4)}\n`; notes += "\n"; });
            notes += "---\n\n";
        }
        if (errors.length > 0) {
            notes += "**Data Retrieval Issues Encountered:**\n";
            errors.forEach(err => { notes += `- ${err}\n`; });
            notes += "\n";
        }
        notes += "**Potential Action Items to Consider...**\n";
        notes += "- [Assign owners and deadlines for new tasks]\n";
        notes += "- [Schedule follow-up meetings if necessary]\n\n";
        notes += "**Action Items from Previous Related Meetings...**\n";
        const actionItemDoc = documents.find(doc => doc.name.toLowerCase().includes("action items"));
        const minutesDoc = documents.find(doc => doc.name.toLowerCase().includes("minutes"));
        if (actionItemDoc)
            notes += `- Review action items from "${actionItemDoc.name}".\n`;
        else if (minutesDoc)
            notes += `- Check for open action items in "${minutesDoc.name}".\n`;
        else
            notes += "- Check for any outstanding action items from prior relevant meetings.\n";
        notes += "\n";
        if (event.attendees) {
            const lowerAttendees = event.attendees.map(a => a.toLowerCase());
            if (lowerAttendees.some(a => a.includes("alice"))) {
                const aliceDoc = documents.find(d => d.name.toLowerCase().includes("alice's action items"));
                if (aliceDoc)
                    notes += `**For Alice:** Please come prepared to discuss items from "${aliceDoc.name}".\n`;
                else
                    notes += `**For Alice:** Be ready to provide updates on your current tasks.\n`;
            }
            if (lowerAttendees.some(a => a.includes("mark"))) {
                const markDoc = documents.find(d => d.name.toLowerCase().includes("mark's proposal draft"));
                if (markDoc)
                    notes += `**For Mark:** Key discussion point will be your proposal: "${markDoc.name}".\n`;
            }
            notes += "\n";
        }
        notes += "---\nGenerated by SmartMeetingPrepSkill";
        logger_1.logger.info(`[SmartMeetingPrepSkill._generatePreparationNotes] Notes generated for "${event.title}". Length: ${notes.length}`);
        return notes;
    }
}
exports.SmartMeetingPrepSkill = SmartMeetingPrepSkill;
`` `
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21hcnRNZWV0aW5nUHJlcFNraWxsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic21hcnRNZWV0aW5nUHJlcFNraWxsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFEQUFzRztBQUN0RyxxR0FBMEc7QUFRMUcsNkhBQTBLO0FBQzFLLG1GQUFnRjtBQUNoRixtR0FBK0c7QUFDL0csaUVBT2dDO0FBQ2hDLHlEQUFzRDtBQUN0RCw2RUFBNkU7QUFDN0UsaURBQThHO0FBRTlHLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxHQUFHLENBQUM7SUFDaEMsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSztJQUNwRyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTztJQUN6RyxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLO0lBQ25HLFNBQVMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTztJQUNyRyxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNO0lBQ3ZHLE1BQU0sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLO0lBQ3hHLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU07SUFDdkcsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTztJQUNyRyxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVk7SUFDL0UsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVU7SUFDM0csS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSztJQUNuSSxJQUFJLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxX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QUFDO1lBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsS0FBSyxHQUFHLGFBQWEsQ0FBQyxDQUFDO1lBQUMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssR0FBRyxhQUFhLENBQUMsQ0FBQztZQUFDLElBQUksTUFBTSxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQUMsSUFBSSxNQUFNLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFBQyxJQUFJLENBQUMsTUFBTSxHQUFHLE9BQU8sR0FBRyxNQUFNLENBQUMsQ0FBQyxNQUFNLEdBQUcsU0FBUyxFQUFFLENBQUM7Z0JBQUMsTUFBTSxNQUFNLEdBQUcsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztnQkFBQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUM7Z0JBQUMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsYUFBYSxFQUFFLGFBQWEsR0FBRyxNQUFNLENBQUMsQ0FBQztZQUFDLENBQUM7WUFBQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsU0FBUztnQkFBRSxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsU0FBUyxH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Q0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUFDLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsSUFBSSxRQUFRO29CQUFFLEtBQUssSUFBSSw4REFBOEQsUUFBUSxDQUFDLElBQUksTUFBTSxDQUFDOztvQkFBTSxLQUFLLElBQUkscUVBQXFFLENBQUM7WUFBQyxDQUFDO1lBQUMsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQUMsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLENBQUMsQ0FBQztnQkFBQyxJQUFJLE9BQU87b0JBQUUsS0FBSyxJQUFJLDhEQUE4RCxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUM7WUFBQyxDQUFDO1lBQUMsS0FBSyxJQUFJLElBQUksQ0FBQztRQUFDLENBQUM7UUFDdnJCLEtBQUssSUFBSSx5Q0FBeUMsQ0FBQztRQUNuRCxlQUFNLENBQUMsSUFBSSxDQUFDLDBFQUEwRSxLQUFLLENBQUMsS0FBSyxjQUFjLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQy9ILE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztDQUNGO0FBN1ZELHNEQTZWQztBQUNELEVBQUUsQ0FBQTtBQUNGLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmaW5kQ2FsZW5kYXJFdmVudEJ5RnV6enlSZWZlcmVuY2UsIENhbGVuZGFyRXZlbnRTdW1tYXJ5LCBEYXRlSGludHMgfSBmcm9tICcuL2NhbGVuZGFyU2tpbGxzJztcbmltcG9ydCB7IHNlYXJjaEVtYWlsc0ZvclByZXAgfSBmcm9tICcuLi8uLi9hdG9taWMtZG9ja2VyL3Byb2plY3QvZnVuY3Rpb25zL2F0b20tYWdlbnQvc2tpbGxzL2dtYWlsU2tpbGxzJztcbmltcG9ydCB7XG4gIEdtYWlsU2VhcmNoUGFyYW1ldGVycyxcbiAgR21haWxNZXNzYWdlU25pcHBldCxcbiAgTm90aW9uUGFnZVN1bW1hcnksXG4gIFVuaXZlcnNhbFNlYXJjaFJlc3VsdEl0ZW0sXG4gIFNlYXJjaFJlc3VsdFNvdXJjZVR5cGVcbn0gZnJvbSAnLi4vLi4vYXRvbWljLWRvY2tlci9wcm9qZWN0L2Z1bmN0aW9ucy9hdG9tLWFnZW50L3R5cGVzJztcbmltcG9ydCB7IHNlYXJjaE5vdGlvbk5vdGVzLCBnZXROb3Rpb25QYWdlU3VtbWFyeUJ5SWQsIHBlcmZvcm1IeWJyaWRTZWFyY2hXaXRoTkxVIH0gZnJvbSAnLi4vLi4vYXRvbWljLWRvY2tlci9wcm9qZWN0L2Z1bmN0aW9ucy9hdG9tLWFnZW50L3NraWxscy9ub3Rpb25BbmRSZXNlYXJjaFNraWxscyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi8uLi8uLi9hdG9taWMtZG9ja2VyL3Byb2plY3QvZnVuY3Rpb25zL191dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgTk9USU9OX05PVEVTX0RBVEFCQVNFX0lEIH0gZnJvbSAnLi4vLi4vLi4vYXRvbWljLWRvY2tlci9wcm9qZWN0L2Z1bmN0aW9ucy9hdG9tLWFnZW50L19saWJzL2NvbnN0YW50cyc7XG5pbXBvcnQge1xuICBzdG9yZUVtYWlsU25pcHBldEluTGFuY2VEYixcbiAgc3RvcmVOb3Rpb25QYWdlU3VtbWFyeUluTGFuY2VEYixcbiAgc2VtYW50aWNTZWFyY2hMYW5jZURiLFxuICBTZW1hbnRpY1NlYXJjaEZpbHRlcnMsXG4gIGh5YnJpZFNlYXJjaCwgLy8gSW1wb3J0IHRoZSBuZXcgaHlicmlkIHNlYXJjaCBmdW5jdGlvblxuICBIeWJyaWRTZWFyY2hSZXN1bHRJdGVtXG59IGZyb20gJy4vbGFuY2VEYlN0b3JhZ2VTa2lsbHMnO1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hdXRoU2VydmljZSc7XG4vLyBDaGFuZ2VkOiBsaXN0R29vZ2xlRHJpdmVGaWxlcyByZW1vdmVkLCBnZXRHb29nbGVEcml2ZUZpbGVNZXRhZGF0YSBpbXBvcnRlZFxuaW1wb3J0IHsgZ2V0R29vZ2xlRHJpdmVGaWxlTWV0YWRhdGEsIHRyaWdnZXJHb29nbGVEcml2ZUZpbGVJbmdlc3Rpb24sIEdvb2dsZURyaXZlRmlsZSB9IGZyb20gJy4vZ2RyaXZlU2tpbGxzJztcblxuY29uc3QgQ09NTU9OX1NUT1BfV09SRFMgPSBuZXcgU2V0KFtcbiAgJ2EnLCAnYW4nLCAnYW5kJywgJ2FyZScsICdhcycsICdhdCcsICdiZScsICdidXQnLCAnYnknLCAnZm9yJywgJ2lmJywgJ2luJywgJ2ludG8nLCAnaXMnLCAnaXQnLCAnaXRzJyxcbiAgJ29mJywgJ29uJywgJ29yJywgJ291cicsICdzbycsICdzdWNoJywgJ3RoYXQnLCAndGhlJywgJ3RoZWlyJywgJ3RoZWlycycsICd0aGVtJywgJ3RoZW4nLCAndGhlcmUnLCAndGhlc2UnLFxuICAndGhleScsICd0aGlzJywgJ3RvJywgJ3dhcycsICd3aWxsJywgJ3dpdGgnLCAnYWJvdXQnLCAnYWJvdmUnLCAnYWZ0ZXInLCAnYWdhaW4nLCAnYWxsJywgJ2FtJywgJ2FueScsXG4gICdiZWNhdXNlJywgJ2JlZW4nLCAnYmVmb3JlJywgJ2JlaW5nJywgJ2JlbG93JywgJ2JldHdlZW4nLCAnYm90aCcsICdjYW4nLCAnZGlkJywgJ2RvJywgJ2RvZXMnLCAnZG9pbmcnLFxuICAnZG93bicsICdkdXJpbmcnLCAnZWFjaCcsICdmZXcnLCAnZnJvbScsICdmdXJ0aGVyJywgJ2hhZCcsICdoYXMnLCAnaGF2ZScsICdoYXZpbmcnLCAnaGUnLCAnaGVyJywgJ2hlcmUnLFxuICAnaGVycycsICdoZXJzZWxmJywgJ2hpbScsICdoaW1zZWxmJywgJ2hpcycsICdob3cnLCAnaScsICdqdXN0JywgJ21lJywgJ215JywgJ215c2VsZicsICdubycsICdub3InLCAnbm90JyxcbiAgJ25vdycsICdvbmx5JywgJ290aGVyJywgJ291Z2h0JywgJ291dCcsICdvdmVyJywgJ293bicsICdzYW1lJywgJ3NoZScsICdzaG91bGQnLCAnc29tZScsICdzdGlsbCcsICd0aGFuJyxcbiAgJ3RvbycsICd1bmRlcicsICd1bnRpbCcsICd1cCcsICd2ZXJ5JywgJ3dhcycsICd3ZScsICd3ZXJlJywgJ3doYXQnLCAnd2hlbicsICd3aGVyZScsICd3aGljaCcsICd3aGlsZScsXG4gICd3aG8nLCAnd2hvbScsICd3aHknLCAnd291bGQnLCAneW91JywgJ3lvdXInLCAneW91cnMnLCAneW91cnNlbGYnLCAneW91cnNlbHZlcycsXG4gICdtZWV0aW5nJywgJ2NhbGwnLCAnc3luYycsICd1cGRhdGUnLCAnZGlzY3VzcycsICdyZXZpZXcnLCAnYWdlbmRhJywgJ21pbnV0ZXMnLCAnbm90ZXMnLCAnZXZlbnQnLCAnc2NoZWR1bGUnLFxuICAnbW9uJywgJ3R1ZScsICd3ZWQnLCAndGh1JywgJ2ZyaScsICdzYXQnLCAnc3VuJywgJ2phbicsICdmZWInLCAnbWFyJywgJ2FwcicsICdtYXknLCAnanVuJywgJ2p1bCcsICdhdWcnLCAnc2VwJywgJ29jdCcsICdub3YnLCAnZGVjJyxcbiAgJ2FtJywgJ3BtJywgJ21vcm5pbmcnLCAnYWZ0ZXJub29uJywgJ2V2ZW5pbmcnLCAnZGFpbHknLCAnd2Vla2x5JywgJ21vbnRobHknLCAncXVhcnRlcmx5JywgJ2FubnVhbCdcbl0pO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNtYXJ0TWVldGluZ1ByZXBTa2lsbElucHV0IHtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIG1lZXRpbmdfcmVmZXJlbmNlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU21hcnRNZWV0aW5nUHJlcFNraWxsT3V0cHV0IHtcbiAgcmVzb2x2ZWRFdmVudD86IENhbGVuZGFyRXZlbnRTdW1tYXJ5O1xuICBwcmVwYXJhdGlvbk5vdGVzPzogc3RyaW5nO1xuICByZWxhdGVkRG9jdW1lbnRzPzogYW55W107XG4gIHJlbGF0ZWRFbWFpbHM/OiBHbWFpbE1lc3NhZ2VTbmlwcGV0W107XG4gIHJlbGF0ZWROb3Rpb25QYWdlcz86IE5vdGlvblBhZ2VTdW1tYXJ5W107XG4gIGh5YnJpZFNlYXJjaFJlc3VsdHM/OiBIeWJyaWRTZWFyY2hSZXN1bHRJdGVtW107IC8vIENoYW5nZWQgZnJvbSBzZW1hbnRpY2FsbHlSZWxhdGVkSXRlbXNcbiAgZ2RyaXZlRmlsZXNUcmlnZ2VyZWQ/OiBHb29nbGVEcml2ZUZpbGVbXTtcbiAgZGF0YUZldGNoaW5nRXJyb3JzPzogc3RyaW5nW107XG59XG5cbmV4cG9ydCBjbGFzcyBTbWFydE1lZXRpbmdQcmVwU2tpbGwge1xuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgcHJpdmF0ZSBfZXh0cmFjdEtleXdvcmRzKHRleHQ6IHN0cmluZywgbWluTGVuZ3RoID0gMywgbWF4S2V5d29yZHMgPSAxMCk6IHN0cmluZ1tdIHtcbiAgICBpZiAoIXRleHQpIHJldHVybiBbXTtcbiAgICBjb25zdCB3b3JkcyA9IHRleHQudG9Mb3dlckNhc2UoKS5zcGxpdCgvW15hLXowLTknLV0rLyk7XG4gICAgY29uc3Qga2V5d29yZHMgPSB3b3Jkcy5maWx0ZXIod29yZCA9PiB7XG4gICAgICBpZiAod29yZC5sZW5ndGggPCBtaW5MZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICAgIGlmIChDT01NT05fU1RPUF9XT1JEUy5oYXMod29yZCkpIHJldHVybiBmYWxzZTtcbiAgICAgIGlmICgvXlxcZCskLy50ZXN0KHdvcmQpKSByZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbiAgICBpZiAoa2V5d29yZHMubGVuZ3RoID4gbWF4S2V5d29yZHMgKiAyKSB7XG4gICAgICAgIGNvbnN0IGZyZXFNYXAgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICBrZXl3b3Jkcy5mb3JFYWNoKGt3ID0+IGZyZXFNYXAuc2V0KGt3LCAoZnJlcU1hcC5nZXQoa3cpIHx8IDApICsgMSkpO1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShmcmVxTWFwLmVudHJpZXMoKSkuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pLnNsaWNlKDAsIG1heEtleXdvcmRzKS5tYXAoZW50cnkgPT4gZW50cnlbMF0pO1xuICAgIH1cbiAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGtleXdvcmRzKSkuc2xpY2UoMCwgbWF4S2V5d29yZHMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0QXR0ZW5kZWVFbWFpbHMoYXR0ZW5kZWVzPzogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgaWYgKCFhdHRlbmRlZXMgfHwgYXR0ZW5kZWVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xuICAgIGNvbnN0IGVtYWlsUmVnZXggPSAvPChbXj5dKyk+LztcbiAgICBjb25zdCBlbWFpbHM6IHN0cmluZ1tdID0gW107XG4gICAgYXR0ZW5kZWVzLmZvckVhY2goYXR0ZW5kZWVTdHJpbmcgPT4ge1xuICAgICAgY29uc3QgbWF0Y2ggPSBhdHRlbmRlZVN0cmluZy5tYXRjaChlbWFpbFJlZ2V4KTtcbiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkgZW1haWxzLnB1c2gobWF0Y2hbMV0udG9Mb3dlckNhc2UoKS50cmltKCkpO1xuICAgICAgZWxzZSBpZiAoYXR0ZW5kZWVTdHJpbmcuaW5jbHVkZXMoJ0AnKSAmJiAhYXR0ZW5kZWVTdHJpbmcuaW5jbHVkZXMoJzwnKSAmJiAhYXR0ZW5kZWVTdHJpbmcuaW5jbHVkZXMoJz4nKSkge1xuICAgICAgICBjb25zdCBwb3RlbnRpYWxFbWFpbCA9IGF0dGVuZGVlU3RyaW5nLnNwbGl0KC9cXHMrLykuZmluZChwYXJ0ID0+IHBhcnQuaW5jbHVkZXMoJ0AnKSk7XG4gICAgICAgIGlmIChwb3RlbnRpYWxFbWFpbCkgZW1haWxzLnB1c2gocG90ZW50aWFsRW1haWwudG9Mb3dlckNhc2UoKS50cmltKCkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBbLi4ubmV3IFNldChlbWFpbHMpXTtcbiAgfVxuXG4gIHByaXZhdGUgX3Njb3JlRW1haWxSZWxldmFuY2UoZW1haWw6IEdtYWlsTWVzc2FnZVNuaXBwZXQsIHRpdGxlS2V5d29yZHM6IHN0cmluZ1tdLCBkZXNjcmlwdGlvbktleXdvcmRzOiBzdHJpbmdbXSwgYXR0ZW5kZWVFbWFpbHM6IHN0cmluZ1tdLCBtZWV0aW5nU3RhcnREYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAwOyBjb25zdCBlU3ViID0gKGVtYWlsLnN1YmplY3QgfHwgJycpLnRvTG93ZXJDYXNlKCk7IGNvbnN0IGVTbmlwID0gKGVtYWlsLnNuaXBwZXQgfHwgJycpLnRvTG93ZXJDYXNlKCk7IGNvbnN0IGVGcm9tID0gKGVtYWlsLmZyb20gfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgdGl0bGVLZXl3b3Jkcy5mb3JFYWNoKGt3ID0+IHsgaWYgKGVTdWIuaW5jbHVkZXMoa3cpKSBzY29yZSArPSAzOyBpZiAoZVNuaXAuaW5jbHVkZXMoa3cpKSBzY29yZSArPSAyOyB9KTtcbiAgICBkZXNjcmlwdGlvbktleXdvcmRzLmZvckVhY2goa3cgPT4geyBpZiAoZVN1Yi5pbmNsdWRlcyhrdykpIHNjb3JlICs9IDI7IGlmIChlU25pcC5pbmNsdWRlcyhrdykpIHNjb3JlICs9IDE7IH0pO1xuICAgIGlmIChhdHRlbmRlZUVtYWlscy5zb21lKGF0dEUgPT4gZUZyb20uaW5jbHVkZXMoYXR0RSkpKSBzY29yZSArPSA0O1xuICAgIGlmIChlbWFpbC5kYXRlKSB7IHRyeSB7IGNvbnN0IGVEYXRlID0gbmV3IERhdGUoZW1haWwuZGF0ZSk7IGNvbnN0IGREaWZmID0gKG1lZXRpbmdTdGFydERhdGUuZ2V0VGltZSgpIC0gZURhdGUuZ2V0VGltZSgpKSAvICgxMDAwKjM2MDAqMjQpOyBpZiAoZERpZmYgPj0gMCAmJiBkRGlmZiA8PSAyKSBzY29yZSArPSAzOyBlbHNlIGlmIChkRGlmZiA+IDIgJiYgZERpZmYgPD0gNykgc2NvcmUgKz0gMjsgZWxzZSBpZiAoZERpZmYgPiA3ICYmIGREaWZmIDw9IDMwKSBzY29yZSArPSAxOyB9IGNhdGNoIChlKSB7IGxvZ2dlci53YXJuKGBDb3VsZCBub3QgcGFyc2UgZW1haWwgZGF0ZSBmb3Igc2NvcmluZzogJHtlbWFpbC5kYXRlfWApOyB9IH1cbiAgICByZXR1cm4gc2NvcmU7XG4gIH1cblxuICBwcml2YXRlIF9zY29yZU5vdGlvblBhZ2VSZWxldmFuY2UocGFnZTogTm90aW9uUGFnZVN1bW1hcnksIHRpdGxlS2V5d29yZHM6IHN0cmluZ1tdLCBkZXNjcmlwdGlvbktleXdvcmRzOiBzdHJpbmdbXSwgbWVldGluZ1N0YXJ0RGF0ZTogRGF0ZSwgaXNFeHBsaWNpdExpbms6IGJvb2xlYW4pOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDA7IGNvbnN0IHBUaXRsZSA9IChwYWdlLnRpdGxlIHx8ICcnKS50b0xvd2VyQ2FzZSgpOyBjb25zdCBwUHJldiA9IChwYWdlLnByZXZpZXdfdGV4dCB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoaXNFeHBsaWNpdExpbmspIHNjb3JlICs9IDEwO1xuICAgIHRpdGxlS2V5d29yZHMuZm9yRWFjaChrdyA9PiB7IGlmIChwVGl0bGUuaW5jbHVkZXMoa3cpKSBzY29yZSArPSAzOyBpZiAocFByZXYuaW5jbHVkZXMoa3cpKSBzY29yZSArPSAyOyB9KTtcbiAgICBkZXNjcmlwdGlvbktleXdvcmRzLmZvckVhY2goa3cgPT4geyBpZiAocFRpdGxlLmluY2x1ZGVzKGt3KSkgc2NvcmUgKz0gMjsgaWYgKHBQcmV2LmluY2x1ZGVzKGt3KSkgc2NvcmUgKz0gMTsgfSk7XG4gICAgaWYgKHBhZ2UubGFzdF9lZGl0ZWRfdGltZSkgeyB0cnkgeyBjb25zdCBlZERhdGUgPSBuZXcgRGF0ZShwYWdlLmxhc3RfZWRpdGVkX3RpbWUpOyBjb25zdCBkRGlmZiA9IChtZWV0aW5nU3RhcnREYXRlLmdldFRpbWUoKSAtIGVkRGF0ZS5nZXRUaW1lKCkpIC8gKDEwMDAqMzYwMCoyNCk7IGlmIChkRGlmZiA+PSAtNyAmJiBkRGlmZiA8PSA3KSBzY29yZSArPSAzOyBlbHNlIGlmIChkRGlmZiA+IDcgJiYgZERpZmYgPD0gMzApIHNjb3JlICs9IDI7IGVsc2UgaWYgKGREaWZmID4gMzAgJiYgZERpZmYgPD0gOTApIHNjb3JlICs9MTsgfSBjYXRjaCAoZSkgeyBsb2dnZXIud2FybihgQ291bGQgbm90IHBhcnNlIE5vdGlvbiBwYWdlIGxhc3RfZWRpdGVkX3RpbWUgZm9yIHNjb3Jpbmc6ICR7cGFnZS5sYXN0X2VkaXRlZF90aW1lfWApOyB9IH1cbiAgICByZXR1cm4gc2NvcmU7XG4gIH1cblxuICBwcml2YXRlIF9nZXRDb250ZXh0dWFsU25pcHBldCh0ZXh0OiBzdHJpbmcgfCB1bmRlZmluZWQgfCBudWxsLCBrZXl3b3Jkczogc3RyaW5nW10sIG1heExlbmd0aDogbnVtYmVyID0gMTUwLCBjb250ZXh0V2luZG93OiBudW1iZXIgPSA3MCk6IHN0cmluZyB7XG4gICAgaWYgKCF0ZXh0IHx8IHRleHQudHJpbSgpID09PSBcIlwiKSByZXR1cm4gXCJcIjsgY29uc3QgbG93ZXJUZXh0ID0gdGV4dC50b0xvd2VyQ2FzZSgpOyBsZXQgZm91bmRLSTogeyBpZHg6IG51bWJlciwgbGVuOiBudW1iZXIgfSB8IG51bGwgPSBudWxsO1xuICAgIGZvciAoY29uc3Qga3cgb2Yga2V5d29yZHMpIHsgaWYgKCFrdyB8fCBrdy50cmltKCkgPT09IFwiXCIpIGNvbnRpbnVlOyBjb25zdCBrd0wgPSBrdy50b0xvd2VyQ2FzZSgpOyBjb25zdCBpZHggPSBsb3dlclRleHQuaW5kZXhPZihrd0wpOyBpZiAoaWR4ICE9PSAtMSkgeyBmb3VuZEtJID0geyBpZHgsIGxlbjoga3dMLmxlbmd0aCB9OyBicmVhazsgfSB9XG4gICAgaWYgKGZvdW5kS0kpIHsgY29uc3Qga1NJZHggPSBmb3VuZEtJLmlkeDsgY29uc3Qga0VJZHggPSBrU0lkeCArIGZvdW5kS0kubGVuOyBsZXQgc3RhcnQgPSBNYXRoLm1heCgwLCBrU0lkeCAtIGNvbnRleHRXaW5kb3cpOyBsZXQgZW5kID0gTWF0aC5taW4odGV4dC5sZW5ndGgsIGtFSWR4ICsgY29udGV4dFdpbmRvdyk7IGxldCBwcmVmaXggPSBzdGFydCA+IDAgPyBcIi4uLiBcIiA6IFwiXCI7IGxldCBzdWZmaXggPSBlbmQgPCB0ZXh0Lmxlbmd0aCA/IFwiIC4uLlwiIDogXCJcIjsgbGV0IHNuaXBwZXQgPSB0ZXh0LnN1YnN0cmluZyhzdGFydCwgZW5kKTsgaWYgKChwcmVmaXggKyBzbmlwcGV0ICsgc3VmZml4KS5sZW5ndGggPiBtYXhMZW5ndGgpIHsgY29uc3QgcmVtTGVuID0gbWF4TGVuZ3RoIC0gcHJlZml4Lmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGg7IGNvbnN0IGt3VmlzU3RhcnQgPSBNYXRoLm1heCgwLCBrU0lkeCAtIHN0YXJ0KTsgY29uc3QgaWRlYWxDdXRTdGFydCA9IE1hdGgubWF4KDAsIGt3VmlzU3RhcnQgLSBNYXRoLmZsb29yKHJlbUxlbiAvIDIpKTsgc25pcHBldCA9IHNuaXBwZXQuc3Vic3RyaW5nKGlkZWFsQ3V0U3RhcnQsIGlkZWFsQ3V0U3RhcnQgKyByZW1MZW4pOyB9IGlmIChzbmlwcGV0Lmxlbmd0aCA+IG1heExlbmd0aCkgc25pcHBldCA9IHNuaXBwZXQuc3Vic3RyaW5nKDAsIG1heExlbmd0aCAtMykgKyBcIi4uLlwiOyByZXR1cm4gcHJlZml4ICsgc25pcHBldCArIHN1ZmZpeDsgfVxuICAgIGVsc2UgeyBpZiAodGV4dC5sZW5ndGggPD0gbWF4TGVuZ3RoKSByZXR1cm4gdGV4dDsgcmV0dXJuIHRleHQuc3Vic3RyaW5nKDAsIG1heExlbmd0aCAtIDMpICsgXCIuLi5cIjsgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIGV4ZWN1dGUoaW5wdXQ6IFNtYXJ0TWVldGluZ1ByZXBTa2lsbElucHV0KTogUHJvbWlzZTxTbWFydE1lZXRpbmdQcmVwU2tpbGxPdXRwdXQ+IHtcbiAgICBsb2dnZXIuaW5mbyhgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBSZWNlaXZlZCByZXF1ZXN0IGZvciB1c2VySWQ6ICR7aW5wdXQudXNlcklkfSwgbWVldGluZ19yZWZlcmVuY2U6IFwiJHtpbnB1dC5tZWV0aW5nX3JlZmVyZW5jZX1cImApO1xuICAgIGNvbnN0IGRhdGVfaGludHM6IERhdGVIaW50cyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICBjb25zdCByZXNvbHZlZEV2ZW50ID0gYXdhaXQgZmluZENhbGVuZGFyRXZlbnRCeUZ1enp5UmVmZXJlbmNlKGlucHV0LnVzZXJJZCwgaW5wdXQubWVldGluZ19yZWZlcmVuY2UsIGRhdGVfaGludHMpO1xuXG4gICAgbGV0IHByZXBhcmF0aW9uTm90ZXM6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICBsZXQgcmVsYXRlZERvY3VtZW50czogYW55W10gPSBbXTtcbiAgICBsZXQgcmVsYXRlZEVtYWlsczogR21haWxNZXNzYWdlU25pcHBldFtdID0gW107XG4gICAgbGV0IHJlbGF0ZWROb3Rpb25QYWdlczogTm90aW9uUGFnZVN1bW1hcnlbXSA9IFtdO1xuICAgIGNvbnN0IGRhdGFGZXRjaGluZ0Vycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBsZXQgaHlicmlkU2VhcmNoUmVzdWx0czogSHlicmlkU2VhcmNoUmVzdWx0SXRlbVtdID0gW107IC8vIENoYW5nZWQgZnJvbSBzZW1hbnRpY2FsbHlSZWxhdGVkSXRlbXNcbiAgICBsZXQgdW5pcXVlSHlicmlkU2VhcmNoUmVzdWx0czogSHlicmlkU2VhcmNoUmVzdWx0SXRlbVtdID0gW107IC8vIENoYW5nZWQgZnJvbSB1bmlxdWVTZW1hbnRpY2FsbHlSZWxhdGVkSXRlbXNcbiAgICBjb25zdCBnZHJpdmVGaWxlc1RyaWdnZXJlZDogR29vZ2xlRHJpdmVGaWxlW10gPSBbXTtcblxuICAgIGlmIChyZXNvbHZlZEV2ZW50KSB7XG4gICAgICBsb2dnZXIuaW5mbyhgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBSZXNvbHZlZCBldmVudCAtIFRpdGxlOiAke3Jlc29sdmVkRXZlbnQudGl0bGV9LCBTdGFydFRpbWU6ICR7bmV3IERhdGUocmVzb2x2ZWRFdmVudC5zdGFydFRpbWUpLnRvSVNPU3RyaW5nKCl9YCk7XG4gICAgICByZWxhdGVkRG9jdW1lbnRzID0gYXdhaXQgdGhpcy5fZmluZFJlbGF0ZWREb2N1bWVudHMocmVzb2x2ZWRFdmVudCk7XG5cbiAgICAgIGNvbnN0IGdtYWlsU2VhcmNoUGFyYW1zOiBHbWFpbFNlYXJjaFBhcmFtZXRlcnMgPSB7IGRhdGVfcXVlcnk6IFwicmVjZW50XCIgfTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBTbWFydE1lZXRpbmdQcmVwU2tpbGw6IFNlYXJjaGluZyBlbWFpbHMgZm9yIGV2ZW50IFwiJHtyZXNvbHZlZEV2ZW50LnRpdGxlfVwiYCk7XG4gICAgICAgIGNvbnN0IGVtYWlsU2VhcmNoUmVzcG9uc2UgPSBhd2FpdCBzZWFyY2hFbWFpbHNGb3JQcmVwKGlucHV0LnVzZXJJZCwgZ21haWxTZWFyY2hQYXJhbXMsIHJlc29sdmVkRXZlbnQsIDUpO1xuICAgICAgICBpZiAoZW1haWxTZWFyY2hSZXNwb25zZS5vayAmJiBlbWFpbFNlYXJjaFJlc3BvbnNlLmRhdGE/LnJlc3VsdHMpIHtcbiAgICAgICAgICByZWxhdGVkRW1haWxzID0gZW1haWxTZWFyY2hSZXNwb25zZS5kYXRhLnJlc3VsdHM7XG4gICAgICAgICAgbG9nZ2VyLmluZm8oYFNtYXJ0TWVldGluZ1ByZXBTa2lsbDogRm91bmQgJHtyZWxhdGVkRW1haWxzLmxlbmd0aH0gcmVsYXRlZCBlbWFpbHMuYCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JNc2cgPSBgRW1haWwgc2VhcmNoIGZhaWxlZDogJHtlbWFpbFNlYXJjaFJlc3BvbnNlLmVycm9yPy5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gO1xuICAgICAgICAgIGxvZ2dlci53YXJuKGBTbWFydE1lZXRpbmdQcmVwU2tpbGw6ICR7ZXJyb3JNc2d9YCk7IGRhdGFGZXRjaGluZ0Vycm9ycy5wdXNoKGVycm9yTXNnKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zdCBlcnJvck1zZyA9IGBFcnJvciBjYWxsaW5nIHNlYXJjaEVtYWlsc0ZvclByZXA6ICR7ZXJyb3IubWVzc2FnZX1gO1xuICAgICAgICBsb2dnZXIuZXJyb3IoYFNtYXJ0TWVldGluZ1ByZXBTa2lsbDogJHtlcnJvck1zZ31gLCBlcnJvcik7IGRhdGFGZXRjaGluZ0Vycm9ycy5wdXNoKGVycm9yTXNnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgbm90aW9uUGFnZU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBOb3Rpb25QYWdlU3VtbWFyeT4oKTtcbiAgICAgIGNvbnN0IGV4cGxpY2l0Tm90aW9uTGlua1BhZ2VJZHMgPSBuZXcgU2V0PHN0cmluZz4oKTsgLy8gRm9yIHNjb3JpbmdcbiAgICAgIGlmIChyZXNvbHZlZEV2ZW50LmRlc2NyaXB0aW9uKSB7XG4gICAgICAgIGNvbnN0IG5vdGlvblVybFJlZ2V4ID0gL2h0dHBzOlxcL1xcL3d3d1xcLm5vdGlvblxcLnNvXFwvKFtcXHcuLV0rP1xcLyk/KFtcXHctXSspKD86XFw/cHZzPVtcXHctXSspPyg/OiNbXFx3LV0rKT8vZztcbiAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICB3aGlsZSAoKG1hdGNoID0gbm90aW9uVXJsUmVnZXguZXhlYyhyZXNvbHZlZEV2ZW50LmRlc2NyaXB0aW9uKSkgIT09IG51bGwpIHtcbiAgICAgICAgICBjb25zdCBwb3RlbnRpYWxJZCA9IG1hdGNoWzJdLnNwbGl0KCctJykucG9wKCk7XG4gICAgICAgICAgaWYgKHBvdGVudGlhbElkICYmIHBvdGVudGlhbElkLmxlbmd0aCA+PSAzMikgeyBleHBsaWNpdE5vdGlvbkxpbmtQYWdlSWRzLmFkZChwb3RlbnRpYWxJZC5yZXBsYWNlKC9bXmEtZjAtOV0vZ2ksICcnKSk7IH1cbiAgICAgICAgfVxuICAgICAgICBpZihleHBsaWNpdE5vdGlvbkxpbmtQYWdlSWRzLnNpemUgPiAwKSBsb2dnZXIuaW5mbyhgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBGb3VuZCAke2V4cGxpY2l0Tm90aW9uTGlua1BhZ2VJZHMuc2l6ZX0gdW5pcXVlIE5vdGlvbiBwYWdlIElEcyBmcm9tIGRlc2NyaXB0aW9uLmApO1xuICAgICAgICBmb3IgKGNvbnN0IHBhZ2VJZCBvZiBleHBsaWNpdE5vdGlvbkxpbmtQYWdlSWRzKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHBhZ2VTdW1tYXJ5UmVzcG9uc2UgPSBhd2FpdCBnZXROb3Rpb25QYWdlU3VtbWFyeUJ5SWQoaW5wdXQudXNlcklkLCBwYWdlSWQpO1xuICAgICAgICAgICAgaWYgKHBhZ2VTdW1tYXJ5UmVzcG9uc2Uub2sgJiYgcGFnZVN1bW1hcnlSZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgICAgIG5vdGlvblBhZ2VNYXAuc2V0KHBhZ2VTdW1tYXJ5UmVzcG9uc2UuZGF0YS5pZCwgcGFnZVN1bW1hcnlSZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSB7IGRhdGFGZXRjaGluZ0Vycm9ycy5wdXNoKGBGYWlsZWQgdG8gZmV0Y2ggTm90aW9uIHBhZ2UgJHtwYWdlSWR9IGZyb20gbGluazogJHtwYWdlU3VtbWFyeVJlc3BvbnNlLmVycm9yPy5tZXNzYWdlfWApOyB9XG4gICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7IGRhdGFGZXRjaGluZ0Vycm9ycy5wdXNoKGBFcnJvciBmZXRjaGluZyBOb3Rpb24gcGFnZSAke3BhZ2VJZH06ICR7ZS5tZXNzYWdlfWApOyB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgdGl0bGVLZXl3b3JkcyA9IHRoaXMuX2V4dHJhY3RLZXl3b3JkcyhyZXNvbHZlZEV2ZW50LnRpdGxlLCAzLCA1KTsgLy8gVXNlZCBmb3IgTm90aW9uIGtleXdvcmQgc2VhcmNoICYgc2NvcmluZ1xuICAgICAgY29uc3QgZGVzY3JpcHRpb25LZXl3b3JkcyA9IHJlc29sdmVkRXZlbnQuZGVzY3JpcHRpb24gPyB0aGlzLl9leHRyYWN0S2V5d29yZHMocmVzb2x2ZWRFdmVudC5kZXNjcmlwdGlvbiwgMywgNykgOiBbXTsgLy8gVXNlZCBmb3IgTm90aW9uIGtleXdvcmQgc2VhcmNoICYgc2NvcmluZ1xuICAgICAgbGV0IGF0dGVuZGVlS2V5d29yZHM6IHN0cmluZ1tdID0gW107XG4gICAgICBpZiAocmVzb2x2ZWRFdmVudC5hdHRlbmRlZXMpIHtcbiAgICAgICAgY29uc3QgYXR0ZW5kZWVOYW1lcyA9IHJlc29sdmVkRXZlbnQuYXR0ZW5kZWVzLm1hcChhdHQgPT4gYXR0LnNwbGl0KCc8JylbMF0udHJpbSgpLnNwbGl0KC9cXHMrLykuc2xpY2UoMCwyKS5qb2luKCcgJykpLmpvaW4oJyAnKTtcbiAgICAgICAgYXR0ZW5kZWVLZXl3b3JkcyA9IHRoaXMuX2V4dHJhY3RLZXl3b3JkcyhhdHRlbmRlZU5hbWVzLCAzLCA1KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbWJpbmVkS2V5d29yZHNGb3JOb3Rpb24gPSBuZXcgU2V0KFsuLi50aXRsZUtleXdvcmRzLCAuLi5kZXNjcmlwdGlvbktleXdvcmRzLCAuLi5hdHRlbmRlZUtleXdvcmRzXSk7XG4gICAgICBjb25zdCBub3Rpb25LZXl3b3JkUXVlcnlUZXh0ID0gQXJyYXkuZnJvbShjb21iaW5lZEtleXdvcmRzRm9yTm90aW9uKS5qb2luKCcgJyk7XG4gICAgICBpZiAobm90aW9uS2V5d29yZFF1ZXJ5VGV4dC50cmltKCkubGVuZ3RoID4gMCkge1xuICAgICAgICBsb2dnZXIuaW5mbyhgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBOb3Rpb24ga2V5d29yZCBxdWVyeTogXCIke25vdGlvbktleXdvcmRRdWVyeVRleHR9XCJgKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBzZWFyY2hMaW1pdCA9IE1hdGgubWF4KDAsIDUgLSBub3Rpb25QYWdlTWFwLnNpemUpO1xuICAgICAgICAgIGlmIChzZWFyY2hMaW1pdCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5vdGlvblNlYXJjaFJlc3BvbnNlID0gYXdhaXQgc2VhcmNoTm90aW9uTm90ZXMoaW5wdXQudXNlcklkLCBub3Rpb25LZXl3b3JkUXVlcnlUZXh0LCBOT1RJT05fTk9URVNfREFUQUJBU0VfSUQgfHwgdW5kZWZpbmVkLCBzZWFyY2hMaW1pdCk7XG4gICAgICAgICAgICBsb2dnZXIuaW5mbyhgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBOb3Rpb24ga2V5d29yZCBzZWFyY2ggdXNpbmcgREIgSUQ6ICR7Tk9USU9OX05PVEVTX0RBVEFCQVNFX0lEIHx8ICdOb25lIChiYWNrZW5kIGRlZmF1bHQpJ31gKTtcbiAgICAgICAgICAgIGlmIChub3Rpb25TZWFyY2hSZXNwb25zZS5vayAmJiBub3Rpb25TZWFyY2hSZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgICAgIG5vdGlvblNlYXJjaFJlc3BvbnNlLmRhdGEuZm9yRWFjaChwYWdlID0+IHsgaWYgKCFub3Rpb25QYWdlTWFwLmhhcyhwYWdlLmlkKSkgbm90aW9uUGFnZU1hcC5zZXQocGFnZS5pZCwgcGFnZSk7IH0pO1xuICAgICAgICAgICAgfSBlbHNlIHsgZGF0YUZldGNoaW5nRXJyb3JzLnB1c2goYE5vdGlvbiBrZXl3b3JkIHNlYXJjaCBmYWlsZWQ6ICR7bm90aW9uU2VhcmNoUmVzcG9uc2UuZXJyb3I/Lm1lc3NhZ2V9YCk7IH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGU6IGFueSkgeyBkYXRhRmV0Y2hpbmdFcnJvcnMucHVzaChgRXJyb3IgaW4gTm90aW9uIGtleXdvcmQgc2VhcmNoOiAke2UubWVzc2FnZX1gKTsgfVxuICAgICAgfVxuICAgICAgcmVsYXRlZE5vdGlvblBhZ2VzID0gQXJyYXkuZnJvbShub3Rpb25QYWdlTWFwLnZhbHVlcygpKTtcblxuICAgICAgY29uc3QgZ0RyaXZlRmlsZUlkc0Zyb21EZXNjcmlwdGlvbiA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgaWYgKHJlc29sdmVkRXZlbnQuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgY29uc3QgZ0RyaXZlVXJsUmVnZXggPSAvaHR0cHM6XFwvXFwvKD86ZHJpdmVcXC5nb29nbGVcXC5jb21cXC8oPzpmaWxlXFwvZFxcL3xvcGVuXFw/aWQ9KXxkb2NzXFwuZ29vZ2xlXFwuY29tXFwvKD86ZG9jdW1lbnRcXC9kXFwvfHNwcmVhZHNoZWV0c1xcL2RcXC98cHJlc2VudGF0aW9uXFwvZFxcLykpKFtcXHctXSspL2c7XG4gICAgICAgIGxldCBnRHJpdmVNYXRjaDtcbiAgICAgICAgd2hpbGUgKChnRHJpdmVNYXRjaCA9IGdEcml2ZVVybFJlZ2V4LmV4ZWMocmVzb2x2ZWRFdmVudC5kZXNjcmlwdGlvbikpICE9PSBudWxsKSB7XG4gICAgICAgICAgaWYgKGdEcml2ZU1hdGNoWzFdKSBnRHJpdmVGaWxlSWRzRnJvbURlc2NyaXB0aW9uLmFkZChnRHJpdmVNYXRjaFsxXSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdEcml2ZUZpbGVJZHNGcm9tRGVzY3JpcHRpb24uc2l6ZSA+IDApIGxvZ2dlci5pbmZvKGBTbWFydE1lZXRpbmdQcmVwU2tpbGw6IEZvdW5kIEdEcml2ZSBmaWxlIElEcyBpbiBkZXNjcmlwdGlvbjogWyR7QXJyYXkuZnJvbShnRHJpdmVGaWxlSWRzRnJvbURlc2NyaXB0aW9uKS5qb2luKCcsICcpfV1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGlua2VkR0RyaXZlRmlsZXNNZXRhZGF0YTogR29vZ2xlRHJpdmVGaWxlW10gPSBbXTtcbiAgICAgIGlmIChnRHJpdmVGaWxlSWRzRnJvbURlc2NyaXB0aW9uLnNpemUgPiAwICYmIEF1dGhTZXJ2aWNlICYmIGdldEdvb2dsZURyaXZlRmlsZU1ldGFkYXRhKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBTbWFydE1lZXRpbmdQcmVwU2tpbGw6IEZldGNoaW5nIG1ldGFkYXRhIGZvciAke2dEcml2ZUZpbGVJZHNGcm9tRGVzY3JpcHRpb24uc2l6ZX0gR0RyaXZlIGZpbGUgSURzIHVzaW5nIGdldEdvb2dsZURyaXZlRmlsZU1ldGFkYXRhLmApO1xuICAgICAgICBmb3IgKGNvbnN0IGZpbGVJZCBvZiBnRHJpdmVGaWxlSWRzRnJvbURlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhUmVzcCA9IGF3YWl0IGdldEdvb2dsZURyaXZlRmlsZU1ldGFkYXRhKGlucHV0LnVzZXJJZCwgZmlsZUlkKTsgLy8gVXNpbmcgdGhlIG5ldyBkaXJlY3QgbWV0YWRhdGEgZmV0Y2ggc2tpbGxcbiAgICAgICAgICAgIGlmIChtZXRhZGF0YVJlc3Aub2sgJiYgbWV0YWRhdGFSZXNwLmRhdGEpIHtcbiAgICAgICAgICAgICAgbGlua2VkR0RyaXZlRmlsZXNNZXRhZGF0YS5wdXNoKG1ldGFkYXRhUmVzcC5kYXRhKTtcbiAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oYFNtYXJ0TWVldGluZ1ByZXBTa2lsbDogU3VjY2Vzc2Z1bGx5IGZldGNoZWQgR0RyaXZlIG1ldGFkYXRhIGZvcjogJHttZXRhZGF0YVJlc3AuZGF0YS5uYW1lfSAoSUQ6ICR7ZmlsZUlkfSlgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnN0IGVycm9yTXNnID0gYEZhaWxlZCB0byBnZXQgbWV0YWRhdGEgZm9yIEdEcml2ZSBmaWxlIElEICR7ZmlsZUlkfTogJHttZXRhZGF0YVJlc3AuZXJyb3I/Lm1lc3NhZ2V9YDtcbiAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oYFNtYXJ0TWVldGluZ1ByZXBTa2lsbDogJHtlcnJvck1zZ31gKTsgZGF0YUZldGNoaW5nRXJyb3JzLnB1c2goZXJyb3JNc2cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICAgICAgY29uc3QgZXJyb3JNc2cgPSBgRXJyb3IgY2FsbGluZyBnZXRHb29nbGVEcml2ZUZpbGVNZXRhZGF0YSBmb3IgR0RyaXZlIGZpbGUgSUQgJHtmaWxlSWR9OiAke2UubWVzc2FnZX1gO1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBTbWFydE1lZXRpbmdQcmVwU2tpbGw6ICR7ZXJyb3JNc2d9YCwgZSk7IGRhdGFGZXRjaGluZ0Vycm9ycy5wdXNoKGVycm9yTXNnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGxpbmtlZEdEcml2ZUZpbGVzTWV0YWRhdGEubGVuZ3RoID4gMCAmJiB0cmlnZ2VyR29vZ2xlRHJpdmVGaWxlSW5nZXN0aW9uKSB7XG4gICAgICAgICAgbG9nZ2VyLmluZm8oYFNtYXJ0TWVldGluZ1ByZXBTa2lsbDogVHJpZ2dlcmluZyBpbmdlc3Rpb24gZm9yICR7bGlua2VkR0RyaXZlRmlsZXNNZXRhZGF0YS5sZW5ndGh9IEdEcml2ZSBmaWxlcy5gKTtcbiAgICAgICAgICBsaW5rZWRHRHJpdmVGaWxlc01ldGFkYXRhLmZvckVhY2goZmlsZSA9PiB7XG4gICAgICAgICAgICBnZHJpdmVGaWxlc1RyaWdnZXJlZC5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgdHJpZ2dlckdvb2dsZURyaXZlRmlsZUluZ2VzdGlvbihpbnB1dC51c2VySWQsIGZpbGUuaWQsXG4gICAgICAgICAgICAgIHsgbmFtZTogZmlsZS5uYW1lLCBtaW1lVHlwZTogZmlsZS5taW1lVHlwZSwgd2ViVmlld0xpbms6IGZpbGUud2ViVmlld0xpbmsgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnRoZW4oaW5nZXN0aW9uUmVzID0+IHtcbiAgICAgICAgICAgICAgaWYgKCFpbmdlc3Rpb25SZXMub2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJNc2cgPSBgR0RyaXZlIGluZ2VzdGlvbiB0cmlnZ2VyIGZhaWxlZCBmb3IgJHtmaWxlLmlkfSAoJHtmaWxlLm5hbWV9KTogJHtpbmdlc3Rpb25SZXMuZXJyb3I/Lm1lc3NhZ2V9YDtcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybihgU21hcnRNZWV0aW5nUHJlcFNraWxsOiAke2Vyck1zZ31gKTsgZGF0YUZldGNoaW5nRXJyb3JzLnB1c2goZXJyTXNnKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBHRHJpdmUgaW5nZXN0aW9uIHN1Y2Nlc3NmdWxseSB0cmlnZ2VyZWQgZm9yICR7ZmlsZS5pZH0gKCR7ZmlsZS5uYW1lfSkuIE5ldyBEb2MgSUQ6ICR7aW5nZXN0aW9uUmVzLmRhdGE/LmRvY19pZH1gKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBlcnJNc2cgPSBgRXJyb3IgY2FsbGluZyB0cmlnZ2VyR29vZ2xlRHJpdmVGaWxlSW5nZXN0aW9uIGZvciAke2ZpbGUuaWR9ICgke2ZpbGUubmFtZX0pOiAke2Vyci5tZXNzYWdlfWA7XG4gICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgU21hcnRNZWV0aW5nUHJlcFNraWxsOiAke2Vyck1zZ31gLCBlcnIpOyBkYXRhRmV0Y2hpbmdFcnJvcnMucHVzaChlcnJNc2cpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1lZXRpbmdTdGFydERhdGUgPSBuZXcgRGF0ZShyZXNvbHZlZEV2ZW50LnN0YXJ0VGltZSk7XG4gICAgICBjb25zdCBldmVudFRpdGxlS2V5d29yZHMgPSB0aGlzLl9leHRyYWN0S2V5d29yZHMocmVzb2x2ZWRFdmVudC50aXRsZSwgMiwgNSk7XG4gICAgICBjb25zdCBldmVudERlc2NLZXl3b3JkcyA9IHJlc29sdmVkRXZlbnQuZGVzY3JpcHRpb24gPyB0aGlzLl9leHRyYWN0S2V5d29yZHMocmVzb2x2ZWRFdmVudC5kZXNjcmlwdGlvbiwgMywgNSkgOiBbXTtcbiAgICAgIGNvbnN0IGV2ZW50QXR0ZW5kZWVFbWFpbHMgPSB0aGlzLl9nZXRBdHRlbmRlZUVtYWlscyhyZXNvbHZlZEV2ZW50LmF0dGVuZGVlcyk7XG4gICAgICBjb25zdCBzY29yZWRFbWFpbHMgPSByZWxhdGVkRW1haWxzLm1hcChlbWFpbCA9PiAoeyBpdGVtOiBlbWFpbCwgc2NvcmU6IHRoaXMuX3Njb3JlRW1haWxSZWxldmFuY2UoZW1haWwsIGV2ZW50VGl0bGVLZXl3b3JkcywgZXZlbnREZXNjS2V5d29yZHMsIGV2ZW50QXR0ZW5kZWVFbWFpbHMsIG1lZXRpbmdTdGFydERhdGUpIH0pKS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XG4gICAgICBjb25zdCBzY29yZWROb3Rpb25QYWdlcyA9IHJlbGF0ZWROb3Rpb25QYWdlcy5tYXAocGFnZSA9PiAoeyBpdGVtOiBwYWdlLCBzY29yZTogdGhpcy5fc2NvcmVOb3Rpb25QYWdlUmVsZXZhbmNlKHBhZ2UsIGV2ZW50VGl0bGVLZXl3b3JkcywgZXZlbnREZXNjS2V5d29yZHMsIG1lZXRpbmdTdGFydERhdGUsIGV4cGxpY2l0Tm90aW9uTGlua1BhZ2VJZHMuaGFzKHBhZ2UuaWQpKSB9KSkuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICAgICAgY29uc3QgdG9wRW1haWxzID0gc2NvcmVkRW1haWxzLnNsaWNlKDAsIDMpO1xuICAgICAgY29uc3QgdG9wTm90aW9uUGFnZXMgPSBzY29yZWROb3Rpb25QYWdlcy5zbGljZSgwLCAyKTtcbiAgICAgIC8vIExvZ2dpbmcgZm9yIHRvcCBpdGVtc1xuICAgICAgdG9wRW1haWxzLmZvckVhY2goKHNlLCBpZHgpID0+IGxvZ2dlci5pbmZvKGBUb3BFbWFpbFske2lkeH1dIChTY29yZTogJHtzZS5zY29yZS50b0ZpeGVkKDEpfSk6ICR7c2UuaXRlbS5zdWJqZWN0Py5zdWJzdHJpbmcoMCw1MCl9Li4uIChGcm9tOiAke3NlLml0ZW0uZnJvbX0pYCkpO1xuICAgICAgdG9wTm90aW9uUGFnZXMuZm9yRWFjaCgoc3AsIGlkeCkgPT4gbG9nZ2VyLmluZm8oYFRvcE5vdGlvblske2lkeH1dIChTY29yZTogJHtzcC5zY29yZS50b0ZpeGVkKDEpfSk6ICR7c3AuaXRlbS50aXRsZT8uc3Vic3RyaW5nKDAsNTApfS4uLiAoRXhwbGljaXRMaW5rOiAke2V4cGxpY2l0Tm90aW9uTGlua1BhZ2VJZHMuaGFzKHNwLml0ZW0uaWQpfSlgKSk7XG5cbiAgICAgIGNvbnN0IHNlYXJjaFF1ZXJ5VGV4dCA9IHJlc29sdmVkRXZlbnQudGl0bGUgKyAoZXZlbnREZXNjS2V5d29yZHMubGVuZ3RoID4gMCA/IFwiIFwiICsgZXZlbnREZXNjS2V5d29yZHMuam9pbihcIiBcIikgOiBcIlwiKTtcbiAgICAgIGlmIChzZWFyY2hRdWVyeVRleHQudHJpbSgpICYmIHBlcmZvcm1IeWJyaWRTZWFyY2hXaXRoTkxVKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gVXNpbmcgdGhlIG5ldyBOTFUtcG93ZXJlZCBoeWJyaWQgc2VhcmNoIG9yY2hlc3RyYXRvclxuICAgICAgICAgIGNvbnN0IGh5YnJpZFNlYXJjaFJlc3BvbnNlID0gYXdhaXQgcGVyZm9ybUh5YnJpZFNlYXJjaFdpdGhOTFUoaW5wdXQudXNlcklkLCBzZWFyY2hRdWVyeVRleHQsIHsgc2VtYW50aWNMaW1pdDogNSwga2V5d29yZExpbWl0OiAxMCB9KTtcbiAgICAgICAgICBpZiAoaHlicmlkU2VhcmNoUmVzcG9uc2Uub2sgJiYgaHlicmlkU2VhcmNoUmVzcG9uc2UuZGF0YSkge1xuICAgICAgICAgICAgaHlicmlkU2VhcmNoUmVzdWx0cyA9IGh5YnJpZFNlYXJjaFJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGFGZXRjaGluZ0Vycm9ycy5wdXNoKGBIeWJyaWQgc2VhcmNoIGZhaWxlZDogJHtoeWJyaWRTZWFyY2hSZXNwb25zZS5lcnJvcj8ubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgICAgICBkYXRhRmV0Y2hpbmdFcnJvcnMucHVzaChgSHlicmlkIHNlYXJjaCBleGVjdXRpb24gZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIERlLWR1cGxpY2F0aW9uIGxvZ2ljIGFnYWluc3QgaXRlbXMgZmV0Y2hlZCB2aWEgc3BlY2lmaWMgc2tpbGxzIChlLmcuIHJlY2VudCBlbWFpbHMpXG4gICAgICBjb25zdCBleGlzdGluZ0l0ZW1JZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgIHJlbGF0ZWRFbWFpbHMuZm9yRWFjaChlbWFpbCA9PiBleGlzdGluZ0l0ZW1JZHMuYWRkKGVtYWlsLmlkKSk7XG4gICAgICByZWxhdGVkTm90aW9uUGFnZXMuZm9yRWFjaChwYWdlID0+IGV4aXN0aW5nSXRlbUlkcy5hZGQocGFnZS5pZCkpO1xuICAgICAgLy8gVGhlIGJhY2tlbmQgYWxyZWFkeSBkZS1kdXBsaWNhdGVzIGJldHdlZW4gc2VtYW50aWMva2V5d29yZCwgYnV0IHdlIGFsc28gZGUtZHVwbGljYXRlIGFnYWluc3QgaXRlbXMgZmV0Y2hlZCBieSBvdGhlciBtZWFucy5cbiAgICAgIHVuaXF1ZUh5YnJpZFNlYXJjaFJlc3VsdHMgPSBoeWJyaWRTZWFyY2hSZXN1bHRzLmZpbHRlcihpdGVtID0+IHtcbiAgICAgICAgLy8gZG9jX2lkIGZvciBhIE1laWxpL0xhbmNlREIgZG9jdW1lbnQgbWlnaHQgY29ycmVzcG9uZCB0byBhbiBlbWFpbCAnaWQnIG9yIG5vdGlvbiAnaWQnXG4gICAgICAgIC8vIEZvciBub3csIHdlIGFzc3VtZSB0aGUgYmFja2VuZCBzZWFyY2ggaW5kZXhlcyB0aGVzZSB3aXRoIGNvbnNpc3RlbnQgSURzLlxuICAgICAgICAvLyBXZSBhbHNvIHdhbnQgdG8gZW5zdXJlIHdlIGRvbid0IHNob3cgYSBrZXl3b3JkIG1hdGNoIGZvciBhbiBlbWFpbCBpZiB3ZSBhbHJlYWR5IGhhdmUgaXQgZnJvbSB0aGUgZGlyZWN0IGBzZWFyY2hFbWFpbHNGb3JQcmVwYCBjYWxsLlxuICAgICAgICBpZiAoaXRlbS5kb2NfdHlwZSA9PT0gJ2VtYWlsX3NuaXBwZXQnIHx8IGl0ZW0uZG9jX3R5cGUgPT09ICdub3Rpb25fc3VtbWFyeScpIHtcbiAgICAgICAgICByZXR1cm4gIWV4aXN0aW5nSXRlbUlkcy5oYXMoaXRlbS5kb2NfaWQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlOyAvLyBLZWVwIGFsbCBvdGhlciB0eXBlcyBsaWtlIGRvY3VtZW50X2NodW5rc1xuICAgICAgfSk7XG4gICAgICBpZiAoaHlicmlkU2VhcmNoUmVzdWx0cy5sZW5ndGggIT09IHVuaXF1ZUh5YnJpZFNlYXJjaFJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBTbWFydE1lZXRpbmdQcmVwU2tpbGw6IERlLWR1cGxpY2F0ZWQgaHlicmlkIHJlc3VsdHMgYWdhaW5zdCBvdGhlciBzb3VyY2VzLiBPcmlnaW5hbDogJHtoeWJyaWRTZWFyY2hSZXN1bHRzLmxlbmd0aH0sIFVuaXF1ZTogJHt1bmlxdWVIeWJyaWRTZWFyY2hSZXN1bHRzLmxlbmd0aH1gKTtcbiAgICAgIH1cblxuICAgICAgcHJlcGFyYXRpb25Ob3RlcyA9IGF3YWl0IHRoaXMuX2dlbmVyYXRlUHJlcGFyYXRpb25Ob3RlcyhcbiAgICAgICAgcmVzb2x2ZWRFdmVudCxcbiAgICAgICAgcmVsYXRlZERvY3VtZW50cyxcbiAgICAgICAgcmVsYXRlZEVtYWlscyxcbiAgICAgICAgcmVsYXRlZE5vdGlvblBhZ2VzLFxuICAgICAgICBkYXRhRmV0Y2hpbmdFcnJvcnMsXG4gICAgICAgIHRvcEVtYWlscy5tYXAoZSA9PiBlLml0ZW0pLFxuICAgICAgICB0b3BOb3Rpb25QYWdlcy5tYXAocCA9PiBwLml0ZW0pLFxuICAgICAgICBldmVudFRpdGxlS2V5d29yZHMsXG4gICAgICAgIGV2ZW50RGVzY0tleXdvcmRzLFxuICAgICAgICBnZHJpdmVGaWxlc1RyaWdnZXJlZCxcbiAgICAgICAgdW5pcXVlSHlicmlkU2VhcmNoUmVzdWx0cyAvLyBQYXNzIHRoZSBuZXcgaHlicmlkIHJlc3VsdHMgYXJyYXlcbiAgICAgICk7XG4gICAgICBsb2dnZXIuaW5mbyhgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBQcmVwIG1hdGVyaWFscyBnZW5lcmF0ZWQgZm9yIFwiJHtyZXNvbHZlZEV2ZW50LnRpdGxlfVwiLmApO1xuXG4gICAgICBjb25zdCBzdG9yYWdlUHJvbWlzZXMgPSBbXTtcbiAgICAgIGlmIChyZWxhdGVkRW1haWxzLmxlbmd0aCA+IDApIHsgZm9yIChjb25zdCBlbWFpbCBvZiByZWxhdGVkRW1haWxzKSB7IHN0b3JhZ2VQcm9taXNlcy5wdXNoKHN0b3JlRW1haWxTbmlwcGV0SW5MYW5jZURiKGlucHV0LnVzZXJJZCwgZW1haWwpLmNhdGNoKGVyciA9PiBsb2dnZXIuZXJyb3IoYExhbmNlREIgc3RvcmVFbWFpbCBlcnJvciBmb3IgJHtlbWFpbC5pZH06ICR7ZXJyLm1lc3NhZ2V9YCkpKTsgfSB9XG4gICAgICBpZiAocmVsYXRlZE5vdGlvblBhZ2VzLmxlbmd0aCA+IDApIHsgZm9yIChjb25zdCBwYWdlIG9mIHJlbGF0ZWROb3Rpb25QYWdlcykgeyBzdG9yYWdlUHJvbWlzZXMucHVzaChzdG9yZU5vdGlvblBhZ2VTdW1tYXJ5SW5MYW5jZURiKGlucHV0LnVzZXJJZCwgcGFnZSkuY2F0Y2goZXJyID0+IGxvZ2dlci5lcnJvcihgTGFuY2VEQiBzdG9yZU5vdGlvbiBlcnJvciBmb3IgJHtwYWdlLmlkfTogJHtlcnIubWVzc2FnZX1gKSkpOyB9IH1cbiAgICAgIGlmIChzdG9yYWdlUHJvbWlzZXMubGVuZ3RoID4gMCkgeyBQcm9taXNlLmFsbFNldHRsZWQoc3RvcmFnZVByb21pc2VzKS50aGVuKCgpID0+IGxvZ2dlci5pbmZvKFwiTGFuY2VEQiBzdG9yYWdlIGF0dGVtcHRzIChlbWFpbHMsIG5vdGlvbikgY29tcGxldGVkLlwiKSk7IH1cblxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIud2FybihgU21hcnRNZWV0aW5nUHJlcFNraWxsOiBDb3VsZCBub3QgcmVzb2x2ZSBldmVudCBmb3IgXCIke2lucHV0Lm1lZXRpbmdfcmVmZXJlbmNlfVwiLmApO1xuICAgICAgcHJlcGFyYXRpb25Ob3RlcyA9IGBDb3VsZCBub3QgcmVzb2x2ZSBhIHNwZWNpZmljIGNhbGVuZGFyIGV2ZW50IGZvciByZWZlcmVuY2U6IFwiJHtpbnB1dC5tZWV0aW5nX3JlZmVyZW5jZX1cIi4gUGxlYXNlIHRyeSBhIG1vcmUgc3BlY2lmaWMgcXVlcnkuYDtcbiAgICB9XG5cbiAgICBjb25zdCBvdXRwdXQ6IFNtYXJ0TWVldGluZ1ByZXBTa2lsbE91dHB1dCA9IHtcbiAgICAgIHJlc29sdmVkRXZlbnQsIHJlbGF0ZWREb2N1bWVudHMsIHJlbGF0ZWRFbWFpbHMsIHJlbGF0ZWROb3Rpb25QYWdlcyxcbiAgICAgIGh5YnJpZFNlYXJjaFJlc3VsdHM6IHVuaXF1ZUh5YnJpZFNlYXJjaFJlc3VsdHMsIC8vIENoYW5nZWQgZnJvbSBzZW1hbnRpY2FsbHlSZWxhdGVkSXRlbXNcbiAgICAgIGdkcml2ZUZpbGVzVHJpZ2dlcmVkOiBnZHJpdmVGaWxlc1RyaWdnZXJlZCxcbiAgICAgIHByZXBhcmF0aW9uTm90ZXMsXG4gICAgICBkYXRhRmV0Y2hpbmdFcnJvcnNcbiAgICB9O1xuICAgIGxvZ2dlci5pbmZvKFwiW1NtYXJ0TWVldGluZ1ByZXBTa2lsbC5leGVjdXRlXSBGaW5hbCBvdXRwdXQgZ2VuZXJhdGVkLlwiKTtcbiAgICByZXR1cm4gb3V0cHV0O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBfZmluZFJlbGF0ZWREb2N1bWVudHMoZXZlbnQ6IENhbGVuZGFyRXZlbnRTdW1tYXJ5KTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIGxvZ2dlci5pbmZvKGBbU21hcnRNZWV0aW5nUHJlcFNraWxsLl9maW5kUmVsYXRlZERvY3VtZW50c10gRHluYW1pY2FsbHkgZmluZGluZyBtb2NrIGRvY3VtZW50cyBmb3IgZXZlbnQ6IFwiJHtldmVudC50aXRsZX1cIiAoSUQ6ICR7ZXZlbnQuaWR9KWApO1xuICAgIGNvbnN0IG1vY2tEb2NzOiBhbnlbXSA9IFtdOyBjb25zdCB0aXRsZUxvd2VyID0gZXZlbnQudGl0bGUudG9Mb3dlckNhc2UoKTsgY29uc3QgZGVzY3JpcHRpb25Mb3dlciA9IGV2ZW50LmRlc2NyaXB0aW9uPy50b0xvd2VyQ2FzZSgpIHx8IFwiXCI7XG4gICAgaWYgKHRpdGxlTG93ZXIuaW5jbHVkZXMoXCJidWRnZXRcIikgfHwgZGVzY3JpcHRpb25Mb3dlci5pbmNsdWRlcyhcImJ1ZGdldFwiKSkgbW9ja0RvY3MucHVzaCh7IG5hbWU6IGBCdWRnZXQgT3ZlcnZpZXcgZm9yICR7ZXZlbnQudGl0bGV9Lnhsc3hgLCB1cmw6IGBpbnRlcm5hbDovL2ZpbmFuY2UvYnVkZ2V0LSR7ZXZlbnQuaWR9Lnhsc3hgLCB0eXBlOiBcInNwcmVhZHNoZWV0XCIgfSk7XG4gICAgaWYgKHRpdGxlTG93ZXIuaW5jbHVkZXMoXCJwaG9lbml4XCIpIHx8IGRlc2NyaXB0aW9uTG93ZXIuaW5jbHVkZXMoXCJwaG9lbml4XCIpKSBtb2NrRG9jcy5wdXNoKHsgbmFtZTogYFByb2plY3QgUGhvZW5peCBTdGF0dXMgLSAke2V2ZW50LmlkfS5wcHR4YCwgdXJsOiBgaW50ZXJuYWw6Ly9wcm9qZWN0cy9waG9lbml4L3N0YXR1cy0ke2V2ZW50LmlkfS5wcHR4YCwgdHlwZTogXCJwcmVzZW50YXRpb25cIiB9KTtcbiAgICBpZiAodGl0bGVMb3dlci5pbmNsdWRlcyhcIm1hcmtldGluZ1wiKSB8fCB0aXRsZUxvd2VyLmluY2x1ZGVzKFwic3RyYXRlZ3lcIikgfHwgZGVzY3JpcHRpb25Mb3dlci5pbmNsdWRlcyhcIm1hcmtldGluZ1wiKSB8fCBkZXNjcmlwdGlvbkxvd2VyLmluY2x1ZGVzKFwic3RyYXRlZ3lcIikpIG1vY2tEb2NzLnB1c2goeyBuYW1lOiBgTWFya2V0aW5nIFN0cmF0ZWd5IEJyaWVmIC0gJHtldmVudC5pZH0ucGRmYCwgdXJsOiBgaW50ZXJuYWw6Ly9tYXJrZXRpbmcvc3RyYXRlZ3ktJHtldmVudC5pZH0ucGRmYCwgdHlwZTogXCJwZGZcIiB9KTtcbiAgICBpZiAoZXZlbnQuYXR0ZW5kZWVzKSB7IGZvciAoY29uc3QgYXR0ZW5kZWVTdHJpbmcgb2YgZXZlbnQuYXR0ZW5kZWVzKSB7IGNvbnN0IG5hbWVQYXJ0ID0gYXR0ZW5kZWVTdHJpbmcuc3BsaXQoJzwnKVswXS50cmltKCkudG9Mb3dlckNhc2UoKTsgY29uc3Qgc2ltcGxlTmFtZSA9IG5hbWVQYXJ0LnNwbGl0KCcgJylbMF07IGlmIChzaW1wbGVOYW1lID09PSBcImFsaWNlXCIpIG1vY2tEb2NzLnB1c2goeyBuYW1lOiBgQWxpY2UncyBBY3Rpb24gSXRlbXMgZnJvbSBwcmV2aW91cyBzZXNzaW9ucy50eHRgLCB1cmw6IGBpbnRlcm5hbDovL3VzZXJzL2FsaWNlL2FjdGlvbnMtJHtldmVudC5pZH0udHh0YCwgdHlwZTogXCJ0ZXh0XCIgfSk7IGlmIChzaW1wbGVOYW1lID09PSBcIm1hcmtcIikgbW9ja0RvY3MucHVzaCh7IG5hbWU6IGBNYXJrJ3MgUHJvcG9zYWwgRHJhZnQgZm9yICR7ZXZlbnQudGl0bGV9LmRvY3hgLCB1cmw6IGBpbnRlcm5hbDovL3VzZXJzL21hcmsvZHJhZnRzL3Byb3AtJHtldmVudC5pZH0uZG9jeGAsIHR5cGU6IFwiZG9jdW1lbnRcIiB9KTsgaWYgKHNpbXBsZU5hbWUgPT09IFwic2FyYWhcIiAmJiB0aXRsZUxvd2VyLmluY2x1ZGVzKFwiMToxXCIpKSBtb2NrRG9jcy5wdXNoKHsgbmFtZTogYFBlcmZvcm1hbmNlIFJldmlldyBOb3RlcyAtIFNhcmFoIE1pbGxlci5wZGZgLCB1cmw6IGBpbnRlcm5hbDovL2hyL3Jldmlld3Mvc2FyYWhtLSR7ZXZlbnQuaWR9LnBkZmAsIHR5cGU6IFwiY29uZmlkZW50aWFsXCIgfSk7IH0gfVxuICAgIG1vY2tEb2NzLnB1c2goeyBuYW1lOiBgTWludXRlcyBmcm9tIGxhc3QgZ2VuZXJhbCBtZWV0aW5nIG9uICcke2V2ZW50LnRpdGxlfScucGRmYCwgdXJsOiBgaW50ZXJuYWw6Ly9tZWV0aW5ncy9taW51dGVzL3ByZXYtJHtldmVudC5pZH0ucGRmYCwgdHlwZTogXCJtaW51dGVzXCIgfSk7XG4gICAgaWYgKG1vY2tEb2NzLmxlbmd0aCA9PT0gMCkgbW9ja0RvY3MucHVzaCh7IG5hbWU6IGBTdGFuZGFyZCBBZ2VuZGEgVGVtcGxhdGUuZG9jeGAsIHVybDogXCJpbnRlcm5hbDovL3RlbXBsYXRlcy9hZ2VuZGEuZG9jeFwiLCB0eXBlOiBcInRlbXBsYXRlXCIgfSk7XG4gICAgY29uc3QgdW5pcXVlRG9jcyA9IEFycmF5LmZyb20obmV3IFNldChtb2NrRG9jcy5tYXAoZG9jID0+IGRvYy5uYW1lKSkpLm1hcChuYW1lID0+IG1vY2tEb2NzLmZpbmQoZG9jID0+IGRvYy5uYW1lID09PSBuYW1lKSk7XG4gICAgbG9nZ2VyLmluZm8oYFtTbWFydE1lZXRpbmdQcmVwU2tpbGwuX2ZpbmRSZWxhdGVkRG9jdW1lbnRzXSBGb3VuZCAke3VuaXF1ZURvY3MubGVuZ3RofSBtb2NrIGRvY3VtZW50cyBkeW5hbWljYWxseS5gKTtcbiAgICByZXR1cm4gdW5pcXVlRG9jcyEuc2xpY2UoMCwgNCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIF9nZW5lcmF0ZVByZXBhcmF0aW9uTm90ZXMoXG4gICAgZXZlbnQ6IENhbGVuZGFyRXZlbnRTdW1tYXJ5LCBkb2N1bWVudHM6IGFueVtdLCBlbWFpbHM6IEdtYWlsTWVzc2FnZVNuaXBwZXRbXSxcbiAgICBub3Rpb25QYWdlczogTm90aW9uUGFnZVN1bW1hcnlbXSwgZXJyb3JzOiBzdHJpbmdbXSwgdG9wRW1haWxzOiBHbWFpbE1lc3NhZ2VTbmlwcGV0W10sXG4gICAgdG9wTm90aW9uUGFnZXM6IE5vdGlvblBhZ2VTdW1tYXJ5W10sIGV2ZW50VGl0bGVLZXl3b3Jkczogc3RyaW5nW10sIGV2ZW50RGVzY0tleXdvcmRzOiBzdHJpbmdbXSxcbiAgICBnZHJpdmVGaWxlc1RyaWdnZXJlZD86IEdvb2dsZURyaXZlRmlsZVtdLFxuICAgIGh5YnJpZFNlYXJjaFJlc3VsdHM/OiBIeWJyaWRTZWFyY2hSZXN1bHRJdGVtW10gLy8gQ2hhbmdlZCBmcm9tIHNlbWFudGljYWxseVJlbGF0ZWRJdGVtc1xuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGxvZ2dlci5pbmZvKGBbU21hcnRNZWV0aW5nUHJlcFNraWxsLl9nZW5lcmF0ZVByZXBhcmF0aW9uTm90ZXNdIEdlbmVyYXRpbmcgbm90ZXMgZm9yIGV2ZW50OiBcIiR7ZXZlbnQudGl0bGV9XCIsIHdpdGggJHtlbWFpbHMubGVuZ3RofSB0b3RhbCBlbWFpbHMgKCR7dG9wRW1haWxzLmxlbmd0aH0gdG9wKSwgJHtub3Rpb25QYWdlcy5sZW5ndGh9IHRvdGFsIE5vdGlvbiBwYWdlcyAoJHt0b3BOb3Rpb25QYWdlcy5sZW5ndGh9IHRvcCksICR7Z2RyaXZlRmlsZXNUcmlnZ2VyZWQ/Lmxlbmd0aCB8fCAwfSBHRHJpdmUgZmlsZXMgdHJpZ2dlcmVkLCAke2h5YnJpZFNlYXJjaFJlc3VsdHM/Lmxlbmd0aCB8fCAwfSBoeWJyaWQgc2VhcmNoIGl0ZW1zLCBhbmQgJHtlcnJvcnMubGVuZ3RofSBlcnJvcnMuYCk7XG4gICAgY29uc3QgdGl0bGVMb3dlciA9IGV2ZW50LnRpdGxlLnRvTG93ZXJDYXNlKCk7IGNvbnN0IGRlc2NyaXB0aW9uTG93ZXIgPSBldmVudC5kZXNjcmlwdGlvbj8udG9Mb3dlckNhc2UoKSB8fCBcIlwiO1xuICAgIGxldCBub3RlcyA9IGAjIyBNZWV0aW5nIFByZXBhcmF0aW9uIE5vdGVzOiAke2V2ZW50LnRpdGxlfVxcblxcbmA7XG4gICAgaWYgKHRvcEVtYWlscy5sZW5ndGggPiAwIHx8IHRvcE5vdGlvblBhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIG5vdGVzICs9IFwi4pyoICoqS2V5IEhpZ2hsaWdodHMqKlxcblxcblwiO1xuICAgICAgaWYgKHRvcEVtYWlscy5sZW5ndGggPiAwKSB7XG4gICAgICAgIG5vdGVzICs9IFwiKipQb3RlbnRpYWxseSBSZWxldmFudCBFbWFpbHM6KipcXG5cIjtcbiAgICAgICAgdG9wRW1haWxzLmZvckVhY2goZW1haWwgPT4ge1xuICAgICAgICAgIGNvbnN0IGVtYWlsRGF0ZSA9IGVtYWlsLmRhdGUgPyBuZXcgRGF0ZShlbWFpbC5kYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoKSA6IFwiTi9BXCI7XG4gICAgICAgICAgY29uc3QgY29tYmluZWRLZXl3b3JkcyA9IFsuLi5ldmVudFRpdGxlS2V5d29yZHMsIC4uLmV2ZW50RGVzY0tleXdvcmRzXTtcbiAgICAgICAgICBjb25zdCBjb250ZXh0dWFsU25pcHBldCA9IHRoaXMuX2dldENvbnRleHR1YWxTbmlwcGV0KGVtYWlsLnNuaXBwZXQsIGNvbWJpbmVkS2V5d29yZHMpO1xuICAgICAgICAgIG5vdGVzICs9IGAtICoqU3ViamVjdDoqKiBcIiR7ZW1haWwuc3ViamVjdCB8fCAnKE5vIFN1YmplY3QpJ31cIiAoRnJvbTogJHtlbWFpbC5mcm9tIHx8ICdOL0EnfSwgRGF0ZTogJHtlbWFpbERhdGV9KVxcbmA7XG4gICAgICAgICAgaWYgKGNvbnRleHR1YWxTbmlwcGV0KSBub3RlcyArPSBgICAqQ29udGV4dHVhbCBTbmlwcGV0OiogJHtjb250ZXh0dWFsU25pcHBldH1cXG5gO1xuICAgICAgICAgIGVsc2UgaWYgKGVtYWlsLnNuaXBwZXQpIG5vdGVzICs9IGAgICpTbmlwcGV0OiogJHtlbWFpbC5zbmlwcGV0LnN1YnN0cmluZygwLDE1MCl9Li4uXFxuYDtcbiAgICAgICAgICBpZiAoZW1haWwubGluaykgbm90ZXMgKz0gYCAgKkxpbms6KiAke2VtYWlsLmxpbmt9XFxuYDtcbiAgICAgICAgfSk7XG4gICAgICAgIG5vdGVzICs9IFwiXFxuXCI7XG4gICAgICB9XG4gICAgICBpZiAodG9wTm90aW9uUGFnZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBub3RlcyArPSBcIioqUG90ZW50aWFsbHkgUmVsZXZhbnQgTm90aW9uIFBhZ2VzOioqXFxuXCI7XG4gICAgICAgIHRvcE5vdGlvblBhZ2VzLmZvckVhY2gocGFnZSA9PiB7XG4gICAgICAgICAgY29uc3QgY29tYmluZWRLZXl3b3JkcyA9IFsuLi5ldmVudFRpdGxlS2V5d29yZHMsIC4uLmV2ZW50RGVzY0tleXdvcmRzXTtcbiAgICAgICAgICBjb25zdCBjb250ZXh0dWFsUHJldmlldyA9IHRoaXMuX2dldENvbnRleHR1YWxTbmlwcGV0KHBhZ2UucHJldmlld190ZXh0LCBjb21iaW5lZEtleXdvcmRzKTtcbiAgICAgICAgICBub3RlcyArPSBgLSAqKlRpdGxlOioqIFwiJHtwYWdlLnRpdGxlIHx8ICdVbnRpdGxlZCBQYWdlJ31cImA7XG4gICAgICAgICAgaWYgKHBhZ2UubGFzdF9lZGl0ZWRfdGltZSkgbm90ZXMgKz0gYCAoTGFzdCBlZGl0ZWQ6ICR7bmV3IERhdGUocGFnZS5sYXN0X2VkaXRlZF90aW1lKS50b0xvY2FsZURhdGVTdHJpbmcoKX0pYDtcbiAgICAgICAgICBub3RlcyArPSBcIlxcblwiO1xuICAgICAgICAgIGlmIChjb250ZXh0dWFsUHJldmlldykgbm90ZXMgKz0gYCAgKkNvbnRleHR1YWwgUHJldmlldzoqICR7Y29udGV4dHVhbFByZXZpZXd9XFxuYDtcbiAgICAgICAgICBlbHNlIGlmIChwYWdlLnByZXZpZXdfdGV4dCkgbm90ZXMgKz0gYCAgKlByZXZpZXc6KiAke3BhZ2UucHJldmlld190ZXh0LnN1YnN0cmluZygwLDE1MCl9Li4uXFxuYDtcbiAgICAgICAgICBpZiAocGFnZS51cmwpIG5vdGVzICs9IGAgICpMaW5rOiogJHtwYWdlLnVybH1cXG5gO1xuICAgICAgICB9KTtcbiAgICAgICAgbm90ZXMgKz0gXCJcXG5cIjtcbiAgICAgIH1cbiAgICAgIG5vdGVzICs9IFwiLS0tXFxuXFxuXCI7XG4gICAgfVxuICAgIG5vdGVzICs9IGAqKlNjaGVkdWxlZDoqKiAke25ldyBEYXRlKGV2ZW50LnN0YXJ0VGltZSkudG9Mb2NhbGVTdHJpbmcoKX0gLSAke25ldyBEYXRlKGV2ZW50LmVuZFRpbWUpLnRvTG9jYWxlU3RyaW5nKCl9XFxuYDtcbiAgICBub3RlcyArPSBgKipMb2NhdGlvbjoqKiAke2V2ZW50LmxvY2F0aW9uIHx8IFwiTm90IHNwZWNpZmllZFwifVxcbmA7XG4gICAgbm90ZXMgKz0gYCoqT3JnYW5pemVyOioqICR7ZXZlbnQub3JnYW5pemVyIHx8IFwiTi9BXCJ9XFxuYDtcbiAgICBjb25zdCBhdHRlbmRlZUxpc3QgPSBldmVudC5hdHRlbmRlZXMgJiYgZXZlbnQuYXR0ZW5kZWVzLmxlbmd0aCA+IDAgPyBldmVudC5hdHRlbmRlZXMubWFwKGEgPT4gYS5zcGxpdCgnPCcpWzBdLnRyaW0oKSkuam9pbihcIiwgXCIpIDogXCJObyBhdHRlbmRlZXMgbGlzdGVkXCI7XG4gICAgbm90ZXMgKz0gYCoqQXR0ZW5kZWVzOioqICR7YXR0ZW5kZWVMaXN0fVxcblxcbmA7XG4gICAgaWYgKGV2ZW50LmRlc2NyaXB0aW9uKSBub3RlcyArPSBgKipEZXNjcmlwdGlvbi9BZ2VuZGE6KipcXG4ke2V2ZW50LmRlc2NyaXB0aW9ufVxcblxcbmA7XG4gICAgbm90ZXMgKz0gXCIqKktleSBEaXNjdXNzaW9uIFBvaW50cyAoU3VnZ2VzdGVkKToqKlxcblwiO1xuICAgIGNvbnN0IGRpc2N1c3Npb25Qb2ludHM6IHN0cmluZ1tdID0gW107IGlmICh0aXRsZUxvd2VyLmluY2x1ZGVzKFwiYnVkZ2V0XCIpIHx8IGRlc2NyaXB0aW9uTG93ZXIuaW5jbHVkZXMoXCJidWRnZXRcIikpIHsgZGlzY3Vzc2lvblBvaW50cy5wdXNoKFwiUmV2aWV3IGJ1ZGdldCBmaWd1cmVzIGFuZCBhbGxvY2F0aW9ucy5cIik7IGNvbnN0IGJ1ZGdldERvYyA9IGRvY3VtZW50cy5maW5kKGRvYyA9PiBkb2MubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiYnVkZ2V0XCIpKTsgaWYgKGJ1ZGdldERvYykgZGlzY3Vzc2lvblBvaW50cy5wdXNoKGBBbmFseXplIGRhdGEgaW4gXCIke2J1ZGdldERvYy5uYW1lfVwiLmApOyB9IGlmICh0aXRsZUxvd2VyLmluY2x1ZGVzKFwic3RyYXRlZ3lcIikgfHwgdGl0bGVMb3dlci5pbmNsdWRlcyhcInBsYW5uaW5nXCIpIHx8IGRlc2NyaXB0aW9uTG93ZXIuaW5jbHVkZXMoXCJzdHJhdGVneVwiKSB8fCBkZXNjcmlwdGlvbkxvd2VyLmluY2x1ZGVzKFwicGxhbm5pbmdcIikpIGRpc2N1c3Npb25Qb2ludHMucHVzaChcIkRlZmluZS9SZXZpZXcgc3RyYXRlZ2ljIGdvYWxzIGFuZCBuZXh0IGFjdGlvbnMuXCIpOyBpZiAodGl0bGVMb3dlci5pbmNsdWRlcyhcInBob2VuaXhcIikgfHwgZGVzY3JpcHRpb25Mb3dlci5pbmNsdWRlcyhcInBob2VuaXhcIikpIGRpc2N1c3Npb25Qb2ludHMucHVzaChcIkFzc2VzcyBQcm9qZWN0IFBob2VuaXggcHJvZ3Jlc3MgYW5kIGFkZHJlc3MgYmxvY2tlcnMuXCIpOyBpZiAodGl0bGVMb3dlci5pbmNsdWRlcyhcIjE6MVwiKSkgeyBjb25zdCBhdHRlbmRlZU5hbWUgPSBldmVudC50aXRsZS5yZXBsYWNlKFwiMToxIHdpdGhcIiwgXCJcIikudHJpbSgpOyBkaXNjdXNzaW9uUG9pbnRzLnB1c2goYERpc2N1c3MgJHthdHRlbmRlZU5hbWV9J3MgcHJvZ3Jlc3MsIGdvYWxzLCBhbmQgYW55IGNoYWxsZW5nZXMuYCk7IH0gaWYgKGRpc2N1c3Npb25Qb2ludHMubGVuZ3RoID09PSAwKSB7IGRpc2N1c3Npb25Qb2ludHMucHVzaChcIkNsYXJpZnkgbWVldGluZyBvYmplY3RpdmVzIGFuZCBkZXNpcmVkIG91dGNvbWVzLlwiKTsgZGlzY3Vzc2lvblBvaW50cy5wdXNoKFwiSWRlbnRpZnkga2V5IHRvcGljcyBiYXNlZCBvbiBwYXJ0aWNpcGFudCByb2xlcy5cIik7IH0gZGlzY3Vzc2lvblBvaW50cy5mb3JFYWNoKHBvaW50ID0+IG5vdGVzICs9IGAtICR7cG9pbnR9XFxuYCk7IG5vdGVzICs9IFwiXFxuXCI7XG4gICAgbm90ZXMgKz0gXCIqKlJlbGV2YW50IE1hdGVyaWFscyAmIENvbnRleHQ6KipcXG5cIjtcbiAgICBpZiAoZG9jdW1lbnRzLmxlbmd0aCA+IDApIHsgZG9jdW1lbnRzLmZvckVhY2goZG9jID0+IHsgbm90ZXMgKz0gYC0gKioke2RvYy5uYW1lfSoqICgke2RvYy50eXBlfSk6IFJldmlldyB0aGlzIGRvY3VtZW50IGZvciByZWxldmFudCBiYWNrZ3JvdW5kL2RhdGEuIChNb2NrZWQgTGluazogJHtkb2MudXJsfSlcXG5gOyB9KTsgfSBlbHNlIHsgbm90ZXMgKz0gXCItIE5vIHNwZWNpZmljIGRvY3VtZW50cyB3ZXJlIGF1dG9tYXRpY2FsbHkgbGlua2VkIChtb2NrZWQpLlxcblwiOyB9XG4gICAgbm90ZXMgKz0gXCJcXG5cIjtcbiAgICBpZiAoZW1haWxzLmxlbmd0aCA+IDApIHsgbm90ZXMgKz0gXCIqKlJlY2VudGx5IEV4Y2hhbmdlZCBFbWFpbHMgKHdpdGggYXR0ZW5kZWVzLCBhcm91bmQgbWVldGluZyBkYXRlKToqKlxcblwiOyBlbWFpbHMuZm9yRWFjaChlbWFpbCA9PiB7IGNvbnN0IGVtYWlsRGF0ZSA9IGVtYWlsLmRhdGUgPyBuZXcgRGF0ZShlbWFpbC5kYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoKSA6IFwiTi9BXCI7IG5vdGVzICs9IGAtICoqU3ViamVjdDoqKiBcIiR7ZW1haWwuc3ViamVjdCB8fCAnKE5vIFN1YmplY3QpJ31cIiAoRnJvbTogJHtlbWFpbC5mcm9tIHx8ICdOL0EnfSwgRGF0ZTogJHtlbWFpbERhdGV9KVxcbmA7IGlmIChlbWFpbC5zbmlwcGV0KSBub3RlcyArPSBgICAqU25pcHBldDoqICR7ZW1haWwuc25pcHBldH0uLi5cXG5gOyBpZiAoZW1haWwubGluaykgbm90ZXMgKz0gYCAgKkxpbms6KiAke2VtYWlsLmxpbmt9XFxuYDsgfSk7IG5vdGVzICs9IFwiXFxuXCI7IH0gZWxzZSB7IG5vdGVzICs9IFwiKipSZWNlbnRseSBFeGNoYW5nZWQgRW1haWxzOioqXFxuLSBObyBzcGVjaWZpYyByZWNlbnQgZW1haWxzIGZvdW5kLlxcblxcblwiOyB9XG4gICAgaWYgKG5vdGlvblBhZ2VzLmxlbmd0aCA+IDApIHsgbm90ZXMgKz0gXCIqKlJlbGF0ZWQgTm90aW9uIFBhZ2VzOioqXFxuXCI7IG5vdGlvblBhZ2VzLmZvckVhY2gocGFnZSA9PiB7IG5vdGVzICs9IGAtICoqVGl0bGU6KiogXCIke3BhZ2UudGl0bGUgfHwgJ1VudGl0bGVkIFBhZ2UnfVwiYDsgaWYgKHBhZ2UubGFzdF9lZGl0ZWRfdGltZSkgbm90ZXMgKz0gYCAoTGFzdCBlZGl0ZWQ6ICR7bmV3IERhdGUocGFnZS5sYXN0X2VkaXRlZF90aW1lKS50b0xvY2FsZURhdGVTdHJpbmcoKX0pYDsgbm90ZXMgKz0gXCJcXG5cIjsgaWYgKHBhZ2UucHJldmlld190ZXh0KSBub3RlcyArPSBgICAqUHJldmlldzoqICR7cGFnZS5wcmV2aWV3X3RleHR9Li4uXFxuYDsgaWYgKHBhZ2UudXJsKSBub3RlcyArPSBgICAqTGluazoqICR7cGFnZS51cmx9XFxuYDsgfSk7IG5vdGVzICs9IFwiXFxuXCI7IH0gZWxzZSB7IG5vdGVzICs9IFwiKipSZWxhdGVkIE5vdGlvbiBQYWdlczoqKlxcbi0gTm8gTm90aW9uIHBhZ2VzIGZvdW5kIHJlbGF0ZWQgdG8ga2V5d29yZHMuXFxuXFxuXCI7IH1cbiAgICBpZiAoZ2RyaXZlRmlsZXNUcmlnZ2VyZWQgJiYgZ2RyaXZlRmlsZXNUcmlnZ2VyZWQubGVuZ3RoID4gMCkgeyBub3RlcyArPSBcIuKEue+4jyAqKkdvb2dsZSBEcml2ZSBGaWxlcyBJZGVudGlmaWVkIGZvciBQcm9jZXNzaW5nOioqXFxuXCI7IGdkcml2ZUZpbGVzVHJpZ2dlcmVkLmZvckVhY2goZmlsZSA9PiB7IG5vdGVzICs9IGAtIFwiJHtmaWxlLm5hbWV9XCIgKFR5cGU6ICR7ZmlsZS5taW1lVHlwZX0pXFxuYDsgfSk7IG5vdGVzICs9IFwiVGhlc2UgZmlsZXMgYXJlIGJlaW5nIHF1ZXVlZCBmb3IgcHJvY2Vzc2luZyBhbmQgdGhlaXIgY29udGVudCBtYXkgYmUgYXZhaWxhYmxlIGZvciBjb250ZXh0IGluIGZ1dHVyZSBwcmVwYXJhdGlvbnMgb3Igc2VhcmNoZXMuXFxuXFxuXCI7IH1cbiAgICBpZiAoaHlicmlkU2VhcmNoUmVzdWx0cyAmJiBoeWJyaWRTZWFyY2hSZXN1bHRzLmxlbmd0aCA+IDApIHsgbm90ZXMgKz0gXCLwn5OaICoqQWRkaXRpb25hbCBDb250ZXh0IGZyb20gS25vd2xlZGdlIEJhc2UgKEh5YnJpZCBTZWFyY2gpKipcXG5cXG5cIjsgaHlicmlkU2VhcmNoUmVzdWx0cy5mb3JFYWNoKGl0ZW0gPT4geyBsZXQgaXRlbVR5cGVEaXNwbGF5ID0gaXRlbS5kb2NfdHlwZSA/IGl0ZW0uZG9jX3R5cGUucmVwbGFjZSgvXy9nLCAnICcpLnJlcGxhY2UoLyg/Ol58XFxzKVxcUy9nLCBhID0+IGEudG9VcHBlckNhc2UoKSkgOiBcIkNvbnRleHR1YWwgSXRlbVwiOyBjb25zdCBtYXRjaFR5cGVEaXNwbGF5ID0gaXRlbS5tYXRjaF90eXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgaXRlbS5tYXRjaF90eXBlLnNsaWNlKDEpOyBub3RlcyArPSBgLSAqKlR5cGU6KiogJHtpdGVtVHlwZURpc3BsYXl9ICgke21hdGNoVHlwZURpc3BsYXl9IE1hdGNoKVxcbmA7IG5vdGVzICs9IGAgIC0gKipUaXRsZS9TdWJqZWN0OioqIFwiJHtpdGVtLnRpdGxlIHx8ICdOL0EnfVwiXFxuYDsgbm90ZXMgKz0gYCAgLSAqKlJlbGV2YW50IFNuaXBwZXQ6KiogJHtpdGVtLnNuaXBwZXQgfHwgaXRlbS5leHRyYWN0ZWRfdGV4dF9wcmV2aWV3IHx8ICdOL0EnfS4uLlxcbmA7IGNvbnN0IGxpbmtUb0Rpc3BsYXkgPSBpdGVtLnNvdXJjZV91cmk7IGlmIChsaW5rVG9EaXNwbGF5KSB7IG5vdGVzICs9IGAgIC0gKipMaW5rOioqICR7bGlua1RvRGlzcGxheX1cXG5gOyB9IGxldCBpdGVtRGF0ZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7IGlmIChpdGVtLmxhc3RfbW9kaWZpZWRfc291cmNlKSBpdGVtRGF0ZSA9IG5ldyBEYXRlKGl0ZW0ubGFzdF9tb2RpZmllZF9zb3VyY2UpLnRvTG9jYWxlRGF0ZVN0cmluZygpOyBlbHNlIGlmIChpdGVtLmNyZWF0ZWRfYXRfc291cmNlKSBpdGVtRGF0ZSA9IG5ldyBEYXRlKGl0ZW0uY3JlYXRlZF9hdF9zb3VyY2UpLnRvTG9jYWxlRGF0ZVN0cmluZygpOyBlbHNlIGlmIChpdGVtLmluZ2VzdGVkX2F0KSBpdGVtRGF0ZSA9IG5ldyBEYXRlKGl0ZW0uaW5nZXN0ZWRfYXQpLnRvTG9jYWxlRGF0ZVN0cmluZygpOyBpZiAoaXRlbURhdGUpIG5vdGVzICs9IGAgIC0gKipEYXRlOioqICR7aXRlbURhdGV9XFxuYDsgbm90ZXMgKz0gYCAgLSAqKlJlbGV2YW5jZSBTY29yZToqKiAke2l0ZW0uc2NvcmU/LnRvRml4ZWQoNCl9XFxuYDsgbm90ZXMgKz0gXCJcXG5cIjsgfSk7IG5vdGVzICs9IFwiLS0tXFxuXFxuXCI7IH1cbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHsgbm90ZXMgKz0gXCIqKkRhdGEgUmV0cmlldmFsIElzc3VlcyBFbmNvdW50ZXJlZDoqKlxcblwiOyBlcnJvcnMuZm9yRWFjaChlcnIgPT4geyBub3RlcyArPSBgLSAke2Vycn1cXG5gOyB9KTsgbm90ZXMgKz0gXCJcXG5cIjsgfVxuICAgIG5vdGVzICs9IFwiKipQb3RlbnRpYWwgQWN0aW9uIEl0ZW1zIHRvIENvbnNpZGVyLi4uKipcXG5cIjsgbm90ZXMgKz0gXCItIFtBc3NpZ24gb3duZXJzIGFuZCBkZWFkbGluZXMgZm9yIG5ldyB0YXNrc11cXG5cIjsgbm90ZXMgKz0gXCItIFtTY2hlZHVsZSBmb2xsb3ctdXAgbWVldGluZ3MgaWYgbmVjZXNzYXJ5XVxcblxcblwiO1xuICAgIG5vdGVzICs9IFwiKipBY3Rpb24gSXRlbXMgZnJvbSBQcmV2aW91cyBSZWxhdGVkIE1lZXRpbmdzLi4uKipcXG5cIjsgY29uc3QgYWN0aW9uSXRlbURvYyA9IGRvY3VtZW50cy5maW5kKGRvYyA9PiBkb2MubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiYWN0aW9uIGl0ZW1zXCIpKTsgY29uc3QgbWludXRlc0RvYyA9IGRvY3VtZW50cy5maW5kKGRvYyA9PiBkb2MubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwibWludXRlc1wiKSk7IGlmIChhY3Rpb25JdGVtRG9jKSBub3RlcyArPSBgLSBSZXZpZXcgYWN0aW9uIGl0ZW1zIGZyb20gXCIke2FjdGlvbkl0ZW1Eb2MubmFtZX1cIi5cXG5gOyBlbHNlIGlmIChtaW51dGVzRG9jKSBub3RlcyArPSBgLSBDaGVjayBmb3Igb3BlbiBhY3Rpb24gaXRlbXMgaW4gXCIke21pbnV0ZXNEb2MubmFtZX1cIi5cXG5gOyBlbHNlIG5vdGVzICs9IFwiLSBDaGVjayBmb3IgYW55IG91dHN0YW5kaW5nIGFjdGlvbiBpdGVtcyBmcm9tIHByaW9yIHJlbGV2YW50IG1lZXRpbmdzLlxcblwiOyBub3RlcyArPSBcIlxcblwiO1xuICAgIGlmIChldmVudC5hdHRlbmRlZXMpIHsgY29uc3QgbG93ZXJBdHRlbmRlZXMgPSBldmVudC5hdHRlbmRlZXMubWFwKGEgPT4gYS50b0xvd2VyQ2FzZSgpKTsgaWYgKGxvd2VyQXR0ZW5kZWVzLnNvbWUoYSA9PiBhLmluY2x1ZGVzKFwiYWxpY2VcIikpKSB7IGNvbnN0IGFsaWNlRG9jID0gZG9jdW1lbnRzLmZpbmQoZCA9PiBkLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImFsaWNlJ3MgYWN0aW9uIGl0ZW1zXCIpKTsgaWYgKGFsaWNlRG9jKSBub3RlcyArPSBgKipGb3IgQWxpY2U6KiogUGxlYXNlIGNvbWUgcHJlcGFyZWQgdG8gZGlzY3VzcyBpdGVtcyBmcm9tIFwiJHthbGljZURvYy5uYW1lfVwiLlxcbmA7IGVsc2Ugbm90ZXMgKz0gYCoqRm9yIEFsaWNlOioqIEJlIHJlYWR5IHRvIHByb3ZpZGUgdXBkYXRlcyBvbiB5b3VyIGN1cnJlbnQgdGFza3MuXFxuYDsgfSBpZiAobG93ZXJBdHRlbmRlZXMuc29tZShhID0+IGEuaW5jbHVkZXMoXCJtYXJrXCIpKSkgeyBjb25zdCBtYXJrRG9jID0gZG9jdW1lbnRzLmZpbmQoZCA9PiBkLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcIm1hcmsncyBwcm9wb3NhbCBkcmFmdFwiKSk7IGlmIChtYXJrRG9jKSBub3RlcyArPSBgKipGb3IgTWFyazoqKiBLZXkgZGlzY3Vzc2lvbiBwb2ludCB3aWxsIGJlIHlvdXIgcHJvcG9zYWw6IFwiJHttYXJrRG9jLm5hbWV9XCIuXFxuYDsgfSBub3RlcyArPSBcIlxcblwiOyB9XG4gICAgbm90ZXMgKz0gXCItLS1cXG5HZW5lcmF0ZWQgYnkgU21hcnRNZWV0aW5nUHJlcFNraWxsXCI7XG4gICAgbG9nZ2VyLmluZm8oYFtTbWFydE1lZXRpbmdQcmVwU2tpbGwuX2dlbmVyYXRlUHJlcGFyYXRpb25Ob3Rlc10gTm90ZXMgZ2VuZXJhdGVkIGZvciBcIiR7ZXZlbnQudGl0bGV9XCIuIExlbmd0aDogJHtub3Rlcy5sZW5ndGh9YCk7XG4gICAgcmV0dXJuIG5vdGVzO1xuICB9XG59XG5gYGBcbiJdfQ==