"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.handleFinanceQuery = handleFinanceQuery;
const types_1 = require("../types");
const axios_1 = __importDefault(require("axios"));
const taxExpertSkills_1 = require("./taxExpertSkills");
// Comprehensive finance agent skills extending existing Atom agent capabilities
async function handleFinanceQuery(userId, query, context) {
    try {
        // Intent detection and parameter extraction from natural language
        const intent = await extractFinanceIntent(query, context);
        switch (intent.intent) {
            case 'net_worth':
                return await getNetWorthResponse(userId, intent.parameters);
            case 'budgets':
                return await getBudgetResponse(userId, intent.parameters);
            case 'spending':
                return await getSpendingAnalysis(userId, intent.parameters);
            case 'goals':
                return await getFinancialGoalsResponse(userId, intent.parameters);
            case 'accounts':
                return await getAccountSummary(userId, intent.parameters);
            case 'investments':
                return await getInvestmentSummary(userId, intent.parameters);
            case 'insights':
                return await getFinancialInsights(userId, intent.parameters);
            case 'create_budget':
                return await createBudgetResponse(userId, intent.parameters);
            case 'create_goal':
                return await createGoalResponse(userId, intent.parameters);
            case 'tax_question':
                return await (0, taxExpertSkills_1.handleTaxQuery)(userId, query, context);
            default:
                return await provideFinanceHelp(userId);
        }
    }
    catch (error) {
        console.error('Finance query error:', error);
        return {
            ok: false,
            error: {
                code: 'FINANCE_ERROR',
                message: 'I encountered an issue processing your financial query. Please try rephrasing or contact support.'
            }
        };
    }
}
// Intent recognition for natural language finance queries
async function extractFinanceIntent(query, context) {
    const normalizedQuery = query.toLowerCase().trim();
    // Net worth detection
    if (normalizedQuery.includes('net worth') ||
        normalizedQuery.includes('total assets') ||
        normalizedQuery.includes('how much am I worth') ||
        normalizedQuery.includes('financial position') ||
        normalizedQuery.includes('wealth') ||
        normalizedQuery.includes('calculate net worth')) {
        return {
            intent: 'net_worth',
            parameters: {
                includeHistory: normalizedQuery.includes('history') || normalizedQuery.includes('trend'),
                timeframe: extractTimeframe(normalizedQuery)
            }
        };
    }
    // Budget detection
    if (normalizedQuery.includes('budget') || normalizedQuery.includes('spending limit')) {
        if (normalizedQuery.includes('create') || normalizedQuery.includes('set') || normalizedQuery.includes('make')) {
            const budgetMatch = normalizedQuery.match(/(?:create|set|make).+budget.*?(.+?)\s*(?:for|of)\s*\$?(\d+)/i);
            if (budgetMatch) {
                return {
                    intent: 'create_budget',
                    parameters: {
                        category: budgetMatch[1]?.trim() || 'general',
                        amount: parseFloat(budgetMatch[2] || '0')
                    }
                };
            }
        }
        return {
            intent: 'budgets',
            parameters: {
                category: extractCategory(normalizedQuery),
                timeframe: extractTimeframe(normalizedQuery)
            }
        };
    }
    // Spending analysis
    const spendingPatterns = ['spend', 'spent', 'expenses', 'where did money go', 'transactions', 'purchases'];
    if (spendingPatterns.some(pattern => normalizedQuery.includes(pattern))) {
        return {
            intent: 'spending',
            parameters: {
                category: extractCategory(normalizedQuery),
                timeframe: extractTimeframe(normalizedQuery),
                amount: extractAmountRange(normalizedQuery)
            }
        };
    }
    // Financial goals
    if (normalizedQuery.includes('goal') || normalizedQuery.includes('savings') || normalizedQuery.includes('save for')) {
        if (normalizedQuery.includes('create') || normalizedQuery.includes('set') || normalizedQuery.includes('make')) {
            const goalMatch = normalizedQuery.match(/(?:create|set|make).+goal.+for\s*(.+?)\s*(?:of|for)\s*\$?(\d*)/i);
            return {
                intent: 'create_goal',
                parameters: {
                    name: goalMatch?.[1]?.trim() || 'New Goal',
                    targetAmount: parseFloat(goalMatch?.[2] || '0'),
                    goalType: extractGoalType(normalizedQuery)
                }
            };
        }
        return {
            intent: 'goals',
            parameters: {
                goalType: extractGoalType(normalizedQuery),
                includeAll: true
            }
        };
    }
    // Investment analysis
    if (normalizedQuery.includes('investment') ||
        normalizedQuery.includes('portfolio') ||
        normalizedQuery.includes('stocks') ||
        normalizedQuery.includes('mutual funds') ||
        normalizedQuery.includes('returns') ||
        normalizedQuery.includes('performance')) {
        return {
            intent: 'investments',
            parameters: {
                includeHistory: normalizedQuery.includes('history') || normalizedQuery.includes('performance'),
                showAllocation: normalizedQuery.includes('allocation') || normalizedQuery.includes('diversified')
            }
        };
    }
    // Account summary
    if (normalizedQuery.includes('accounts') ||
        normalizedQuery.includes('balances') ||
        normalizedQuery.includes('checking') ||
        normalizedQuery.includes('savings') ||
        normalizedQuery.includes('credit cards')) {
        return {
            intent: 'accounts',
            parameters: {
                accountType: extractAccountType(normalizedQuery)
            }
        };
    }
    // Tax questions
    if (normalizedQuery.includes('tax') || normalizedQuery.includes('taxes')) {
        return {
            intent: 'tax_question',
            parameters: {
                query: normalizedQuery
            }
        };
    }
    // By default, provide helpful suggestions
    return {
        intent: 'insights',
        parameters: { queryType: 'general' }
    };
}
// Response generation with intelligent formatting and insights
async function getNetWorthResponse(userId, params) {
    try {
        const response = await axios_1.default.get('/api/financial/net-worth/summary', {
            params: { userId, includeHistory: params.includeHistory },
            headers: { 'Authorization': userId }
        });
        const data = response.data.data;
        let responseText = `üí∞ **Net Worth Summary**\n\n`;
        responseText += `**Current Net Worth**: **$${data.current.toLocaleString()}**\n`;
        if (data.change > 0) {
            responseText += `üìà **Trending Up**: +$${Math.abs(data.change).toLocaleString()} (${data.changePercent.toFixed(1)}%) from last period\n`;
        }
        else if (data.change < 0) {
            responseText += `üìâ **Trending Down**: -$${Math.abs(data.change).toLocaleString()} (${Math.abs(data.changePercent).toFixed(1)}%) from last period\n`;
        }
        responseText += `üè¶ **Assets**: $${data.assets.toLocaleString()} | üí∏ **Liabilities**: $${data.liabilities.toLocaleString()}\n`;
        if (data.history && data.history.length > 1) {
            responseText += `\nüìä **12-Month Trend**: Your net worth has ${data.current > data.history[0]?.netWorth ? 'grown' : 'changed'} significantly over the past year\n`;
        }
        return { ok: true, data: responseText };
    }
    catch (error) {
        return { ok: false, error: { code: 'API_ERROR', message: 'Unable to retrieve net worth data' } };
    }
}
async function getBudgetResponse(userId, params) {
    try {
        const response = await axios_1.default.get('/api/financial/budgets/summary', {
            params: { userId, timeframe: params.timeframe },
            headers: { 'Authorization': userId }
        });
        const data = response.data.data;
        let responseText = `üí∞ **Budget Overview**\n\n`;
        if (data.categories.length === 0) {
            return { ok: true, data: "üìã You haven't set up any budgets yet. Say 'Create a budget for dining of $500' to get started!" };
        }
        responseText += `Total Budget: **$${data.totalBudget.toLocaleString()}** | Spent: **$${data.spent.toLocaleString()}** | Remaining: **$${data.remaining.toLocaleString()}**\n\n`;
        data.categories.slice(0, 5).forEach((category) => {
            const emoji = category.utilization >= 100 ? '‚ö†Ô∏è' : category.utilization >= 80 ? 'üü°' : '‚úÖ';
            const status = category.remaining < 0 ? `**$${Math.abs(category.remaining).toLocaleString()} over**` : `$${category.remaining.toLocaleString()} left`;
            responseText += `${emoji} ${category.category}: $${category.spent.toLocaleString()} / $${category.budgeted.toLocaleString()} (${category.utilization.toFixed(0)}%) - ${status}\n`;
        });
        return { ok: true, data: responseText };
    }
    catch (error) {
        return { ok: false, error: { code: 'API_ERROR', message: 'Unable to retrieve budget information' } };
    }
}
async function getSpendingAnalysis(userId, params) {
    try {
        // Format date range based on timeframe
        const { startDate, endDate } = getDateRangeForTimeframe(params.timeframe || 'this_month');
        const response = await axios_1.default.post('/api/financial/transactions/search', {
            userId,
            dateRange: { start: startDate, end: endDate },
            category: params.category,
            limit: 50
        }, {
            headers: { 'Authorization': userId }
        });
        const transactions = response.data.transactions;
        if (transactions.length === 0) {
            return { ok: true, data: "üí∏ No transactions found in the specified period. Try adjusting your timeframe or category filter." };
        }
        // Calculate spending by category
        const spendingByCategory = {};
        transactions.forEach((transaction) => {
            const cat = transaction.category || 'Uncategorized';
            spendingByCategory[cat] = (spendingByCategory[cat] || 0) + Math.abs(transaction.amount);
        });
        const totalSpent = Object.values(spendingByCategory).reduce((sum, amount) => sum + amount, 0);
        let responseText = `üí∏ **Spending Analysis (${params.timeframe || 'this month'})**\n\n`;
        responseText += `**Total Spent**: **$${totalSpent.toLocaleString()}**\n\n`;
        // Sort by amount spent
        const sortedSpending = Object.entries(spendingByCategory)
            .sort(([, a], [, b]) => b - a)
            .slice(0, 5);
        sortedSpending.forEach(([category, amount], index) => {
            const percentage = (amount / totalSpent * 100).toFixed(1);
            responseText += `${index + 1}. **${category}**: $${amount.toLocaleString()} (${percentage}%)\n`;
        });
        return { ok: true, data: responseText };
    }
    catch (error) {
        return { ok: false, error: { code: 'API_ERROR', message: 'Unable to analyze spending data' } };
    }
}
async function getFinancialGoalsResponse(userId, params) {
    try {
        const response = await axios_1.default.get('/api/financial/goals', {
            params: { userId, goalType: params.goalType },
            headers: { 'Authorization': userId }
        });
        const goals = response.data.goals;
        if (goals.length === 0) {
            return {
                ok: true,
                data: "üí≠ You haven't set up any financial goals yet. Say 'Create a savings goal for vacation of $5000' to get started!"
            };
        }
        let responseText = `üéØ **Your Financial Goals**\n\n`;
        goals.forEach((goal, index) => {
            const progressBar = generateProgressBar(goal.progress);
            const statusEmoji = goal.status === 'completed' ? '‚úÖ' : goal.progress >= 80 ? 'üöÄ' : 'üéØ';
            responseText += `${statusEmoji} **${goal.name}**\n`;
            responseText += `${progressBar} ${goal.progress.toFixed(1)}%\n`;
            responseText += `Progress: **$${goal.current.toLocaleString()}** / **$${goal.target.toLocaleString()}**`;
            if (goal.deadline) {
                const daysLeft = Math.ceil((new Date(goal.deadline).getTime() - Date.now()) / (1000 * 60 * 60 * 24));
                responseText += ` | **${daysLeft} days** left\n`;
            }
            responseText += `${goal.target - goal.current > 0 ? `$${(goal.target - goal.current).toLocaleString()} to go` : 'Completed!'}\n\n`;
        });
        return { ok: true, data: responseText };
    }
    catch (error) {
        return { ok: false, error: { code: 'API_ERROR', message: 'Unable to retrieve goals' } };
    }
}
async function getAccountSummary(userId, params) {
    try {
        const accountType = params.accountType || 'all';
        n;
        let responseText = `üè¶ **Account Summary**\n\n`;
        n;
        if (accountType === 'cash' || accountType === 'all') {
            const cashAccounts = await getAccountsByType(userId, ['checking', 'savings', 'money_market']);
            n;
            const totalCash = cashAccounts.reduce((sum, acc) => sum + acc.balance, 0);
            n;
            responseText += `üí∞ **Available Cash**: **$${totalCash.toLocaleString()}**\n`;
            n;
        }
        n;
        if (accountType === 'credit' || accountType === 'all') {
            const creditCards = await getAccountsByType(userId, ['credit_card', 'line_of_credit']);
            n;
            const totalCredit = creditCards.reduce((sum, acc) => sum + Math.abs(acc.balance), 0);
            n;
            responseText += `üí≥ **Credit Cards**: **$${totalCredit.toLocaleString()}** available\n`;
            n;
        }
        n;
        n;
        const allAccounts = await getAllUserAccounts(userId);
        n;
        allAccounts.forEach(account => {
            n;
            const accountType = account.account_type || 'general';
            n;
            const accountSymbol = getAccountEmoji(accountType);
            n;
            responseText += `${accountSymbol} **${account.account_name || 'Untitled'}**: **$${account.balance.toLocaleString()}** (${accountType})\n`;
            n;
        });
        n;
        n;
        return { ok: true, data: responseText };
        n;
    }
    catch (error) {
        n;
        return { ok: false, error: { code: 'API_ERROR', message: 'Unable to retrieve account information' } };
        n;
    }
    n;
}
n;
nasync;
function getInvestmentSummary(userId, params) {
    n;
    try {
        n;
        const response = await axios_1.default.get('/api/financial/investments/summary', { n, params: { userId, includeHistory: params.includeHistory }, n, headers: { 'Authorization': userId }, n });
        n;
        n;
        const data = response.data;
        n;
        if (!data.holdings || data.holdings.length === 0) {
            n;
            return { ok: true, data: , "üìà You don't have any connected investment accounts. Would you like to set up investment tracking?\" };\n    }\n    \n    let responseText = `üìà **Investment Portfolio**\n\n`;\n    responseText += `**Total Value**: **$${data.totalValue.toLocaleString()}**`;\n    \n    if (data.totalGainLoss !== undefined) {\n      const trendEmoji = data.totalGainLoss >= 0 ? 'üìà' : 'üìâ';\n      responseText += ` | ${trendEmoji} All Time: **${data.totalGainLoss >= 0 ? '+' : ''}$${Math.abs(data.totalGainLoss).toLocaleString()} (${data.totalReturnPct?.toFixed(1)}%)**`;\n    }\n    \n    responseText += `\n\n**Top Holdings**:\n`;\n    data.holdings.slice(0, 5).forEach((holding: any) => {\n      const holdingEmoji = holding.totalReturnPct >= 0 ? 'üü¢' : 'üî¥';\n      responseText += `${holdingEmoji} **${holding.name}**: ${holding.shares} @ $${holding.price?.toLocaleString()} = **$${holding.value.toLocaleString()}** (${holding.totalReturnPct >= 0 ? '+' : ''}${holding.totalReturnPct?.toFixed(1)}%)\n`;\n    });\n    \n    if (data.holdings.length > 5) {\n      responseText += `\n...and **${data.holdings.length - 5} more** ‚û°Ô∏è`;\n    }\n    \n    return { ok: true, data: responseText };\n  } catch (error) {\n    return { ok: false, error: { code: 'API_ERROR', message: 'Unable to retrieve investment data' } };\n  }\n}\n\nasync function getFinancialInsights(userId: string, params: any): Promise<SkillResponse<string>> {\n  const insights = [\n    \"üîç **Your financial health looks good!** Your net worth has been steadily increasing.\",\n    \"‚ö†Ô∏è **Watch your spending**: You spent 23% more on dining out last month compared to your average.\",\n    \"üí° **Goal Strategy**: At your current savings rate, you'll reach your vacation goal 2 months early.\",\n    \"üéØ **Budget Alert**: Your entertainment budget is 85% utilized this month.\",\n    \"üè¶ **Account Tip**: Consider moving savings from checking to high-yield savings account for better returns.\",\n    \"üìä **Investment Outlook**: Your tech stock allocation is 65% - consider diversification.\",\n  ];\n  \n  const responseText = insights[Math.floor(Math.random() * insights.length)] + `\n\nüí≠ Want more specific insights? Ask me about your **budgets**, **goals**, or **spending habits**.`;\n  return { ok: true, data: responseText };\n}\n\nasync function createBudgetResponse(userId: string, params: any): Promise<SkillResponse<string>> {\n  await simulateAPICall(1500);\n  const successMessage = `‚úÖ **Budget Created Successfully**\n\n**${params.category} Budget**: **$${params.amount.toLocaleString()}** per month\n\nI've set up your new budget! You'll get notifications when you're approaching 80% of your budget. Want me to help you set up **transaction categorization rules** or create **milestone alerts**?`;\n  \n  return { ok: true, data: successMessage };\n}\n\nasync function createGoalResponse(userId: string, params: any): Promise<SkillResponse<string>> {\n  await simulateAPICall(1500);\n  const targetDate = params.targetDate ? new Date(params.targetDate).toLocaleDateString() : 'open-ended';\n  const successMessage = `üéØ **Goal Created Successfully**\n\n**${params.name} Goal**: Save **$${params.targetAmount.toLocaleString()}** for ${params.goalType.replace('_', ' ')}\n${params.targetDate ? `Target Date: **${targetDate}**` : ''}\n\nYour goal is now active! I'll help track your progress and provide periodic updates. Would you like to set up **automatic contributions** or set up **progress milestone notifications**?`;\n  \n  return { ok: true, data: successMessage };\n}\n\nasync function provideFinanceHelp(userId: string): Promise<SkillResponse<string>> {\n  const helpText = `üí° **Finance Agent Help Center**\n\nYou can ask me about:\n\nüè¶ **Account Management**\n‚Ä¢ \\": Show, my, account, balances, "\n‚Ä¢ \\": How, much, do: I, have, savings, "\n‚Ä¢ \\": What, 's my checking account balance?\\"\n\nüí∞ **Net Worth & Financial Health**\n‚Ä¢ \\"What': s, my, net, worth, "\n‚Ä¢ \\": Show, my, net, worth, trend, "\n‚Ä¢ \\": Compare, this: month, to, last, "\n\nüìä **Budgeting & Spending**\n‚Ä¢ \\": Show, my, budgets, "\n‚Ä¢ \\": How, much, did, I, spend, on, dining, this: month ?  : , "\n‚Ä¢ \\": Create, a, $400, grocery, budget, "\n\nüéØ **Financial Goals**\n‚Ä¢ \\": Show, my, savings, goals, "\n‚Ä¢ \\": Create, an, emergency, fund, goal, of, $3000, "\n‚Ä¢ \\": Track, my, retirement, progress, "\n\nüìà **Investments & Performance**\n‚Ä¢ \\": Show, my, investment, portfolio, "\n‚Ä¢ \\": What, 's my performance this quarter?\\"\n‚Ä¢ \\"Portfolio allocation\\"\n\n**Tips**: I understand natural language - just speak normally! Try: \\"How much can I save this month?\\" or \\"I need to track my vacation savings.\\"`;\n  \n  return { ok: true, data: helpText };\n}\n\n// Utility Functions\nfunction extractTimeframe(query: string): string {\n  if (query.includes(': last, week, ')) return ': last_week, ';\n  if (query.includes(': last, month, ')) return ': last_month, ';\n  if (query.includes(': this, quarter, ') || query.includes(': quarter, ')) return ': this_quarter, ';\n  if (query.includes(': this, year, ') || query.includes(': year, to, date, ')) return ': year_to_date, ';\n  return ': current, ';\n}\n\nfunction extractCategory(query: string): string | undefined {\n  const categories = [': dining, ', ': groceries, ', ': transportation, ', ': entertainment, ', ': shopping, ', ': utilities, ', ': bills, ', ': rent, ', ': gas, ', ': food, ', ': restaurants, ', ': coffee, ', ': drinks, ', ': travel, ', ': subscriptions, '];\n  for (const cat of categories) {\n    if (query.includes(cat)) return cat;\n  }\n  return undefined;\n}\n\nfunction extractAmountRange(query: string): number | undefined {\n  const match = query.match(/\$(\d+(?:\.\d{2})?)|(\d+)\s*dollars?/i);\n  return match ? parseFloat(match[1] || match[2]) : undefined;\n}\n\nfunction extractGoalType(query: string): string {\n  if (query.includes(': emergency, ') || query.includes(': rainy, day, ')) return ': emergency, ';\n  if (query.includes(': retirement, ') || query.includes(': 401, k, ') || query.includes(': IRA, ')) return ': retirement, ';\n  if (query.includes(': vacation, ') || query.includes(': travel, ')) return ': vacation, ';\n  if (query.includes(': house, ') || query.includes(': home, ')) return ': purchase, ';\n  if (query.includes(': debt, ') || query.includes(': credit, card, ')) return ': debt_payoff, ';\n  return ': general, ';\n}\n\nfunction extractAccountType(query: string): string {\n  if (query.includes(': cash, ') || query.includes(': checking, ') || query.includes(': savings, ')) return ': cash, ';\n  if (query.includes(': credit, ') || query.includes(': card, ')) return ': credit, ';\n  if (query.includes(': investment, ') || query.includes(': retirement, ')) return ': investment, ';\n  return ': all, ';\n}\n\nfunction getAccountEmoji(accountType: string): string {\n  const type = accountType.toLowerCase();\n  if (type.includes(': savings, ')) return ': , ';\n  if (type.includes(': checking, ')) return ': , ';\n  if (type.includes(': credit, ')) return ': , ';\n  if (type.includes(': investment, ')) return ': , ';\n  if (type.includes(': loan, ')) return ': , ';\n  return ': , ';\n}\n\nfunction generateProgressBar(percentage: number, length: number = 10): string {\n  const filledBlocks = Math.round((percentage / 100) * length);\n  const emptyBlocks = length - filledBlocks;\n  return ': , '.repeat(filledBlocks) + ': , '.repeat(emptyBlocks);\n}\n\nfunction getDateRangeForTimeframe(timeframe: string): { startDate: string; endDate: string } {\n  const today = new Date();\n  \n  switch (timeframe) {\n    case ': last_week, ':\n      return {\n        startDate: new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split(': T, ')[0],\n        endDate: today.toISOString().split(': T, ')[0]\n      };\n    case ': last_month, ':\n      const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);\n      const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);\n      return {\n        startDate: lastMonth.toISOString().split(': T, ')[0],\n        endDate: lastMonthEnd.toISOString().split(': T, ')[0]\n      };\n    case ': this_quarter, ':\n      const quarterStart = new Date(today.getFullYear(), Math.floor(today.getMonth() / 3) * 3, 1);\n      return {\n        startDate: quarterStart.toISOString().split(': T, ')[0],\n        endDate: today.toISOString().split(': T, ')[0]\n      };\n    case ': year_to_date, ':\n      return {\n        startDate: new Date(today.getFullYear(), 0, 1).toISOString().split(': T, ')[0],\n        endDate: today.toISOString().split(': T, ')[0]\n      };\n    default: // current month\n      return {\n        startDate: new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split(': T, ')[0],\n        endDate: today.toISOString().split(': T, ')[0]\n      };\n  }\n}\n\n// Helper functions for API calls\nasync function getAccountsByType(userId: string, types: string[]): Promise<any[]> {\n  // This would call actual financial APIs\n  await simulateAPICall(500);\n  return [\n    { account_name: ': Chase, Checking, ', account_type: ': checking, ', balance: 5234.56 },\n    { account_name: ': High, Yield, Savings, ', account_type: ': savings, ', balance: 15890.23 }\n  ].filter(acc => types.includes(acc.account_type));\n}\n\nasync function getAllUserAccounts(userId: string): Promise<any[]> {\n  await simulateAPICall(800);\n  return [\n    { account_name: ': Chase, Checking, ', account_type: ': checking, ', balance: 5234.56 },\n    { account_name: ': High, Yield, Savings, ', account_type: ': savings, ', balance: 15890.23 },\n    { account_name: ': Credit, Card, ', account_type: ': credit_card, ', balance: -1298.45 },\n    { account_name: ': Investment, Portfolio, ', account_type: ': investment, ', balance: 48750.89 }\n  ];\n}\n\nasync function simulateAPICall(delay: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, delay));\n}\n\n// Tool implementations for the Atom agent to use: nexport, const: financeAgentTools, ToolImplementation: types_1.ToolImplementation, []:  = [n, { n, name: 'finance_query_handler', n, description: 'Handle comprehensive financial queries through natural language', n, handler: async (params) => { n; return await handleFinanceQuery(params.userId, params.query, params.context); n; }, n }, n, { n, name: 'get_spending_breakdown', n, description: 'Get detailed spending analysis with insights', n, handler: async (params) => { n; return await getSpendingAnalysis(params.userId, { timeframe: params.timeframe }); n; }, n }, n, { n, name: 'net_worth_inquiry', n, description: 'Get current net worth with historical trends', n, handler: async (params) => { n; return await getNetWorthResponse(params.userId, { includeHistory: true }); n; }, n }, n], n };
        }
    }
    finally {
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmluYW5jZUFnZW50U2tpbGxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZmluYW5jZUFnZW50U2tpbGxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBZ0JBLGdEQXFEQztBQXJFRCxvQ0FBNkQ7QUFFN0Qsa0RBQTBDO0FBQzFDLHVEQUFtRDtBQVluRCxnRkFBZ0Y7QUFDekUsS0FBSyxVQUFVLGtCQUFrQixDQUN0QyxNQUFjLEVBQ2QsS0FBYSxFQUNiLE9BQWE7SUFFYixJQUFJLENBQUM7UUFDSCxrRUFBa0U7UUFDbEUsTUFBTSxNQUFNLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFMUQsUUFBUSxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDdEIsS0FBSyxXQUFXO2dCQUNkLE9BQU8sTUFBTSxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTlELEtBQUssU0FBUztnQkFDWixPQUFPLE1BQU0saUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUU1RCxLQUFLLFVBQVU7Z0JBQ2IsT0FBTyxNQUFNLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFOUQsS0FBSyxPQUFPO2dCQUNWLE9BQU8sTUFBTSx5QkFBeUIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRXBFLEtBQUssVUFBVTtnQkFDYixPQUFPLE1BQU0saUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUU1RCxLQUFLLGFBQWE7Z0JBQ2hCLE9BQU8sTUFBTSxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRS9ELEtBQUssVUFBVTtnQkFDYixPQUFPLE1BQU0sb0JBQW9CLENBQUMsTUFBTSxFQUFFLE1B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QUEsTUFBTSxFQUFBLElBQUksRUFBQSxTQUFTLEVBQUEsSUFBSSxFQUFBLGNBQWMsRUFBQSxJQUFJLEVBQUEsYUFBYSxFQUFBLElBQUksRUFBQSxRQUFRLEVBQUEsSUFBSSxFQUFBLFNBQVMsRUFBQSxJQUFJLEVBQUEsS0FBSyxFQUFBLElBQUksRUFBQSxJQUFJLEVBQUEsSUFBSSxFQUFBLEdBQUcsRUFBQSxJQUFJLEVBQUEsSUFBSSxFQUFBLElBQUksRUFBQSxXQUFXLEVBQUEsSUFBSSxFQUFBLE1BQU0sRUFBQSxJQUFJLEVBQUEsTUFBTSxFQUFBLElBQUksRUFBQSxNQUFNLEVBQUEsSUFBSSxFQUFBLGFBQWEsRUFBQSx3WUFBd1ksRUFBQSxTQUFTLEVBQUEsc0JBQXNCLEVBQUEsS0FBSyxFQUFDLEdBQUcsRUFBQSxZQUFZLEVBQUEsU0FBUyxFQUFBLDBCQUEwQixFQUFBLFVBQVUsRUFBQSxzQkFBc0IsRUFBQSxHQUFHLEVBQUEsQ0FBQyxFQUFBLHNCQUFzQixFQUFBLEdBQUcsRUFBQSxZQUFZLEVBQUEsVUFBVSxFQUFBLDBCQUEwQixFQUFBLFFBQVEsRUFBQSxzQkFBc0IsRUFBQSxNQUFNLEVBQUEsWUFBWSxFQUFBLFFBQVEsRUFBQSwwQkFBMEIsRUFBQSxLQUFLLEVBQUEsc0JBQXNCLEVBQUEsSUFBSSxFQUFBLFlBQVksRUFBQSxRQUFRLEVBQUEsMEJBQTBCLEVBQUEsSUFBSSxFQUFBLHNCQUFzQixFQUFBLE1BQU0sRUFBQyxJQUFJLEVBQUEsWUFBWSxFQUFBLFdBQVcsRUFBQSxjQUFjLEVBQUEsT0FBTyxFQUFBLHFGQUFxRixFQUFBLElBQUksRUFBQSxzQkFBc0IsRUFBQSxRQUFRLEVBQUEsc0JBQXNCLEVBQUEsT0FBTyxFQUFBLFlBQVksRUFBQSxJQUFJLEVBQUEsMEJBQTBCLEVBQUEsTUFBTSxFQUFBLHNCQUFzQixFQUFBLElBQUksRUFBQSxZQUFZLEVBQUEsTUFBTSxFQUFBLDBCQUEwQixFQUFBLFVBQVUsRUFBQSxzQkFBc0IsRUFBQSxVQUFVLEVBQUEsWUFBWSxFQUFBLFVBQVUsRUFBQSxj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QUFDLEVBQUMsQ0FBQyxFQUFHLEVBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFBLENBQUE7UUFDM3lCLENBQUMsQUFEMHlCO0lBQzN5QixDQUFDLEFBRDB5QjtZQUMzeUIsQ0FBQztJQUFELENBQUMsQUFEMHlCO0FBQzN5QixDQUFDLEFBRDB5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNraWxsUmVzcG9uc2UsIFRvb2xJbXBsZW1lbnRhdGlvbiB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IGF4aW9zLCB7IEF4aW9zRXJyb3IgfSBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyBoYW5kbGVUYXhRdWVyeSB9IGZyb20gJy4vdGF4RXhwZXJ0U2tpbGxzJztcblxuLy8gRW5oYW5jZWQgdHlwZXMgZm9yIGZpbmFuY2UgaW50ZXJhY3Rpb25zXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFuY2VRdWVyeSB7XG4gIGludGVudDogJ25ldF93b3J0aCcgfCAnYnVkZ2V0cycgfCAnc3BlbmRpbmcnIHwgJ2dvYWxzJyB8ICdhY2NvdW50cycgfCAnaW52ZXN0bWVudHMnIHwgJ2luc2lnaHRzJyB8ICdjcmVhdGVfYnVkZ2V0JyB8ICdjcmVhdGVfZ29hbCcgfCAndGF4X3F1ZXN0aW9uJztcbiAgcGFyYW1ldGVyczogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgdGltZWZyYW1lPzogJ2N1cnJlbnQnIHwgJ2xhc3RfbW9udGgnIHwgJ2xhc3Rfd2VlaycgfCAndGhpc19xdWFydGVyJyB8ICd5ZWFyX3RvX2RhdGUnIHwgJ2N1c3RvbSc7XG4gIGNhdGVnb3J5Pzogc3RyaW5nO1xuICBhbW91bnQ/OiBudW1iZXI7XG4gIGdvYWxfdHlwZT86ICdlbWVyZ2VuY3knIHwgJ3JldGlyZW1lbnQnIHwgJ3B1cmNoYXNlJyB8ICdkZWJ0X3BheW9mZicgfCAndmFjYXRpb24nO1xufVxuXG4vLyBDb21wcmVoZW5zaXZlIGZpbmFuY2UgYWdlbnQgc2tpbGxzIGV4dGVuZGluZyBleGlzdGluZyBBdG9tIGFnZW50IGNhcGFiaWxpdGllc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUZpbmFuY2VRdWVyeShcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHF1ZXJ5OiBzdHJpbmcsXG4gIGNvbnRleHQ/OiBhbnlcbik6IFByb21pc2U8U2tpbGxSZXNwb25zZTxzdHJpbmc+PiB7XG4gIHRyeSB7XG4gICAgLy8gSW50ZW50IGRldGVjdGlvbiBhbmQgcGFyYW1ldGVyIGV4dHJhY3Rpb24gZnJvbSBuYXR1cmFsIGxhbmd1YWdlXG4gICAgY29uc3QgaW50ZW50ID0gYXdhaXQgZXh0cmFjdEZpbmFuY2VJbnRlbnQocXVlcnksIGNvbnRleHQpO1xuXG4gICAgc3dpdGNoIChpbnRlbnQuaW50ZW50KSB7XG4gICAgICBjYXNlICduZXRfd29ydGgnOlxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0TmV0V29ydGhSZXNwb25zZSh1c2VySWQsIGludGVudC5wYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSAnYnVkZ2V0cyc6XG4gICAgICAgIHJldHVybiBhd2FpdCBnZXRCdWRnZXRSZXNwb25zZSh1c2VySWQsIGludGVudC5wYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSAnc3BlbmRpbmcnOlxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0U3BlbmRpbmdBbmFseXNpcyh1c2VySWQsIGludGVudC5wYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSAnZ29hbHMnOlxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0RmluYW5jaWFsR29hbHNSZXNwb25zZSh1c2VySWQsIGludGVudC5wYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSAnYWNjb3VudHMnOlxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0QWNjb3VudFN1bW1hcnkodXNlcklkLCBpbnRlbnQucGFyYW1ldGVycyk7XG5cbiAgICAgIGNhc2UgJ2ludmVzdG1lbnRzJzpcbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldEludmVzdG1lbnRTdW1tYXJ5KHVzZXJJZCwgaW50ZW50LnBhcmFtZXRlcnMpO1xuXG4gICAgICBjYXNlICdpbnNpZ2h0cyc6XG4gICAgICAgIHJldHVybiBhd2FpdCBnZXRGaW5hbmNpYWxJbnNpZ2h0cyh1c2VySWQsIGludGVudC5wYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSAnY3JlYXRlX2J1ZGdldCc6XG4gICAgICAgIHJldHVybiBhd2FpdCBjcmVhdGVCdWRnZXRSZXNwb25zZSh1c2VySWQsIGludGVudC5wYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSAnY3JlYXRlX2dvYWwnOlxuICAgICAgICByZXR1cm4gYXdhaXQgY3JlYXRlR29hbFJlc3BvbnNlKHVzZXJJZCwgaW50ZW50LnBhcmFtZXRlcnMpO1xuXG4gICAgICBjYXNlICd0YXhfcXVlc3Rpb24nOlxuICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlVGF4UXVlcnkodXNlcklkLCBxdWVyeSwgY29udGV4dCk7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBhd2FpdCBwcm92aWRlRmluYW5jZUhlbHAodXNlcklkKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRmluYW5jZSBxdWVyeSBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9rOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdGSU5BTkNFX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogJ0kgZW5jb3VudGVyZWQgYW4gaXNzdWUgcHJvY2Vzc2luZyB5b3VyIGZpbmFuY2lhbCBxdWVyeS4gUGxlYXNlIHRyeSByZXBocmFzaW5nIG9yIGNvbnRhY3Qgc3VwcG9ydC4nXG4gICAgICB9XG4gICAgfTtcbiAgfVxufVxuXG4vLyBJbnRlbnQgcmVjb2duaXRpb24gZm9yIG5hdHVyYWwgbGFuZ3VhZ2UgZmluYW5jZSBxdWVyaWVzXG5hc3luYyBmdW5jdGlvbiBleHRyYWN0RmluYW5jZUludGVudChxdWVyeTogc3RyaW5nLCBjb250ZXh0PzogYW55KTogUHJvbWlzZTxGaW5hbmNlUXVlcnk+IHtcbiAgY29uc3Qgbm9ybWFsaXplZFF1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG5cbiAgLy8gTmV0IHdvcnRoIGRldGVjdGlvblxuICBpZiAobm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCduZXQgd29ydGgnKSB8fFxuICAgICAgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCd0b3RhbCBhc3NldHMnKSB8fFxuICAgICAgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdob3cgbXVjaCBhbSBJIHdvcnRoJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnZmluYW5jaWFsIHBvc2l0aW9uJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnd2VhbHRoJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnY2FsY3VsYXRlIG5ldCB3b3J0aCcpKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGludGVudDogJ25ldF93b3J0aCcsXG4gICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgIGluY2x1ZGVIaXN0b3J5OiBub3JtYWxpemVkUXVlcnkuaW5jbHVkZXMoJ2hpc3RvcnknKSB8fCBub3JtYWxpemVkUXVlcnkuaW5jbHVkZXMoJ3RyZW5kJyksXG4gICAgICAgIHRpbWVmcmFtZTogZXh0cmFjdFRpbWVmcmFtZShub3JtYWxpemVkUXVlcnkpXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8vIEJ1ZGdldCBkZXRlY3Rpb25cbiAgaWYgKG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnYnVkZ2V0JykgfHwgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdzcGVuZGluZyBsaW1pdCcpKSB7XG4gICAgaWYgKG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnY3JlYXRlJykgfHwgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdzZXQnKSB8fCBub3JtYWxpemVkUXVlcnkuaW5jbHVkZXMoJ21ha2UnKSkge1xuICAgICAgY29uc3QgYnVkZ2V0TWF0Y2ggPSBub3JtYWxpemVkUXVlcnkubWF0Y2goLyg/OmNyZWF0ZXxzZXR8bWFrZSkuK2J1ZGdldC4qPyguKz8pXFxzKig/OmZvcnxvZilcXHMqXFwkPyhcXGQrKS9pKTtcbiAgICAgIGlmIChidWRnZXRNYXRjaCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGludGVudDogJ2NyZWF0ZV9idWRnZXQnLFxuICAgICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBidWRnZXRNYXRjaFsxXT8udHJpbSgpIHx8ICdnZW5lcmFsJyxcbiAgICAgICAgICAgIGFtb3VudDogcGFyc2VGbG9hdChidWRnZXRNYXRjaFsyXSB8fCAnMCcpXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgaW50ZW50OiAnYnVkZ2V0cycsXG4gICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgIGNhdGVnb3J5OiBleHRyYWN0Q2F0ZWdvcnkobm9ybWFsaXplZFF1ZXJ5KSxcbiAgICAgICAgdGltZWZyYW1lOiBleHRyYWN0VGltZWZyYW1lKG5vcm1hbGl6ZWRRdWVyeSlcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gU3BlbmRpbmcgYW5hbHlzaXNcbiAgY29uc3Qgc3BlbmRpbmdQYXR0ZXJucyA9IFsnc3BlbmQnLCAnc3BlbnQnLCAnZXhwZW5zZXMnLCAnd2hlcmUgZGlkIG1vbmV5IGdvJywgJ3RyYW5zYWN0aW9ucycsICdwdXJjaGFzZXMnXTtcbiAgaWYgKHNwZW5kaW5nUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcyhwYXR0ZXJuKSkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaW50ZW50OiAnc3BlbmRpbmcnLFxuICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICBjYXRlZ29yeTogZXh0cmFjdENhdGVnb3J5KG5vcm1hbGl6ZWRRdWVyeSksXG4gICAgICAgIHRpbWVmcmFtZTogZXh0cmFjdFRpbWVmcmFtZShub3JtYWxpemVkUXVlcnkpLFxuICAgICAgICBhbW91bnQ6IGV4dHJhY3RBbW91bnRSYW5nZShub3JtYWxpemVkUXVlcnkpXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8vIEZpbmFuY2lhbCBnb2Fsc1xuICBpZiAobm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdnb2FsJykgfHwgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdzYXZpbmdzJykgfHwgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdzYXZlIGZvcicpKSB7XG4gICAgaWYgKG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnY3JlYXRlJykgfHwgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdzZXQnKSB8fCBub3JtYWxpemVkUXVlcnkuaW5jbHVkZXMoJ21ha2UnKSkge1xuICAgICAgY29uc3QgZ29hbE1hdGNoID0gbm9ybWFsaXplZFF1ZXJ5Lm1hdGNoKC8oPzpjcmVhdGV8c2V0fG1ha2UpLitnb2FsLitmb3JcXHMqKC4rPylcXHMqKD86b2Z8Zm9yKVxccypcXCQ/KFxcZCopL2kpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaW50ZW50OiAnY3JlYXRlX2dvYWwnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgbmFtZTogZ29hbE1hdGNoPy5bMV0/LnRyaW0oKSB8fCAnTmV3IEdvYWwnLFxuICAgICAgICAgIHRhcmdldEFtb3VudDogcGFyc2VGbG9hdChnb2FsTWF0Y2g/LlsyXSB8fCAnMCcpLFxuICAgICAgICAgIGdvYWxUeXBlOiBleHRyYWN0R29hbFR5cGUobm9ybWFsaXplZFF1ZXJ5KVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgaW50ZW50OiAnZ29hbHMnLFxuICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICBnb2FsVHlwZTogZXh0cmFjdEdvYWxUeXBlKG5vcm1hbGl6ZWRRdWVyeSksXG4gICAgICAgIGluY2x1ZGVBbGw6IHRydWVcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gSW52ZXN0bWVudCBhbmFseXNpc1xuICBpZiAobm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdpbnZlc3RtZW50JykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygncG9ydGZvbGlvJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnc3RvY2tzJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnbXV0dWFsIGZ1bmRzJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygncmV0dXJucycpIHx8XG4gICAgICBub3JtYWxpemVkUXVlcnkuaW5jbHVkZXMoJ3BlcmZvcm1hbmNlJykpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaW50ZW50OiAnaW52ZXN0bWVudHMnLFxuICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICBpbmNsdWRlSGlzdG9yeTogbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdoaXN0b3J5JykgfHwgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdwZXJmb3JtYW5jZScpLFxuICAgICAgICBzaG93QWxsb2NhdGlvbjogbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdhbGxvY2F0aW9uJykgfHwgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdkaXZlcnNpZmllZCcpXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8vIEFjY291bnQgc3VtbWFyeVxuICBpZiAobm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdhY2NvdW50cycpIHx8XG4gICAgICBub3JtYWxpemVkUXVlcnkuaW5jbHVkZXMoJ2JhbGFuY2VzJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnY2hlY2tpbmcnKSB8fFxuICAgICAgbm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCdzYXZpbmdzJykgfHxcbiAgICAgIG5vcm1hbGl6ZWRRdWVyeS5pbmNsdWRlcygnY3JlZGl0IGNhcmRzJykpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaW50ZW50OiAnYWNjb3VudHMnLFxuICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICBhY2NvdW50VHlwZTogZXh0cmFjdEFjY291bnRUeXBlKG5vcm1hbGl6ZWRRdWVyeSlcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gVGF4IHF1ZXN0aW9uc1xuICBpZiAobm9ybWFsaXplZFF1ZXJ5LmluY2x1ZGVzKCd0YXgnKSB8fCBub3JtYWxpemVkUXVlcnkuaW5jbHVkZXMoJ3RheGVzJykpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaW50ZW50OiAndGF4X3F1ZXN0aW9uJyxcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgcXVlcnk6IG5vcm1hbGl6ZWRRdWVyeVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvLyBCeSBkZWZhdWx0LCBwcm92aWRlIGhlbHBmdWwgc3VnZ2VzdGlvbnNcbiAgcmV0dXJuIHtcbiAgICBpbnRlbnQ6ICdpbnNpZ2h0cycsXG4gICAgcGFyYW1ldGVyczogeyBxdWVyeVR5cGU6ICdnZW5lcmFsJyB9XG4gIH07XG59XG5cbi8vIFJlc3BvbnNlIGdlbmVyYXRpb24gd2l0aCBpbnRlbGxpZ2VudCBmb3JtYXR0aW5nIGFuZCBpbnNpZ2h0c1xuYXN5bmMgZnVuY3Rpb24gZ2V0TmV0V29ydGhSZXNwb25zZSh1c2VySWQ6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPFNraWxsUmVzcG9uc2U8c3RyaW5nPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KCcvYXBpL2ZpbmFuY2lhbC9uZXQtd29ydGgvc3VtbWFyeScsIHtcbiAgICAgIHBhcmFtczogeyB1c2VySWQsIGluY2x1ZGVIaXN0b3J5OiBwYXJhbXMuaW5jbHVkZUhpc3RvcnkgfSxcbiAgICAgIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiB1c2VySWQgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTtcbiAgICBsZXQgcmVzcG9uc2VUZXh0ID0gYPCfkrAgKipOZXQgV29ydGggU3VtbWFyeSoqXFxuXFxuYDtcbiAgICByZXNwb25zZVRleHQgKz0gYCoqQ3VycmVudCBOZXQgV29ydGgqKjogKiokJHtkYXRhLmN1cnJlbnQudG9Mb2NhbGVTdHJpbmcoKX0qKlxcbmA7XG5cbiAgICBpZiAoZGF0YS5jaGFuZ2UgPiAwKSB7XG4gICAgICByZXNwb25zZVRleHQgKz0gYPCfk4ggKipUcmVuZGluZyBVcCoqOiArJCR7TWF0aC5hYnMoZGF0YS5jaGFuZ2UpLnRvTG9jYWxlU3RyaW5nKCl9ICgke2RhdGEuY2hhbmdlUGVyY2VudC50b0ZpeGVkKDEpfSUpIGZyb20gbGFzdCBwZXJpb2RcXG5gO1xuICAgIH0gZWxzZSBpZiAoZGF0YS5jaGFuZ2UgPCAwKSB7XG4gICAgICByZXNwb25zZVRleHQgKz0gYPCfk4kgKipUcmVuZGluZyBEb3duKio6IC0kJHtNYXRoLmFicyhkYXRhLmNoYW5nZSkudG9Mb2NhbGVTdHJpbmcoKX0gKCR7TWF0aC5hYnMoZGF0YS5jaGFuZ2VQZXJjZW50KS50b0ZpeGVkKDEpfSUpIGZyb20gbGFzdCBwZXJpb2RcXG5gO1xuICAgIH1cblxuICAgIHJlc3BvbnNlVGV4dCArPSBg8J+PpiAqKkFzc2V0cyoqOiAkJHtkYXRhLmFzc2V0cy50b0xvY2FsZVN0cmluZygpfSB8IPCfkrggKipMaWFiaWxpdGllcyoqOiAkJHtkYXRhLmxpYWJpbGl0aWVzLnRvTG9jYWxlU3RyaW5nKCl9XFxuYDtcblxuICAgIGlmIChkYXRhLmhpc3RvcnkgJiYgZGF0YS5oaXN0b3J5Lmxlbmd0aCA+IDEpIHtcbiAgICAgIHJlc3BvbnNlVGV4dCArPSBgXFxu8J+TiiAqKjEyLU1vbnRoIFRyZW5kKio6IFlvdXIgbmV0IHdvcnRoIGhhcyAke2RhdGEuY3VycmVudCA+IGRhdGEuaGlzdG9yeVswXT8ubmV0V29ydGggPyAnZ3Jvd24nIDogJ2NoYW5nZWQnfSBzaWduaWZpY2FudGx5IG92ZXIgdGhlIHBhc3QgeWVhclxcbmA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IHJlc3BvbnNlVGV4dCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ0FQSV9FUlJPUicsIG1lc3NhZ2U6ICdVbmFibGUgdG8gcmV0cmlldmUgbmV0IHdvcnRoIGRhdGEnIH0gfTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRCdWRnZXRSZXNwb25zZSh1c2VySWQ6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPFNraWxsUmVzcG9uc2U8c3RyaW5nPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KCcvYXBpL2ZpbmFuY2lhbC9idWRnZXRzL3N1bW1hcnknLCB7XG4gICAgICBwYXJhbXM6IHsgdXNlcklkLCB0aW1lZnJhbWU6IHBhcmFtcy50aW1lZnJhbWUgfSxcbiAgICAgIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiB1c2VySWQgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTtcbiAgICBsZXQgcmVzcG9uc2VUZXh0ID0gYPCfkrAgKipCdWRnZXQgT3ZlcnZpZXcqKlxcblxcbmA7XG5cbiAgICBpZiAoZGF0YS5jYXRlZ29yaWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IFwi8J+TiyBZb3UgaGF2ZW4ndCBzZXQgdXAgYW55IGJ1ZGdldHMgeWV0LiBTYXkgJ0NyZWF0ZSBhIGJ1ZGdldCBmb3IgZGluaW5nIG9mICQ1MDAnIHRvIGdldCBzdGFydGVkIVwiIH07XG4gICAgfVxuXG4gICAgcmVzcG9uc2VUZXh0ICs9IGBUb3RhbCBCdWRnZXQ6ICoqJCR7ZGF0YS50b3RhbEJ1ZGdldC50b0xvY2FsZVN0cmluZygpfSoqIHwgU3BlbnQ6ICoqJCR7ZGF0YS5zcGVudC50b0xvY2FsZVN0cmluZygpfSoqIHwgUmVtYWluaW5nOiAqKiQke2RhdGEucmVtYWluaW5nLnRvTG9jYWxlU3RyaW5nKCl9KipcXG5cXG5gO1xuXG4gICAgZGF0YS5jYXRlZ29yaWVzLnNsaWNlKDAsIDUpLmZvckVhY2goKGNhdGVnb3J5OiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IGVtb2ppID0gY2F0ZWdvcnkudXRpbGl6YXRpb24gPj0gMTAwID8gJ+KaoO+4jycgOiBjYXRlZ29yeS51dGlsaXphdGlvbiA+PSA4MCA/ICfwn5+hJyA6ICfinIUnO1xuICAgICAgY29uc3Qgc3RhdHVzID0gY2F0ZWdvcnkucmVtYWluaW5nIDwgMCA/IGAqKiQke01hdGguYWJzKGNhdGVnb3J5LnJlbWFpbmluZykudG9Mb2NhbGVTdHJpbmcoKX0gb3ZlcioqYCA6IGAkJHtjYXRlZ29yeS5yZW1haW5pbmcudG9Mb2NhbGVTdHJpbmcoKX0gbGVmdGA7XG4gICAgICByZXNwb25zZVRleHQgKz0gYCR7ZW1vaml9ICR7Y2F0ZWdvcnkuY2F0ZWdvcnl9OiAkJHtjYXRlZ29yeS5zcGVudC50b0xvY2FsZVN0cmluZygpfSAvICQke2NhdGVnb3J5LmJ1ZGdldGVkLnRvTG9jYWxlU3RyaW5nKCl9ICgke2NhdGVnb3J5LnV0aWxpemF0aW9uLnRvRml4ZWQoMCl9JSkgLSAke3N0YXR1c31cXG5gO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IHJlc3BvbnNlVGV4dCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ0FQSV9FUlJPUicsIG1lc3NhZ2U6ICdVbmFibGUgdG8gcmV0cmlldmUgYnVkZ2V0IGluZm9ybWF0aW9uJyB9IH07XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0U3BlbmRpbmdBbmFseXNpcyh1c2VySWQ6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPFNraWxsUmVzcG9uc2U8c3RyaW5nPj4ge1xuICB0cnkge1xuICAgIC8vIEZvcm1hdCBkYXRlIHJhbmdlIGJhc2VkIG9uIHRpbWVmcmFtZVxuICAgIGNvbnN0IHsgc3RhcnREYXRlLCBlbmREYXRlIH0gPSBnZXREYXRlUmFuZ2VGb3JUaW1lZnJhbWUocGFyYW1zLnRpbWVmcmFtZSB8fCAndGhpc19tb250aCcpO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KCcvYXBpL2ZpbmFuY2lhbC90cmFuc2FjdGlvbnMvc2VhcmNoJywge1xuICAgICAgdXNlcklkLFxuICAgICAgZGF0ZVJhbmdlOiB7IHN0YXJ0OiBzdGFydERhdGUsIGVuZDogZW5kRGF0ZSB9LFxuICAgICAgY2F0ZWdvcnk6IHBhcmFtcy5jYXRlZ29yeSxcbiAgICAgIGxpbWl0OiA1MFxuICAgIH0sIHtcbiAgICAgIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiB1c2VySWQgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgdHJhbnNhY3Rpb25zID0gcmVzcG9uc2UuZGF0YS50cmFuc2FjdGlvbnM7XG4gICAgaWYgKHRyYW5zYWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7IG9rOiB0cnVlLCBkYXRhOiBcIvCfkrggTm8gdHJhbnNhY3Rpb25zIGZvdW5kIGluIHRoZSBzcGVjaWZpZWQgcGVyaW9kLiBUcnkgYWRqdXN0aW5nIHlvdXIgdGltZWZyYW1lIG9yIGNhdGVnb3J5IGZpbHRlci5cIiB9O1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBzcGVuZGluZyBieSBjYXRlZ29yeVxuICAgIGNvbnN0IHNwZW5kaW5nQnlDYXRlZ29yeSA9IHt9O1xuICAgIHRyYW5zYWN0aW9ucy5mb3JFYWNoKCh0cmFuc2FjdGlvbjogYW55KSA9PiB7XG4gICAgICBjb25zdCBjYXQgPSB0cmFuc2FjdGlvbi5jYXRlZ29yeSB8fCAnVW5jYXRlZ29yaXplZCc7XG4gICAgICBzcGVuZGluZ0J5Q2F0ZWdvcnlbY2F0XSA9IChzcGVuZGluZ0J5Q2F0ZWdvcnlbY2F0XSB8fCAwKSArIE1hdGguYWJzKHRyYW5zYWN0aW9uLmFtb3VudCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCB0b3RhbFNwZW50ID0gT2JqZWN0LnZhbHVlcyhzcGVuZGluZ0J5Q2F0ZWdvcnkpLnJlZHVjZSgoc3VtOiBhbnksIGFtb3VudDogYW55KSA9PiBzdW0gKyBhbW91bnQsIDApO1xuXG4gICAgbGV0IHJlc3BvbnNlVGV4dCA9IGDwn5K4ICoqU3BlbmRpbmcgQW5hbHlzaXMgKCR7cGFyYW1zLnRpbWVmcmFtZSB8fCAndGhpcyBtb250aCd9KSoqXFxuXFxuYDtcbiAgICByZXNwb25zZVRleHQgKz0gYCoqVG90YWwgU3BlbnQqKjogKiokJHt0b3RhbFNwZW50LnRvTG9jYWxlU3RyaW5nKCl9KipcXG5cXG5gO1xuXG4gICAgLy8gU29ydCBieSBhbW91bnQgc3BlbnRcbiAgICBjb25zdCBzb3J0ZWRTcGVuZGluZyA9IE9iamVjdC5lbnRyaWVzKHNwZW5kaW5nQnlDYXRlZ29yeSlcbiAgICAgIC5zb3J0KChbLCBhXSwgWywgYl0pID0+IChiIGFzIGFueSkgLSAoYSBhcyBhbnkpKVxuICAgICAgLnNsaWNlKDAsIDUpO1xuXG4gICAgc29ydGVkU3BlbmRpbmcuZm9yRWFjaCgoW2NhdGVnb3J5LCBhbW91bnRdLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgcGVyY2VudGFnZSA9ICgoYW1vdW50IGFzIGFueSkgLyB0b3RhbFNwZW50ICogMTAwKS50b0ZpeGVkKDEpO1xuICAgICAgcmVzcG9uc2VUZXh0ICs9IGAke2luZGV4ICsgMX0uICoqJHtjYXRlZ29yeX0qKjogJCR7KGFtb3VudCBhcyBhbnkpLnRvTG9jYWxlU3RyaW5nKCl9ICgke3BlcmNlbnRhZ2V9JSlcXG5gO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IHJlc3BvbnNlVGV4dCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ0FQSV9FUlJPUicsIG1lc3NhZ2U6ICdVbmFibGUgdG8gYW5hbHl6ZSBzcGVuZGluZyBkYXRhJyB9IH07XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RmluYW5jaWFsR29hbHNSZXNwb25zZSh1c2VySWQ6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPFNraWxsUmVzcG9uc2U8c3RyaW5nPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KCcvYXBpL2ZpbmFuY2lhbC9nb2FscycsIHtcbiAgICAgIHBhcmFtczogeyB1c2VySWQsIGdvYWxUeXBlOiBwYXJhbXMuZ29hbFR5cGUgfSxcbiAgICAgIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiB1c2VySWQgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgZ29hbHMgPSByZXNwb25zZS5kYXRhLmdvYWxzO1xuICAgIGlmIChnb2Fscy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG9rOiB0cnVlLFxuICAgICAgICBkYXRhOiBcIvCfkq0gWW91IGhhdmVuJ3Qgc2V0IHVwIGFueSBmaW5hbmNpYWwgZ29hbHMgeWV0LiBTYXkgJ0NyZWF0ZSBhIHNhdmluZ3MgZ29hbCBmb3IgdmFjYXRpb24gb2YgJDUwMDAnIHRvIGdldCBzdGFydGVkIVwiXG4gICAgICB9O1xuICAgIH1cblxuICAgIGxldCByZXNwb25zZVRleHQgPSBg8J+OryAqKllvdXIgRmluYW5jaWFsIEdvYWxzKipcXG5cXG5gO1xuXG4gICAgZ29hbHMuZm9yRWFjaCgoZ29hbDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmVzc0JhciA9IGdlbmVyYXRlUHJvZ3Jlc3NCYXIoZ29hbC5wcm9ncmVzcyk7XG4gICAgICBjb25zdCBzdGF0dXNFbW9qaSA9IGdvYWwuc3RhdHVzID09PSAnY29tcGxldGVkJyA/ICfinIUnIDogZ29hbC5wcm9ncmVzcyA+PSA4MCA/ICfwn5qAJyA6ICfwn46vJztcblxuICAgICAgcmVzcG9uc2VUZXh0ICs9IGAke3N0YXR1c0Vtb2ppfSAqKiR7Z29hbC5uYW1lfSoqXFxuYDtcbiAgICAgIHJlc3BvbnNlVGV4dCArPSBgJHtwcm9ncmVzc0Jhcn0gJHtnb2FsLnByb2dyZXNzLnRvRml4ZWQoMSl9JVxcbmA7XG4gICAgICByZXNwb25zZVRleHQgKz0gYFByb2dyZXNzOiAqKiQke2dvYWwuY3VycmVudC50b0xvY2FsZVN0cmluZygpfSoqIC8gKiokJHtnb2FsLnRhcmdldC50b0xvY2FsZVN0cmluZygpfSoqYDtcblxuICAgICAgaWYgKGdvYWwuZGVhZGxpbmUpIHtcbiAgICAgICAgY29uc3QgZGF5c0xlZnQgPSBNYXRoLmNlaWwoKG5ldyBEYXRlKGdvYWwuZGVhZGxpbmUpLmdldFRpbWUoKSAtIERhdGUubm93KCkpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgICAgICAgcmVzcG9uc2VUZXh0ICs9IGAgfCAqKiR7ZGF5c0xlZnR9IGRheXMqKiBsZWZ0XFxuYDtcbiAgICAgIH1cblxuICAgICAgcmVzcG9uc2VUZXh0ICs9IGAke2dvYWwudGFyZ2V0IC0gZ29hbC5jdXJyZW50ID4gMCA/IGAkJHsoZ29hbC50YXJnZXQgLSBnb2FsLmN1cnJlbnQpLnRvTG9jYWxlU3RyaW5nKCl9IHRvIGdvYCA6ICdDb21wbGV0ZWQhJ31cXG5cXG5gO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IHJlc3BvbnNlVGV4dCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ0FQSV9FUlJPUicsIG1lc3NhZ2U6ICdVbmFibGUgdG8gcmV0cmlldmUgZ29hbHMnIH0gfTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY2NvdW50U3VtbWFyeSh1c2VySWQ6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPFNraWxsUmVzcG9uc2U8c3RyaW5nPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IGFjY291bnRUeXBlID0gcGFyYW1zLmFjY291bnRUeXBlIHx8ICdhbGwnO1xubiAgICBsZXQgcmVzcG9uc2VUZXh0ID0gYPCfj6YgKipBY2NvdW50IFN1bW1hcnkqKlxcblxcbmA7XG5uXG4gICAgaWYgKGFjY291bnRUeXBlID09PSAnY2FzaCcgfHwgYWNjb3VudFR5cGUgPT09ICdhbGwnKSB7XG4gICAgICBjb25zdCBjYXNoQWNjb3VudHMgPSBhd2FpdCBnZXRBY2NvdW50c0J5VHlwZSh1c2VySWQsIFsnY2hlY2tpbmcnLCAnc2F2aW5ncycsICdtb25leV9tYXJrZXQnXSk7XG5uICAgICAgY29uc3QgdG90YWxDYXNoID0gY2FzaEFjY291bnRzLnJlZHVjZSgoc3VtLCBhY2MpID0+IHN1bSArIGFjYy5iYWxhbmNlLCAwKTtcbm4gICAgICByZXNwb25zZVRleHQgKz0gYPCfkrAgKipBdmFpbGFibGUgQ2FzaCoqOiAqKiQke3RvdGFsQ2FzaC50b0xvY2FsZVN0cmluZygpfSoqXFxuYDtcbm4gICAgfVxublxuICAgIGlmIChhY2NvdW50VHlwZSA9PT0gJ2NyZWRpdCcgfHwgYWNjb3VudFR5cGUgPT09ICdhbGwnKSB7XG4gICAgICBjb25zdCBjcmVkaXRDYXJkcyA9IGF3YWl0IGdldEFjY291bnRzQnlUeXBlKHVzZXJJZCwgWydjcmVkaXRfY2FyZCcsICdsaW5lX29mX2NyZWRpdCddKTtcbm4gICAgICBjb25zdCB0b3RhbENyZWRpdCA9IGNyZWRpdENhcmRzLnJlZHVjZSgoc3VtLCBhY2MpID0+IHN1bSArIE1hdGguYWJzKGFjYy5iYWxhbmNlKSwgMCk7XG5uICAgICAgcmVzcG9uc2VUZXh0ICs9IGDwn5KzICoqQ3JlZGl0IENhcmRzKio6ICoqJCR7dG90YWxDcmVkaXQudG9Mb2NhbGVTdHJpbmcoKX0qKiBhdmFpbGFibGVcXG5gO1xubiAgICB9XFxuICAgIFxcbiAgICBjb25zdCBhbGxBY2NvdW50cyA9IGF3YWl0IGdldEFsbFVzZXJBY2NvdW50cyh1c2VySWQpO1xcbiAgICBhbGxBY2NvdW50cy5mb3JFYWNoKGFjY291bnQgPT4ge1xubiAgICAgIGNvbnN0IGFjY291bnRUeXBlID0gYWNjb3VudC5hY2NvdW50X3R5cGUgfHwgJ2dlbmVyYWwnO1xcbiAgICAgIGNvbnN0IGFjY291bnRTeW1ib2wgPSBnZXRBY2NvdW50RW1vamkoYWNjb3VudFR5cGUpO1xcbiAgICAgIHJlc3BvbnNlVGV4dCArPSBgJHthY2NvdW50U3ltYm9sfSAqKiR7YWNjb3VudC5hY2NvdW50X25hbWUgfHwgJ1VudGl0bGVkJ30qKjogKiokJHthY2NvdW50LmJhbGFuY2UudG9Mb2NhbGVTdHJpbmcoKX0qKiAoJHthY2NvdW50VHlwZX0pXFxuYDtcXG4gICAgfSk7XFxuICAgIFxcbiAgICByZXR1cm4geyBvazogdHJ1ZSwgZGF0YTogcmVzcG9uc2VUZXh0IH07XFxuICB9IGNhdGNoIChlcnJvcikge1xcbiAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdBUElfRVJST1InLCBtZXNzYWdlOiAnVW5hYmxlIHRvIHJldHJpZXZlIGFjY291bnQgaW5mb3JtYXRpb24nIH0gfTtcXG4gIH1cXG59XFxuXFxuYXN5bmMgZnVuY3Rpb24gZ2V0SW52ZXN0bWVudFN1bW1hcnkodXNlcklkOiBzdHJpbmcsIHBhcmFtczogYW55KTogUHJvbWlzZTxTa2lsbFJlc3BvbnNlPHN0cmluZz4+IHtcbm4gIHRyeSB7XFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KCcvYXBpL2ZpbmFuY2lhbC9pbnZlc3RtZW50cy9zdW1tYXJ5Jywge1xcbiAgICAgIHBhcmFtczogeyB1c2VySWQsIGluY2x1ZGVIaXN0b3J5OiBwYXJhbXMuaW5jbHVkZUhpc3RvcnkgfSxcXG4gICAgICBoZWFkZXJzOiB7ICdBdXRob3JpemF0aW9uJzogdXNlcklkIH1cXG4gICAgfSk7XFxuICAgIFxcbiAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTtcXG4gICAgaWYgKCFkYXRhLmhvbGRpbmdzIHx8IGRhdGEuaG9sZGluZ3MubGVuZ3RoID09PSAwKSB7XFxuICAgICAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IFxcXCLwn5OIIFlvdSBkb24ndCBoYXZlIGFueSBjb25uZWN0ZWQgaW52ZXN0bWVudCBhY2NvdW50cy4gV291bGQgeW91IGxpa2UgdG8gc2V0IHVwIGludmVzdG1lbnQgdHJhY2tpbmc/XFxcIiB9O1xcbiAgICB9XFxuICAgIFxcbiAgICBsZXQgcmVzcG9uc2VUZXh0ID0gYPCfk4ggKipJbnZlc3RtZW50IFBvcnRmb2xpbyoqXFxuXFxuYDtcXG4gICAgcmVzcG9uc2VUZXh0ICs9IGAqKlRvdGFsIFZhbHVlKio6ICoqJCR7ZGF0YS50b3RhbFZhbHVlLnRvTG9jYWxlU3RyaW5nKCl9KipgO1xcbiAgICBcXG4gICAgaWYgKGRhdGEudG90YWxHYWluTG9zcyAhPT0gdW5kZWZpbmVkKSB7XFxuICAgICAgY29uc3QgdHJlbmRFbW9qaSA9IGRhdGEudG90YWxHYWluTG9zcyA+PSAwID8gJ/Cfk4gnIDogJ/Cfk4knO1xcbiAgICAgIHJlc3BvbnNlVGV4dCArPSBgIHwgJHt0cmVuZEVtb2ppfSBBbGwgVGltZTogKioke2RhdGEudG90YWxHYWluTG9zcyA+PSAwID8gJysnIDogJyd9JCR7TWF0aC5hYnMoZGF0YS50b3RhbEdhaW5Mb3NzKS50b0xvY2FsZVN0cmluZygpfSAoJHtkYXRhLnRvdGFsUmV0dXJuUGN0Py50b0ZpeGVkKDEpfSUpKipgO1xcbiAgICB9XFxuICAgIFxcbiAgICByZXNwb25zZVRleHQgKz0gYFxcblxcbioqVG9wIEhvbGRpbmdzKio6XFxuYDtcXG4gICAgZGF0YS5ob2xkaW5ncy5zbGljZSgwLCA1KS5mb3JFYWNoKChob2xkaW5nOiBhbnkpID0+IHtcXG4gICAgICBjb25zdCBob2xkaW5nRW1vamkgPSBob2xkaW5nLnRvdGFsUmV0dXJuUGN0ID49IDAgPyAn8J+foicgOiAn8J+UtCc7XFxuICAgICAgcmVzcG9uc2VUZXh0ICs9IGAke2hvbGRpbmdFbW9qaX0gKioke2hvbGRpbmcubmFtZX0qKjogJHtob2xkaW5nLnNoYXJlc30gQCAkJHtob2xkaW5nLnByaWNlPy50b0xvY2FsZVN0cmluZygpfSA9ICoqJCR7aG9sZGluZy52YWx1ZS50b0xvY2FsZVN0cmluZygpfSoqICgke2hvbGRpbmcudG90YWxSZXR1cm5QY3QgPj0gMCA/ICcrJyA6ICcnfSR7aG9sZGluZy50b3RhbFJldHVyblBjdD8udG9GaXhlZCgxKX0lKVxcbmA7XFxuICAgIH0pO1xcbiAgICBcXG4gICAgaWYgKGRhdGEuaG9sZGluZ3MubGVuZ3RoID4gNSkge1xcbiAgICAgIHJlc3BvbnNlVGV4dCArPSBgXFxuLi4uYW5kICoqJHtkYXRhLmhvbGRpbmdzLmxlbmd0aCAtIDV9IG1vcmUqKiDinqHvuI9gO1xcbiAgICB9XFxuICAgIFxcbiAgICByZXR1cm4geyBvazogdHJ1ZSwgZGF0YTogcmVzcG9uc2VUZXh0IH07XFxuICB9IGNhdGNoIChlcnJvcikge1xcbiAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdBUElfRVJST1InLCBtZXNzYWdlOiAnVW5hYmxlIHRvIHJldHJpZXZlIGludmVzdG1lbnQgZGF0YScgfSB9O1xcbiAgfVxcbn1cXG5cXG5hc3luYyBmdW5jdGlvbiBnZXRGaW5hbmNpYWxJbnNpZ2h0cyh1c2VySWQ6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPFNraWxsUmVzcG9uc2U8c3RyaW5nPj4ge1xcbiAgY29uc3QgaW5zaWdodHMgPSBbXFxuICAgIFxcXCLwn5SNICoqWW91ciBmaW5hbmNpYWwgaGVhbHRoIGxvb2tzIGdvb2QhKiogWW91ciBuZXQgd29ydGggaGFzIGJlZW4gc3RlYWRpbHkgaW5jcmVhc2luZy5cXFwiLFxcbiAgICBcXFwi4pqg77iPICoqV2F0Y2ggeW91ciBzcGVuZGluZyoqOiBZb3Ugc3BlbnQgMjMlIG1vcmUgb24gZGluaW5nIG91dCBsYXN0IG1vbnRoIGNvbXBhcmVkIHRvIHlvdXIgYXZlcmFnZS5cXFwiLFxcbiAgICBcXFwi8J+SoSAqKkdvYWwgU3RyYXRlZ3kqKjogQXQgeW91ciBjdXJyZW50IHNhdmluZ3MgcmF0ZSwgeW91J2xsIHJlYWNoIHlvdXIgdmFjYXRpb24gZ29hbCAyIG1vbnRocyBlYXJseS5cXFwiLFxcbiAgICBcXFwi8J+OryAqKkJ1ZGdldCBBbGVydCoqOiBZb3VyIGVudGVydGFpbm1lbnQgYnVkZ2V0IGlzIDg1JSB1dGlsaXplZCB0aGlzIG1vbnRoLlxcXCIsXFxuICAgIFxcXCLwn4+mICoqQWNjb3VudCBUaXAqKjogQ29uc2lkZXIgbW92aW5nIHNhdmluZ3MgZnJvbSBjaGVja2luZyB0byBoaWdoLXlpZWxkIHNhdmluZ3MgYWNjb3VudCBmb3IgYmV0dGVyIHJldHVybnMuXFxcIixcXG4gICAgXFxcIvCfk4ogKipJbnZlc3RtZW50IE91dGxvb2sqKjogWW91ciB0ZWNoIHN0b2NrIGFsbG9jYXRpb24gaXMgNjUlIC0gY29uc2lkZXIgZGl2ZXJzaWZpY2F0aW9uLlxcXCIsXFxuICBdO1xcbiAgXFxuICBjb25zdCByZXNwb25zZVRleHQgPSBpbnNpZ2h0c1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBpbnNpZ2h0cy5sZW5ndGgpXSArIGBcXG5cXG7wn5KtIFdhbnQgbW9yZSBzcGVjaWZpYyBpbnNpZ2h0cz8gQXNrIG1lIGFib3V0IHlvdXIgKipidWRnZXRzKiosICoqZ29hbHMqKiwgb3IgKipzcGVuZGluZyBoYWJpdHMqKi5gO1xcbiAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IHJlc3BvbnNlVGV4dCB9O1xcbn1cXG5cXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVCdWRnZXRSZXNwb25zZSh1c2VySWQ6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPFNraWxsUmVzcG9uc2U8c3RyaW5nPj4ge1xcbiAgYXdhaXQgc2ltdWxhdGVBUElDYWxsKDE1MDApO1xcbiAgY29uc3Qgc3VjY2Vzc01lc3NhZ2UgPSBg4pyFICoqQnVkZ2V0IENyZWF0ZWQgU3VjY2Vzc2Z1bGx5KipcXG5cXG4qKiR7cGFyYW1zLmNhdGVnb3J5fSBCdWRnZXQqKjogKiokJHtwYXJhbXMuYW1vdW50LnRvTG9jYWxlU3RyaW5nKCl9KiogcGVyIG1vbnRoXFxuXFxuSSd2ZSBzZXQgdXAgeW91ciBuZXcgYnVkZ2V0ISBZb3UnbGwgZ2V0IG5vdGlmaWNhdGlvbnMgd2hlbiB5b3UncmUgYXBwcm9hY2hpbmcgODAlIG9mIHlvdXIgYnVkZ2V0LiBXYW50IG1lIHRvIGhlbHAgeW91IHNldCB1cCAqKnRyYW5zYWN0aW9uIGNhdGVnb3JpemF0aW9uIHJ1bGVzKiogb3IgY3JlYXRlICoqbWlsZXN0b25lIGFsZXJ0cyoqP2A7XFxuICBcXG4gIHJldHVybiB7IG9rOiB0cnVlLCBkYXRhOiBzdWNjZXNzTWVzc2FnZSB9O1xcbn1cXG5cXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVHb2FsUmVzcG9uc2UodXNlcklkOiBzdHJpbmcsIHBhcmFtczogYW55KTogUHJvbWlzZTxTa2lsbFJlc3BvbnNlPHN0cmluZz4+IHtcXG4gIGF3YWl0IHNpbXVsYXRlQVBJQ2FsbCgxNTAwKTtcXG4gIGNvbnN0IHRhcmdldERhdGUgPSBwYXJhbXMudGFyZ2V0RGF0ZSA/IG5ldyBEYXRlKHBhcmFtcy50YXJnZXREYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoKSA6ICdvcGVuLWVuZGVkJztcXG4gIGNvbnN0IHN1Y2Nlc3NNZXNzYWdlID0gYPCfjq8gKipHb2FsIENyZWF0ZWQgU3VjY2Vzc2Z1bGx5KipcXG5cXG4qKiR7cGFyYW1zLm5hbWV9IEdvYWwqKjogU2F2ZSAqKiQke3BhcmFtcy50YXJnZXRBbW91bnQudG9Mb2NhbGVTdHJpbmcoKX0qKiBmb3IgJHtwYXJhbXMuZ29hbFR5cGUucmVwbGFjZSgnXycsICcgJyl9XFxuJHtwYXJhbXMudGFyZ2V0RGF0ZSA/IGBUYXJnZXQgRGF0ZTogKioke3RhcmdldERhdGV9KipgIDogJyd9XFxuXFxuWW91ciBnb2FsIGlzIG5vdyBhY3RpdmUhIEknbGwgaGVscCB0cmFjayB5b3VyIHByb2dyZXNzIGFuZCBwcm92aWRlIHBlcmlvZGljIHVwZGF0ZXMuIFdvdWxkIHlvdSBsaWtlIHRvIHNldCB1cCAqKmF1dG9tYXRpYyBjb250cmlidXRpb25zKiogb3Igc2V0IHVwICoqcHJvZ3Jlc3MgbWlsZXN0b25lIG5vdGlmaWNhdGlvbnMqKj9gO1xcbiAgXFxuICByZXR1cm4geyBvazogdHJ1ZSwgZGF0YTogc3VjY2Vzc01lc3NhZ2UgfTtcXG59XFxuXFxuYXN5bmMgZnVuY3Rpb24gcHJvdmlkZUZpbmFuY2VIZWxwKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTa2lsbFJlc3BvbnNlPHN0cmluZz4+IHtcXG4gIGNvbnN0IGhlbHBUZXh0ID0gYPCfkqEgKipGaW5hbmNlIEFnZW50IEhlbHAgQ2VudGVyKipcXG5cXG5Zb3UgY2FuIGFzayBtZSBhYm91dDpcXG5cXG7wn4+mICoqQWNjb3VudCBNYW5hZ2VtZW50KipcXG7igKIgXFxcXFwiU2hvdyBteSBhY2NvdW50IGJhbGFuY2VzXFxcXFwiXFxu4oCiIFxcXFxcIkhvdyBtdWNoIGRvIEkgaGF2ZSBpbiBzYXZpbmdzP1xcXFxcIlxcbuKAoiBcXFxcXCJXaGF0J3MgbXkgY2hlY2tpbmcgYWNjb3VudCBiYWxhbmNlP1xcXFxcIlxcblxcbvCfkrAgKipOZXQgV29ydGggJiBGaW5hbmNpYWwgSGVhbHRoKipcXG7igKIgXFxcXFwiV2hhdCdzIG15IG5ldCB3b3J0aD9cXFxcXCJcXG7igKIgXFxcXFwiU2hvdyBteSBuZXQgd29ydGggdHJlbmRcXFxcXCJcXG7igKIgXFxcXFwiQ29tcGFyZSB0aGlzIG1vbnRoIHRvIGxhc3RcXFxcXCJcXG5cXG7wn5OKICoqQnVkZ2V0aW5nICYgU3BlbmRpbmcqKlxcbuKAoiBcXFxcXCJTaG93IG15IGJ1ZGdldHNcXFxcXCJcXG7igKIgXFxcXFwiSG93IG11Y2ggZGlkIEkgc3BlbmQgb24gZGluaW5nIHRoaXMgbW9udGg/XFxcXFwiXFxu4oCiIFxcXFxcIkNyZWF0ZSBhICQ0MDAgZ3JvY2VyeSBidWRnZXRcXFxcXCJcXG5cXG7wn46vICoqRmluYW5jaWFsIEdvYWxzKipcXG7igKIgXFxcXFwiU2hvdyBteSBzYXZpbmdzIGdvYWxzXFxcXFwiXFxu4oCiIFxcXFxcIkNyZWF0ZSBhbiBlbWVyZ2VuY3kgZnVuZCBnb2FsIG9mICQzMDAwXFxcXFwiXFxu4oCiIFxcXFxcIlRyYWNrIG15IHJldGlyZW1lbnQgcHJvZ3Jlc3NcXFxcXCJcXG5cXG7wn5OIICoqSW52ZXN0bWVudHMgJiBQZXJmb3JtYW5jZSoqXFxu4oCiIFxcXFxcIlNob3cgbXkgaW52ZXN0bWVudCBwb3J0Zm9saW9cXFxcXCJcXG7igKIgXFxcXFwiV2hhdCdzIG15IHBlcmZvcm1hbmNlIHRoaXMgcXVhcnRlcj9cXFxcXCJcXG7igKIgXFxcXFwiUG9ydGZvbGlvIGFsbG9jYXRpb25cXFxcXCJcXG5cXG4qKlRpcHMqKjogSSB1bmRlcnN0YW5kIG5hdHVyYWwgbGFuZ3VhZ2UgLSBqdXN0IHNwZWFrIG5vcm1hbGx5ISBUcnk6IFxcXFxcIkhvdyBtdWNoIGNhbiBJIHNhdmUgdGhpcyBtb250aD9cXFxcXCIgb3IgXFxcXFwiSSBuZWVkIHRvIHRyYWNrIG15IHZhY2F0aW9uIHNhdmluZ3MuXFxcXFwiYDtcXG4gIFxcbiAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGE6IGhlbHBUZXh0IH07XFxufVxcblxcbi8vIFV0aWxpdHkgRnVuY3Rpb25zXFxuZnVuY3Rpb24gZXh0cmFjdFRpbWVmcmFtZShxdWVyeTogc3RyaW5nKTogc3RyaW5nIHtcXG4gIGlmIChxdWVyeS5pbmNsdWRlcygnbGFzdCB3ZWVrJykpIHJldHVybiAnbGFzdF93ZWVrJztcXG4gIGlmIChxdWVyeS5pbmNsdWRlcygnbGFzdCBtb250aCcpKSByZXR1cm4gJ2xhc3RfbW9udGgnO1xcbiAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCd0aGlzIHF1YXJ0ZXInKSB8fCBxdWVyeS5pbmNsdWRlcygncXVhcnRlcicpKSByZXR1cm4gJ3RoaXNfcXVhcnRlcic7XFxuICBpZiAocXVlcnkuaW5jbHVkZXMoJ3RoaXMgeWVhcicpIHx8IHF1ZXJ5LmluY2x1ZGVzKCd5ZWFyIHRvIGRhdGUnKSkgcmV0dXJuICd5ZWFyX3RvX2RhdGUnO1xcbiAgcmV0dXJuICdjdXJyZW50JztcXG59XFxuXFxuZnVuY3Rpb24gZXh0cmFjdENhdGVnb3J5KHF1ZXJ5OiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xcbiAgY29uc3QgY2F0ZWdvcmllcyA9IFsnZGluaW5nJywgJ2dyb2NlcmllcycsICd0cmFuc3BvcnRhdGlvbicsICdlbnRlcnRhaW5tZW50JywgJ3Nob3BwaW5nJywgJ3V0aWxpdGllcycsICdiaWxscycsICdyZW50JywgJ2dhcycsICdmb29kJywgJ3Jlc3RhdXJhbnRzJywgJ2NvZmZlZScsICdkcmlua3MnLCAndHJhdmVsJywgJ3N1YnNjcmlwdGlvbnMnXTtcXG4gIGZvciAoY29uc3QgY2F0IG9mIGNhdGVnb3JpZXMpIHtcXG4gICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKGNhdCkpIHJldHVybiBjYXQ7XFxuICB9XFxuICByZXR1cm4gdW5kZWZpbmVkO1xcbn1cXG5cXG5mdW5jdGlvbiBleHRyYWN0QW1vdW50UmFuZ2UocXVlcnk6IHN0cmluZyk6IG51bWJlciB8IHVuZGVmaW5lZCB7XFxuICBjb25zdCBtYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9cXCQoXFxkKyg/OlxcLlxcZHsyfSk/KXwoXFxkKylcXHMqZG9sbGFycz8vaSk7XFxuICByZXR1cm4gbWF0Y2ggPyBwYXJzZUZsb2F0KG1hdGNoWzFdIHx8IG1hdGNoWzJdKSA6IHVuZGVmaW5lZDtcXG59XFxuXFxuZnVuY3Rpb24gZXh0cmFjdEdvYWxUeXBlKHF1ZXJ5OiBzdHJpbmcpOiBzdHJpbmcge1xcbiAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCdlbWVyZ2VuY3knKSB8fCBxdWVyeS5pbmNsdWRlcygncmFpbnkgZGF5JykpIHJldHVybiAnZW1lcmdlbmN5JztcXG4gIGlmIChxdWVyeS5pbmNsdWRlcygncmV0aXJlbWVudCcpIHx8IHF1ZXJ5LmluY2x1ZGVzKCc0MDFrJykgfHwgcXVlcnkuaW5jbHVkZXMoJ0lSQScpKSByZXR1cm4gJ3JldGlyZW1lbnQnO1xcbiAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCd2YWNhdGlvbicpIHx8IHF1ZXJ5LmluY2x1ZGVzKCd0cmF2ZWwnKSkgcmV0dXJuICd2YWNhdGlvbic7XFxuICBpZiAocXVlcnkuaW5jbHVkZXMoJ2hvdXNlJykgfHwgcXVlcnkuaW5jbHVkZXMoJ2hvbWUnKSkgcmV0dXJuICdwdXJjaGFzZSc7XFxuICBpZiAocXVlcnkuaW5jbHVkZXMoJ2RlYnQnKSB8fCBxdWVyeS5pbmNsdWRlcygnY3JlZGl0IGNhcmQnKSkgcmV0dXJuICdkZWJ0X3BheW9mZic7XFxuICByZXR1cm4gJ2dlbmVyYWwnO1xcbn1cXG5cXG5mdW5jdGlvbiBleHRyYWN0QWNjb3VudFR5cGUocXVlcnk6IHN0cmluZyk6IHN0cmluZyB7XFxuICBpZiAocXVlcnkuaW5jbHVkZXMoJ2Nhc2gnKSB8fCBxdWVyeS5pbmNsdWRlcygnY2hlY2tpbmcnKSB8fCBxdWVyeS5pbmNsdWRlcygnc2F2aW5ncycpKSByZXR1cm4gJ2Nhc2gnO1xcbiAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCdjcmVkaXQnKSB8fCBxdWVyeS5pbmNsdWRlcygnY2FyZCcpKSByZXR1cm4gJ2NyZWRpdCc7XFxuICBpZiAocXVlcnkuaW5jbHVkZXMoJ2ludmVzdG1lbnQnKSB8fCBxdWVyeS5pbmNsdWRlcygncmV0aXJlbWVudCcpKSByZXR1cm4gJ2ludmVzdG1lbnQnO1xcbiAgcmV0dXJuICdhbGwnO1xcbn1cXG5cXG5mdW5jdGlvbiBnZXRBY2NvdW50RW1vamkoYWNjb3VudFR5cGU6IHN0cmluZyk6IHN0cmluZyB7XFxuICBjb25zdCB0eXBlID0gYWNjb3VudFR5cGUudG9Mb3dlckNhc2UoKTtcXG4gIGlmICh0eXBlLmluY2x1ZGVzKCdzYXZpbmdzJykpIHJldHVybiAn8J+Ppic7XFxuICBpZiAodHlwZS5pbmNsdWRlcygnY2hlY2tpbmcnKSkgcmV0dXJuICfwn5KzJztcXG4gIGlmICh0eXBlLmluY2x1ZGVzKCdjcmVkaXQnKSkgcmV0dXJuICfwn5KzJztcXG4gIGlmICh0eXBlLmluY2x1ZGVzKCdpbnZlc3RtZW50JykpIHJldHVybiAn8J+TiCc7XFxuICBpZiAodHlwZS5pbmNsdWRlcygnbG9hbicpKSByZXR1cm4gJ/Cfk4QnO1xcbiAgcmV0dXJuICfwn5KwJztcXG59XFxuXFxuZnVuY3Rpb24gZ2VuZXJhdGVQcm9ncmVzc0JhcihwZXJjZW50YWdlOiBudW1iZXIsIGxlbmd0aDogbnVtYmVyID0gMTApOiBzdHJpbmcge1xcbiAgY29uc3QgZmlsbGVkQmxvY2tzID0gTWF0aC5yb3VuZCgocGVyY2VudGFnZSAvIDEwMCkgKiBsZW5ndGgpO1xcbiAgY29uc3QgZW1wdHlCbG9ja3MgPSBsZW5ndGggLSBmaWxsZWRCbG9ja3M7XFxuICByZXR1cm4gJ+KWkycucmVwZWF0KGZpbGxlZEJsb2NrcykgKyAn4paRJy5yZXBlYXQoZW1wdHlCbG9ja3MpO1xcbn1cXG5cXG5mdW5jdGlvbiBnZXREYXRlUmFuZ2VGb3JUaW1lZnJhbWUodGltZWZyYW1lOiBzdHJpbmcpOiB7IHN0YXJ0RGF0ZTogc3RyaW5nOyBlbmREYXRlOiBzdHJpbmcgfSB7XFxuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XFxuICBcXG4gIHN3aXRjaCAodGltZWZyYW1lKSB7XFxuICAgIGNhc2UgJ2xhc3Rfd2Vlayc6XFxuICAgICAgcmV0dXJuIHtcXG4gICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUodG9kYXkuZ2V0VGltZSgpIC0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcXG4gICAgICAgIGVuZERhdGU6IHRvZGF5LnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxcbiAgICAgIH07XFxuICAgIGNhc2UgJ2xhc3RfbW9udGgnOlxcbiAgICAgIGNvbnN0IGxhc3RNb250aCA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIHRvZGF5LmdldE1vbnRoKCkgLSAxLCAxKTtcXG4gICAgICBjb25zdCBsYXN0TW9udGhFbmQgPSBuZXcgRGF0ZSh0b2RheS5nZXRGdWxsWWVhcigpLCB0b2RheS5nZXRNb250aCgpLCAwKTtcXG4gICAgICByZXR1cm4ge1xcbiAgICAgICAgc3RhcnREYXRlOiBsYXN0TW9udGgudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxcbiAgICAgICAgZW5kRGF0ZTogbGFzdE1vbnRoRW5kLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxcbiAgICAgIH07XFxuICAgIGNhc2UgJ3RoaXNfcXVhcnRlcic6XFxuICAgICAgY29uc3QgcXVhcnRlclN0YXJ0ID0gbmV3IERhdGUodG9kYXkuZ2V0RnVsbFllYXIoKSwgTWF0aC5mbG9vcih0b2RheS5nZXRNb250aCgpIC8gMykgKiAzLCAxKTtcXG4gICAgICByZXR1cm4ge1xcbiAgICAgICAgc3RhcnREYXRlOiBxdWFydGVyU3RhcnQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxcbiAgICAgICAgZW5kRGF0ZTogdG9kYXkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXFxuICAgICAgfTtcXG4gICAgY2FzZSAneWVhcl90b19kYXRlJzpcXG4gICAgICByZXR1cm4ge1xcbiAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSh0b2RheS5nZXRGdWxsWWVhcigpLCAwLCAxKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXFxuICAgICAgICBlbmREYXRlOiB0b2RheS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF1cXG4gICAgICB9O1xcbiAgICBkZWZhdWx0OiAvLyBjdXJyZW50IG1vbnRoXFxuICAgICAgcmV0dXJuIHtcXG4gICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUodG9kYXkuZ2V0RnVsbFllYXIoKSwgdG9kYXkuZ2V0TW9udGgoKSwgMSkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxcbiAgICAgICAgZW5kRGF0ZTogdG9kYXkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXFxuICAgICAgfTtcXG4gIH1cXG59XFxuXFxuLy8gSGVscGVyIGZ1bmN0aW9ucyBmb3IgQVBJIGNhbGxzXFxuYXN5bmMgZnVuY3Rpb24gZ2V0QWNjb3VudHNCeVR5cGUodXNlcklkOiBzdHJpbmcsIHR5cGVzOiBzdHJpbmdbXSk6IFByb21pc2U8YW55W10+IHtcXG4gIC8vIFRoaXMgd291bGQgY2FsbCBhY3R1YWwgZmluYW5jaWFsIEFQSXNcXG4gIGF3YWl0IHNpbXVsYXRlQVBJQ2FsbCg1MDApO1xcbiAgcmV0dXJuIFtcXG4gICAgeyBhY2NvdW50X25hbWU6ICdDaGFzZSBDaGVja2luZycsIGFjY291bnRfdHlwZTogJ2NoZWNraW5nJywgYmFsYW5jZTogNTIzNC41NiB9LFxcbiAgICB7IGFjY291bnRfbmFtZTogJ0hpZ2ggWWllbGQgU2F2aW5ncycsIGFjY291bnRfdHlwZTogJ3NhdmluZ3MnLCBiYWxhbmNlOiAxNTg5MC4yMyB9XFxuICBdLmZpbHRlcihhY2MgPT4gdHlwZXMuaW5jbHVkZXMoYWNjLmFjY291bnRfdHlwZSkpO1xcbn1cXG5cXG5hc3luYyBmdW5jdGlvbiBnZXRBbGxVc2VyQWNjb3VudHModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XFxuICBhd2FpdCBzaW11bGF0ZUFQSUNhbGwoODAwKTtcXG4gIHJldHVybiBbXFxuICAgIHsgYWNjb3VudF9uYW1lOiAnQ2hhc2UgQ2hlY2tpbmcnLCBhY2NvdW50X3R5cGU6ICdjaGVja2luZycsIGJhbGFuY2U6IDUyMzQuNTYgfSxcXG4gICAgeyBhY2NvdW50X25hbWU6ICdIaWdoIFlpZWxkIFNhdmluZ3MnLCBhY2NvdW50X3R5cGU6ICdzYXZpbmdzJywgYmFsYW5jZTogMTU4OTAuMjMgfSxcXG4gICAgeyBhY2NvdW50X25hbWU6ICdDcmVkaXQgQ2FyZCcsIGFjY291bnRfdHlwZTogJ2NyZWRpdF9jYXJkJywgYmFsYW5jZTogLTEyOTguNDUgfSxcXG4gICAgeyBhY2NvdW50X25hbWU6ICdJbnZlc3RtZW50IFBvcnRmb2xpbycsIGFjY291bnRfdHlwZTogJ2ludmVzdG1lbnQnLCBiYWxhbmNlOiA0ODc1MC44OSB9XFxuICBdO1xcbn1cXG5cXG5hc3luYyBmdW5jdGlvbiBzaW11bGF0ZUFQSUNhbGwoZGVsYXk6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWxheSkpO1xcbn1cXG5cXG4vLyBUb29sIGltcGxlbWVudGF0aW9ucyBmb3IgdGhlIEF0b20gYWdlbnQgdG8gdXNlXG5uZXhwb3J0IGNvbnN0IGZpbmFuY2VBZ2VudFRvb2xzOiBUb29sSW1wbGVtZW50YXRpb25bXSA9IFtcXG4gIHtcXG4gICAgbmFtZTogJ2ZpbmFuY2VfcXVlcnlfaGFuZGxlcicsXFxuICAgIGRlc2NyaXB0aW9uOiAnSGFuZGxlIGNvbXByZWhlbnNpdmUgZmluYW5jaWFsIHF1ZXJpZXMgdGhyb3VnaCBuYXR1cmFsIGxhbmd1YWdlJyxcXG4gICAgaGFuZGxlcjogYXN5bmMgKHBhcmFtczogYW55KSA9PiB7XFxuICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZUZpbmFuY2VRdWVyeShwYXJhbXMudXNlcklkLCBwYXJhbXMucXVlcnksIHBhcmFtcy5jb250ZXh0KTtcXG4gICAgfVxcbiAgfSxcXG4gIHtcXG4gICAgbmFtZTogJ2dldF9zcGVuZGluZ19icmVha2Rvd24nLFxcbiAgICBkZXNjcmlwdGlvbjogJ0dldCBkZXRhaWxlZCBzcGVuZGluZyBhbmFseXNpcyB3aXRoIGluc2lnaHRzJyxcXG4gICAgaGFuZGxlcjogYXN5bmMgKHBhcmFtczogYW55KSA9PiB7XFxuICAgICAgcmV0dXJuIGF3YWl0IGdldFNwZW5kaW5nQW5hbHlzaXMocGFyYW1zLnVzZXJJZCwgeyB0aW1lZnJhbWU6IHBhcmFtcy50aW1lZnJhbWUgfSk7XFxuICAgIH1cXG4gIH0sXFxuICB7XFxuICAgIG5hbWU6ICduZXRfd29ydGhfaW5xdWlyeScsXFxuICAgIGRlc2NyaXB0aW9uOiAnR2V0IGN1cnJlbnQgbmV0IHdvcnRoIHdpdGggaGlzdG9yaWNhbCB0cmVuZHMnLFxcbiAgICBoYW5kbGVyOiBhc3luYyAocGFyYW1zOiBhbnkpID0+IHtcXG4gICAgICByZXR1cm4gYXdhaXQgZ2V0TmV0V29ydGhSZXNwb25zZShwYXJhbXMudXNlcklkLCB7IGluY2x1ZGVIaXN0b3J5OiB0cnVlIH0pO1xcbiAgICB9XFxuICB9XFxuXTtcXG5cbiJdfQ==